<!DOCTYPE html>
<html lang="ru">

  <head>
    <title>Про́клятый огонь, или магия препроцессора C &#x2F; Хабр</title>
<meta property="fb:app_id" content="444736788986613">
<meta property="fb:pages" content="472597926099084">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@habr_com">
<meta property="og:site_name" content="Хабр">
<link href="https://habr.com/ru/rss/post/787442/?fl=ru" type="application/rss+xml" title rel="alternate" name="rss">
<link href="https://habr.com/ru/articles/787442/" rel="canonical" data-hid="e3fa780">
<link rel="image_src" href="https://habrastorage.org/getpro/habr/upload_files/46a/150/3cc/46a1503ccbbf797056d52bfc376d67d2.png" data-hid="2a79c45">
<link rel="amphtml" href="https://habr.com/ru/amp/publications/787442/">
<meta property="og:title" content="Про́клятый огонь, или магия препроцессора C">
<meta name="twitter:title" content="Про́клятый огонь, или магия препроцессора C">
<meta name="aiturec:title" content="Про́клятый огонь, или магия препроцессора C">
<meta name="description" content="Задавались ли вы когда-нибудь вопросом, можно ли полноценно программировать при помощи директивы #define в языке C? Полнота по Тьюрингу шаблонов C++ известна весьма широко, например, люди пишут...">
<meta itemprop="description" content="Задавались ли вы когда-нибудь вопросом, можно ли полноценно программировать при помощи директивы #define в языке C? Полнота по Тьюрингу шаблонов C++ известна весьма широко, например, люди пишут...">
<meta property="og:description" content="Задавались ли вы когда-нибудь вопросом, можно ли полноценно программировать при помощи директивы #define в языке C? Полнота по Тьюрингу шаблонов C++ известна весьма широко, например, люди пишут...">
<meta name="twitter:description" content="Задавались ли вы когда-нибудь вопросом, можно ли полноценно программировать при помощи директивы #define в языке C? Полнота по Тьюрингу шаблонов C++ известна весьма широко, например, люди пишут...">
<meta property="aiturec:description" content="Задавались ли вы когда-нибудь вопросом, можно ли полноценно программировать при помощи директивы #define в языке C? Полнота по Тьюрингу шаблонов C++ известна весьма широко, например, люди пишут...">
<meta itemprop="image" content="https://habrastorage.org/getpro/habr/upload_files/46a/150/3cc/46a1503ccbbf797056d52bfc376d67d2.png">
<meta property="og:image" content="https://habrastorage.org/getpro/habr/upload_files/46a/150/3cc/46a1503ccbbf797056d52bfc376d67d2.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="aiturec:image" content="https://habrastorage.org/getpro/habr/upload_files/46a/150/3cc/46a1503ccbbf797056d52bfc376d67d2.png">
<meta name="twitter:image" content="https://habrastorage.org/getpro/habr/upload_files/46a/150/3cc/46a1503ccbbf797056d52bfc376d67d2.png">
<meta property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/46a/150/3cc/46a1503ccbbf797056d52bfc376d67d2.png?format=vk">
<meta property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/46a/150/3cc/46a1503ccbbf797056d52bfc376d67d2.png?format=vk">
<meta property="aiturec:item_id" content="787442">
<meta property="aiturec:datetime" content="2024-01-21T16:13:13.000Z">
<meta content="https://habr.com/ru/articles/787442/" property="og:url">
<meta property="og:type" content="article">
<meta property="og:locale" content="ru_RU">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta name="keywords" content="ненормальное программирование, магия">
<script type="application/ld+json" data-hid="1e0f0a2">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/articles\/787442\/"},"headline":"Про́клятый огонь, или магия препроцессора C","datePublished":"2024-01-21T19:13:13+03:00","dateModified":"2024-01-22T14:42:18+03:00","author":{"@type":"Person","name":"haqreu"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Задавались ли вы когда-нибудь вопросом, можно ли полноценно программировать при помощи директивы #define в языке C? Полнота по Тьюрингу шаблонов C++ известна вес...","url":"https:\/\/habr.com\/ru\/articles\/787442\/#post-content-body","about":["h_crazydev","h_programming","h_gamedev","h_compilers","h_c","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/787442\/f704d8dfbaef90f8b54a3d4f48500430\/","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/95a\/012\/0b8\/95a0120b8893f5229f17f58795b482f4.gif","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/633\/236\/706\/633236706e88fc286fb92dac9185cb87.gif","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/241\/8b1\/ea3\/2418b1ea386e2188d1149d03b2795950.gif","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/1d0\/7b8\/337\/1d07b833793f2e5e3737303a9c239a70.gif","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/45f\/42b\/be5\/45f42bbe531a20e7993b079498a8e199.gif","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/740\/9b6\/b27\/7409b6b27eea5884de0d830873b578df.gif","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/612\/cf7\/f1f\/612cf7f1f6fa8f37a051fe8d2ee0e30e.gif","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/8a6\/14c\/949\/8a614c94937966d14866b7a26c35382c.gif","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/c7a\/d83\/168\/c7ad83168922ebaf185e571e93e92da6.png"]}</script>
    <meta charset="UTF-8">
    <meta name="viewport"
      content="width=device-width,initial-scale=1.0,viewport-fit=cover,maximum-scale=1,user-scalable=0">
    <meta name="referrer" content="unsafe-url">
    <style>
      /* cyrillic-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5VvmojLazX3dGTP.woff2) format('woff2');
        unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
      }

      /* cyrillic */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5Vvk4jLazX3dGTP.woff2) format('woff2');
        unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
      }

      /* latin-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5VvmYjLazX3dGTP.woff2) format('woff2');
        unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
      }

      /* latin */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5Vvl4jLazX3dA.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }

      /* cyrillic-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveSxf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
      }

      /* cyrillic */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveQhf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
      }

      /* latin-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveSBf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
      }

      /* latin */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveRhf6Xl7Glw.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }

      /* cyrillic-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eSxf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
      }

      /* cyrillic */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eQhf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
      }

      /* latin-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eSBf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
      }

      /* latin */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eRhf6Xl7Glw.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }
    </style>
    <link rel="preload" href="https://assets.habr.com/habr-web/css/theme/light-v1.css" as="style" media="(prefers-color-scheme: light)" /><link rel="preload" href="https://assets.habr.com/habr-web/css/theme/dark-v1.css" as="style" media="(prefers-color-scheme: dark)" /><link id="light-colors" rel="stylesheet" href="https://assets.habr.com/habr-web/css/theme/light-v1.css" media="(prefers-color-scheme: light)" /><link id="dark-colors" rel="stylesheet" href="https://assets.habr.com/habr-web/css/theme/dark-v1.css" media="(prefers-color-scheme: dark)" />
    <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.161baa3becc3bd123445eaa78279f070.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
    <style>
      .grecaptcha-badge {
        visibility: hidden;
      }
    </style>
    <meta name="habr-version" content="2.226.4">
    
    <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
    <meta name="msapplication-TileColor" content="#629FBC">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="shortcut icon" type="image/png" sizes="16x16" href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png">
    <link rel="shortcut icon" type="image/png" sizes="32x32" href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png">
    <link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png">
    <link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png">
    <link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png">
    <link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png">
    <link rel="apple-touch-icon" type="image/png" sizes="256x256" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png">
    <link rel="mask-icon" color="#77a2b6" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg">
    <link crossorigin="use-credentials" href="/manifest.webmanifest" rel="manifest">
    <script async src="https://unpkg.com/pwacompat" crossorigin="anonymous"></script>
    <script>window.yaContextCb = window.yaContextCb || []</script>
    <script src="https://yandex.ru/ads/system/context.js" async></script>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.04465f7c.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.309f4a3f.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.b048dd16.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.1fe19768.js" as="script"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.04465f7c.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.b048dd16.css"></head>
  <body>
    
    <div id="mount"><div id="app" data-async-called="true"><div class="tm-layout__wrapper"><!--[--><!----><div></div><!----><header class="tm-header" data-test-id="header"><div class="tm-page-width"><!--[--><div class="tm-header__container"><!----><span class="tm-header__logo-wrap"><a class="tm-header__logo tm-header__logo_hl-ru tm-header__logo" href="/ru/"><svg class="tm-svg-img tm-header__icon" height="16" width="16"><title>Хабр</title><use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a><span style="display:none;" class="tm-header__beta-sign">β</span></span><!--[--><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><!--[--><button class="tm-header__dropdown-toggle"><svg class="tm-svg-img tm-header__icon tm-header__icon_dropdown" height="16" width="16"><title>Открыть список</title><use xlink:href="/img/megazord-v28.7909a852..svg#arrow-down"></use></svg></button><!--]--></div><!----></div><a href="/ru/sandbox/start/" class="tm-header__become-author-btn">Как стать автором</a><div class="tm-feature tm-feature tm-feature_variant-inline tm-header__feature"><!----></div><!----><!--]--><!----></div><!--]--></div></header><div class="tm-layout"><div class="tm-page-progress-bar"></div><div class="tm-base-layout__header_is-sticky tm-base-layout__header" data-menu-sticky="true"><div class="tm-page-width"><!--[--><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/feed/">Моя лента</a><!--]--><!--[--><a class="tm-main-menu__item" href="/ru/articles/">Все потоки</a><!--]--><!--[--><!--[--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/develop/">Разработка</a><!--]--><!--]--><!--[--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/admin/">Администрирование</a><!--]--><!--]--><!--[--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/design/">Дизайн</a><!--]--><!--]--><!--[--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/management/">Менеджмент</a><!--]--><!--]--><!--[--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/marketing/">Маркетинг</a><!--]--><!--]--><!--[--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/popsci/">Научпоп</a><!--]--><!--]--><!--]--></nav></div></div><div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search" data-test-id="search-button"><svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark" height="24" width="24"><title>Поиск</title><use xlink:href="/img/megazord-v28.7909a852..svg#search"></use></svg></a><!----><!----><div class="tm-header-user-menu__item tm-header-user-menu__write"><div><svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_write tm-header-user-menu__icon_dark" height="24" width="24"><title>Написать публикацию</title><use xlink:href="/img/megazord-v28.7909a852..svg#write"></use></svg></div><!----></div><!--[--><div class="tm-header-user-menu__item"><button class="tm-header-user-menu__toggle" data-test-id="user-menu-settings"><svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_dark" height="24" width="24"><title>Настройки</title><use xlink:href="/img/megazord-v28.7909a852..svg#page-settings"></use></svg></button></div><a href="https://habr.com/kek/v1/auth/habrahabr/?back=/ru/articles/787442/&amp;hl=ru" rel="nofollow" class="tm-header-user-menu__item"><!--[--><button class="btn btn_solid btn_small tm-header-user-menu__login" type="button"><!--[-->Войти<!--]--></button><!--]--></a><!--]--><!----><!--teleport start--><!--teleport end--><!----></div></div><!--]--></div></div><!----><div class="tm-page-width"><!--[--><!--]--></div><main class="tm-layout__container"><div class="tm-page" hl="ru" data-async-called="true"><div class="tm-page-width"><!--[--><!----><div class="tm-page__wrapper"><div class="tm-page__main_has-sidebar tm-page__main"><div class="pull-down"><!----><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg class="tm-svg-img pull-down__icon pull-down__arrow" height="24" width="24"><title>Обновить</title><use xlink:href="/img/megazord-v28.7909a852..svg#pull-arrow"></use></svg></div></div><!--[--><!--[--><div class="banner-wrapper narrow" style="--8c60b148:100px;--27848d7d:auto;" data-v-bf8a3ee7><!--[--><div class="placeholder-wrapper placeholder" data-v-bf8a3ee7><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="adfox-banner-placeholder narrow" data-v-12f7bcca><div class="image loads" data-v-12f7bcca></div><div class="lines" data-v-12f7bcca><div class="line loads" data-v-12f7bcca></div><div class="line loads" data-v-12f7bcca></div><div class="line loads" data-v-12f7bcca></div></div></div></div><div id="adfox_169815559787254866" class="tm-adfox-banner" data-v-bf8a3ee7></div><!--]--></div><div class="tm-article-presenter"><!--[--><!--]--><div class="tm-article-presenter__body" data-test-id="article-body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><!--[--><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><!--[--><div class="tm-article-presenter__header"><!--[--><!--]--><div class="tm-article-snippet tm-article-snippet tm-article-presenter__snippet"><!--[--><!--]--><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/haqreu/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="haqreu"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/94a/ae6/d03/94aae6d03dfb408e5f26bc21f42b49b6.png" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/haqreu/" class="tm-user-info__username">haqreu <!----></a><!--[--><span class="tm-article-datetime-published"><time datetime="2024-01-21T16:13:13.000Z" title="2024-01-21, 19:13">21  янв  2024 в 19:13</time></span><!--]--></span></span></div><!----></div><h1 class="tm-title tm-title_h1" lang="ru" data-test-id="articleTitle"><span>Про́клятый огонь, или магия препроцессора C</span></h1><div class="tm-article-snippet__stats" data-test-id="articleStats"><!----><div class="tm-article-reading-time"><span class="tm-svg-icon__wrapper tm-article-reading-time__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Время на прочтение</title><use xlink:href="/img/megazord-v28.7909a852..svg#clock"></use></svg></span><span class="tm-article-reading-time__label">18 мин</span></div><span class="tm-icon-counter tm-data-icons__item"><svg class="tm-svg-img tm-icon-counter__icon" height="24" width="24"><title>Количество просмотров</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-views"></use></svg><span class="tm-icon-counter__value" title="29722">30K</span></span></div><div class="tm-publication-hubs__container" data-test-id="articleHubsList"><div class="tm-publication-hubs"><!--[--><span class="tm-publication-hub__link-container"><a href="/ru/hubs/crazydev/" class="tm-publication-hub__link"><!--[--><span>Ненормальное программирование</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/programming/" class="tm-publication-hub__link"><!--[--><span>Программирование</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/gamedev/" class="tm-publication-hub__link"><!--[--><span>Разработка игр</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/compilers/" class="tm-publication-hub__link"><!--[--><span>Компиляторы</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/c/" class="tm-publication-hub__link"><!--[--><span>C</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><!--]--></div></div><div class="tm-article-labels" data-test-id="articleLabels"><div class="tm-article-labels__container"><!----><!--[--><div class="tm-publication-label tm-publication-label_variant-technotext2024"><a href="/ru/technotext/2024/" class="">✏️ Технотекст 7</a></div><!--]--></div></div><!----><!----></div></div><!--[--><!----><div class="tm-article-body" data-gallery-root lang="ru"><div><!--[--><!--]--></div><div id="post-content-body"><div><div class="article-formatted-body article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><p>Задавались ли вы когда-нибудь вопросом, можно ли полноценно программировать при помощи директивы <code>#define</code> в языке C? Полнота по Тьюрингу шаблонов C++ известна весьма широко, например, люди пишут <a href="https://github.com/tcbrindle/raytracer.hpp" rel="noopener noreferrer nofollow">трассировщики лучей</a>, делающие все вычисления во время компиляции (вместо времени исполнения). А как обстоят дела с препроцессором C? Вопрос оказался сильно нетривиальнее, и эта история является, на мой вкус, отличным анекдотом для курса лекций по теории компиляторов, что я готовлю в данный момент. В частности, для лучшего понимания происходящего здесь, рекомендую ознакомиться со второй статьёй, которую я опубликовал параллельно этой:<a href="https://habr.com/ru/articles/787800/" rel="noopener noreferrer nofollow"> лексер и парсер</a>.</p><p>Чтобы не было обманутых впечатлений, предупрежу сразу, что рейтрейсера не будет, но про́клятый код будет очень даже! Итак, поехали. Для начала, почему я вообще задался этим вопросом? Если обычный код компьютерной графики вам скучен, следующий раздел можно пропустить, перематывайте до последней картинки.</p><h2>Самый обычный огонь, никем не про́клятый</h2><p>Как я и сказал, я пообещал написать простейший, но вполне полноценный компилятор только что придуманного мной языка wend за выходные. Написать-то дело несложное, а вот <em>описать</em> труднее. Для хорошего описания нужны красочные примеры. У меня аллергия на иллюстрации из разряда вычислений чисел Фибоначчи. Ну сколько же можно?! Поскольку wend крайне примитивен, то и примеры мне нужны простые, но всё же как можно более эффектные. И тут я вспомнил про древнюю демосцену! Вот, например, я хочу написать на своём языке программу, которая просто гоняет по кругу пламя:</p><figure class=""><img src="https://habrastorage.org/getpro/habr/upload_files/95a/012/0b8/95a0120b8893f5229f17f58795b482f4.gif" width="320" height="167" data-src="https://habrastorage.org/getpro/habr/upload_files/95a/012/0b8/95a0120b8893f5229f17f58795b482f4.gif"/></figure><p>Это сделать несложно: у меня нет возможности запускать графический режим, но ведь моя консоль поддерживает управляющую последовательность <code>\033[</code>, так что для отрисовки пламени мне вполне хватит одной инструкции <code>print</code>! Кстати, я слышал, что нынче даже в винде консоль поддерживает эскейп-последовательности ANSI, но лично не проверял.</p><p>Дело за малым, написать код. Поскольку я болен только на часть головы, а не на всю, писать я его буду сначала на C, и уж потом только транслировать (руками) в wend, поскольку мой компилятор - это хорошо, но всё же вокруг си инструментов самую малость больше. Да и баги в моём компиляторе никто не отменял, и мне лень думать, где именно у меня проблема. На баги gcc я уже, конечно, натыкался, но это исчезающе редкое явление.</p><p>Давайте посмотрим, как создать такой огонь, а потом продолжим разговор про препроцессор и чёрную магию. Вот так выглядит обёртка, от которой мы будем отталкиваться:</p><details class="spoiler"><summary>Hidden text</summary><div class="spoiler__content"><pre><code class="cpp">#include &lt;stdio.h&gt;
#include &lt;stdint.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

#define WIDTH 80
#define HEIGHT 25
#define FPS 30

const char* palette[256] = {
#define ANSIRGB(R,G,B) "\033[48;2;" #R ";"  #G ";" #B "m "
    ANSIRGB(  0,  0,   0), ANSIRGB(  0,   4,  4), ANSIRGB(  0,  16, 20), ANSIRGB(  0,  28,  36),
    ANSIRGB(  0,  32, 44), ANSIRGB(  0,  36, 48), ANSIRGB( 60,  24, 32), ANSIRGB(100,  16,  16),
    ANSIRGB(132,  12, 12), ANSIRGB(160,   8,  8), ANSIRGB(192,   8,  8), ANSIRGB(220,   4,   4),
    ANSIRGB(252,   0,  0), ANSIRGB(252,   0,  0), ANSIRGB(252,  12,  0), ANSIRGB(252,  28,   0),
    ANSIRGB(252,  40,  0), ANSIRGB(252,  52,  0), ANSIRGB(252,  64,  0), ANSIRGB(252,  80,   0),
    ANSIRGB(252,  92,  0), ANSIRGB(252, 104,  0), ANSIRGB(252, 116,  0), ANSIRGB(252, 132,   0),
    ANSIRGB(252, 144,  0), ANSIRGB(252, 156,  0), ANSIRGB(252, 156,  0), ANSIRGB(252, 160,   0),
    ANSIRGB(252, 160,  0), ANSIRGB(252, 164,  0), ANSIRGB(252, 168,  0), ANSIRGB(252, 168,   0),
    ANSIRGB(252, 172,  0), ANSIRGB(252, 176,  0), ANSIRGB(252, 176,  0), ANSIRGB(252, 180,   0),
    ANSIRGB(252, 180,  0), ANSIRGB(252, 184,  0), ANSIRGB(252, 188,  0), ANSIRGB(252, 188,   0),
    ANSIRGB(252, 192,  0), ANSIRGB(252, 196,  0), ANSIRGB(252, 196,  0), ANSIRGB(252, 200,   0),
    ANSIRGB(252, 204,  0), ANSIRGB(252, 204,  0), ANSIRGB(252, 208,  0), ANSIRGB(252, 212,   0),
    ANSIRGB(252, 212,  0), ANSIRGB(252, 216,  0), ANSIRGB(252, 220,  0), ANSIRGB(252, 220,   0),
    ANSIRGB(252, 224,  0), ANSIRGB(252, 228,  0), ANSIRGB(252, 228,  0), ANSIRGB(252, 232,   0),
    ANSIRGB(252, 232,  0), ANSIRGB(252, 236,  0), ANSIRGB(252, 240,  0), ANSIRGB(252, 240,   0),
    ANSIRGB(252, 244,  0), ANSIRGB(252, 248,  0), ANSIRGB(252, 248,  0), ANSIRGB(252, 252,   0),
#define W ANSIRGB(252,252,252)
    W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W,
    W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W,
    W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W,
    W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W,
    W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W,
    W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W,
    W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W,
    W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W
#undef W
#undef ANSIRGB
};

static uint8_t fire[WIDTH * HEIGHT];

int main() {
    printf("\033[2J"); // clear screen
    for (;;) {
        printf("\033[H"); // home

        // rendering body
        {
            fire[rand()%(WIDTH*HEIGHT)] = 255;
        }

        for (int j = 0; j&lt;HEIGHT; j++) {      // show the buffer
            for (int i = 0; i&lt;WIDTH; i++)
                printf(palette[fire[i+j*WIDTH]]);
            printf("\033[49m\n");
        }
        usleep(1000000/FPS);
    }
    return 0;
}</code></pre><p></p></div></details><p>Для начала я определяю размеры моей консоли, в которой буду рисовать (80x25), Потом я определяю массив-палитру в 256 значений и буфер <code>fire</code>, который собственно и хранит картинку с (будущим) пламенем. Затем в вечном цикле <code>for(;;)</code> я отрисовываю этот буфер, в котором для начала просто заполняю белым цветом случайно выбранные пиксели. Получаем вполне ожидаемый результат:</p><figure class=""><img src="https://habrastorage.org/getpro/habr/upload_files/633/236/706/633236706e88fc286fb92dac9185cb87.gif" width="320" height="167" data-src="https://habrastorage.org/getpro/habr/upload_files/633/236/706/633236706e88fc286fb92dac9185cb87.gif"/></figure><p>Белые пиксели у меня будут искрами пламени. Искры довольно быстро остывают, нагревая при этом окружающую среду. Это можно промоделировать очень просто: на каждом кадре размывая картинку с предыдущего кадра. Все изменения в коде у меня будут происходить внутри блока отмеченного как <code>// rendering body</code>, так что больше код приводить целиком не буду, финальный код можно найти в <a href="https://github.com/ssloy/tinycompiler/gfx/" rel="noopener noreferrer nofollow">репозитории моего компилятора</a>. Самое простое размытие картинки можно сделать, просто посчитав для каждого пикселя среднее значение среди всех его соседей. Практически все имплементации, что я встречаю, требуют создания копии всего буфера, например, <a href="https://en.wikipedia.org/wiki/Box_blur" rel="noopener noreferrer nofollow">посмотрите в википедии</a>. При этом подобные фильтры сепарабельны по координатам, так что он полностью эквивалентен двум <a href="https://en.wikipedia.org/wiki/Motion_blur" rel="noopener noreferrer nofollow">motion blur фильтрам</a>, одному горизонтальному, второму вертикальному. Для начала давайте сделаем только вертикальное размытие:</p><details class="spoiler"><summary>Hidden text</summary><div class="spoiler__content"><pre><code class="cpp">void line_blur(int offset, int step, int nsteps) {
    uint8_t circ[3] = {0, fire[offset], fire[offset+step]};
    uint8_t beg = 1;
    for (int i=0; i&lt;nsteps; i++) {
        fire[offset] = (circ[0]+circ[1]+circ[2])/3;
        circ[(beg+++2)%3] = i+2&lt;nsteps ? fire[offset+2*step] : 0;
        offset += step;
    }
}

int main() {
        [...]
        // rendering body
        {
            // box blur: first horizontal motion blur then vertical motion blur
            for (int j = 0; j&lt;HEIGHT; j++)
тут -&gt;          line_blur(j*WIDTH, 1, WIDTH);

            fire[rand()%(WIDTH*HEIGHT)] = 255;
        }
        [...]
  }</code></pre><p></p></div></details><p>Кольцевого буфера на три элемента мне хватает, больше никаких копий экранного буфера мне не надо. Этот код даёт следующий результат (я чуть-чуть замедлил видео, чтобы было нагляднее):</p><figure class=""><img src="https://habrastorage.org/getpro/habr/upload_files/241/8b1/ea3/2418b1ea386e2188d1149d03b2795950.gif" width="320" height="167" data-src="https://habrastorage.org/getpro/habr/upload_files/241/8b1/ea3/2418b1ea386e2188d1149d03b2795950.gif"/></figure><p>Добавим к нему горизонтальное:</p><details class="spoiler"><summary>Hidden text</summary><div class="spoiler__content"><pre><code class="cpp">        // rendering body
        {
            // box blur: first horizontal motion blur then vertical motion blur
тут -&gt;      for (int j = 0; j&lt;HEIGHT; j++)
                line_blur(j*WIDTH, 1, WIDTH);
            for (int i = 0; i&lt;WIDTH; i++)
                line_blur(i, WIDTH, HEIGHT);

            fire[rand()%(WIDTH*HEIGHT)] = 255;
        }
        [...]
  }</code></pre><p></p></div></details><figure class=""><img src="https://habrastorage.org/getpro/habr/upload_files/1d0/7b8/337/1d07b833793f2e5e3737303a9c239a70.gif" width="320" height="167" data-src="https://habrastorage.org/getpro/habr/upload_files/1d0/7b8/337/1d07b833793f2e5e3737303a9c239a70.gif"/></figure><p>Тепло от одного пикселя быстро распределяется по всё большей и большей территории, так что перестаёт даже быть видным в моей палитре: на первой итерации один белый пиксель окружён восемью чёрными, на второй все девять пикселей имеют значение 255/9 = 28 и так далее:</p><pre><code>итерация 1     итерация 2      итерация 3
              0  0  0  0 0    3  6  9  6 3
 0  0  0      0 28 28 28 0    6 12 18 12 6
 0 255 0      0 28 28 28 0    9 18 28 18 9
 0  0  0      0 28 28 28 0    6 12 18 12 6
              0  0  0  0 0    3  6  9  6 3</code></pre><p>Тут я искры разбросал по всему экрану, но в реальности у нас тепло идёт непосредственно из костра, так что давайте чуточку подправим код, разрешив генерировать горячие пиксели только на самой нижней строчке экрана:</p><details class="spoiler"><summary>Hidden text</summary><div class="spoiler__content"><pre><code class="cpp">        // rendering body
        {
            // box blur: first horizontal motion blur then vertical motion blur
            for (int j = 0; j&lt;HEIGHT; j++)
                line_blur(j*WIDTH, 1, WIDTH);
            for (int i = 0; i&lt;WIDTH; i++)
                line_blur(i, WIDTH, HEIGHT);

            for (int i = 0; i&lt;WIDTH; i++) {       // add heat to the bed
                int idx = i+(HEIGHT-1)*WIDTH;
                if (!(rand()%32))
тут -&gt;              fire[idx] = 128+rand()%128;   // sparks
            }
        }</code></pre><p></p></div></details><figure class=""><img src="https://habrastorage.org/getpro/habr/upload_files/45f/42b/be5/45f42bbe531a20e7993b079498a8e199.gif" width="320" height="167" data-src="https://habrastorage.org/getpro/habr/upload_files/45f/42b/be5/45f42bbe531a20e7993b079498a8e199.gif"/></figure><p>Изображение стало менее интересным, зато небо перестало греться без причины. Чего нам тут не хватает, так это конвекции! Давайте на каждом этапе просто сдвигать предыдущий кадр на одну строчку вверх:</p><details class="spoiler"><summary>Hidden text</summary><div class="spoiler__content"><pre><code class="cpp">        // rendering body
        {
тут -&gt;      for (int j = 1; j&lt;HEIGHT; j++)        // scroll up
                for (int i = 0; i&lt;WIDTH; i++)
                    fire[i+(j-1)*WIDTH] = fire[i+j*WIDTH] ;

            // box blur: first horizontal motion blur then vertical motion blur
            for (int j = 0; j&lt;HEIGHT; j++)
                line_blur(j*WIDTH, 1, WIDTH);
            for (int i = 0; i&lt;WIDTH; i++)
                line_blur(i, WIDTH, HEIGHT);

            for (int i = 0; i&lt;WIDTH; i++) {       // add heat to the bed
                int idx = i+(HEIGHT-1)*WIDTH;
                if (!(rand()%32))
                    fire[idx] = 128+rand()%128;   // sparks
            }
        }</code></pre><p></p></div></details><figure class=""><img src="https://habrastorage.org/getpro/habr/upload_files/740/9b6/b27/7409b6b27eea5884de0d830873b578df.gif" width="320" height="167" data-src="https://habrastorage.org/getpro/habr/upload_files/740/9b6/b27/7409b6b27eea5884de0d830873b578df.gif"/></figure><p>Уже сильно более похоже на правду! Но ведь у костра есть подушка углей, искры не возникают просто так, так что давайте закрасим постоянным цветом (а значит, и добавим тепла) нижнюю строчку картинки:</p><details class="spoiler"><summary>Hidden text</summary><div class="spoiler__content"><pre><code class="cpp">        // rendering body
        {
            for (int j = 1; j&lt;HEIGHT; j++)        // scroll up
                for (int i = 0; i&lt;WIDTH; i++)
                    fire[i+(j-1)*WIDTH] = fire[i+j*WIDTH] ;

            // box blur: first horizontal motion blur then vertical motion blur
            for (int j = 0; j&lt;HEIGHT; j++)
                line_blur(j*WIDTH, 1, WIDTH);
            for (int i = 0; i&lt;WIDTH; i++)
                line_blur(i, WIDTH, HEIGHT);

            for (int i = 0; i&lt;WIDTH; i++) {       // add heat to the bed
                int idx = i+(HEIGHT-1)*WIDTH;
                if (!(rand()%32))
                    fire[idx] = 128+rand()%128;   // sparks
                else
тут -&gt;              fire[idx] = fire[idx]&lt;16 ? 16 : fire[idx]; // ember bed
            }
        }</code></pre><p></p></div></details><figure class=""><img src="https://habrastorage.org/getpro/habr/upload_files/612/cf7/f1f/612cf7f1f6fa8f37a051fe8d2ee0e30e.gif" width="320" height="167" data-src="https://habrastorage.org/getpro/habr/upload_files/612/cf7/f1f/612cf7f1f6fa8f37a051fe8d2ee0e30e.gif"/></figure><p>Почти совсем хорошо, но тепла что-то очень много, давайте в качестве последнего штриха добавим охлаждение:</p><details class="spoiler"><summary>Hidden text</summary><div class="spoiler__content"><pre><code class="cpp">        // rendering body
        {
            for (int j = 1; j&lt;HEIGHT; j++)        // scroll up
                for (int i = 0; i&lt;WIDTH; i++)
                    fire[i+(j-1)*WIDTH] = fire[i+j*WIDTH];

            // box blur: first horizontal motion blur then vertical motion blur
            for (int j = 0; j&lt;HEIGHT; j++)
                line_blur(j*WIDTH, 1, WIDTH);
            for (int i = 0; i&lt;WIDTH; i++)
                line_blur(i, WIDTH, HEIGHT);

            for (int i = 0; i&lt; WIDTH*HEIGHT; i++) // cool
                if (rand()%2 &amp;&amp; fire[i]&gt;0)
тут -&gt;              fire[i]--;

            for (int i = 0; i&lt;WIDTH; i++) {       // add heat to the bed
                int idx = i+(HEIGHT-1)*WIDTH;
                if (!(rand()%32))
                    fire[idx] = 128+rand()%128;   // sparks
                else
                    fire[idx] = fire[idx]&lt;16 ? 16 : fire[idx]; // ember bed
            }
        }</code></pre><p></p></div></details><p>Ну, собственно, и всё, обычный, никем не проклятый огонь, готов. Давайте посмотрим на него ещё раз:</p><figure class=""><img src="https://habrastorage.org/getpro/habr/upload_files/8a6/14c/949/8a614c94937966d14866b7a26c35382c.gif" width="320" height="167" data-src="https://habrastorage.org/getpro/habr/upload_files/8a6/14c/949/8a614c94937966d14866b7a26c35382c.gif"/></figure><p>Наверное, можно переводить код на wend? И тут как раз в кустах случайно стоит рояль, я могу сыграть!</p><h2>Рояль в кустах</h2><p>Внимательный читатель мог заметить, что в этой демке я всю отрисовку провожу в массиве <code>fire[]</code>, а в моём языке wend нет массивов! И отрисовывать пиксели независимо один от другого не получится никак, поскольку рассеивание тепла (да и конвекция) требуют знания состояния соседних пикселей. Но это не беда, ведь у меня есть функции. Давайте предположим, что мне нужен массив в восемь элементов. Его можно сэмулировать восемью разными переменными, и двумя функциями - геттером/сеттером:</p><pre><code class="cpp">uint8_t fire0, fire1, fire2, fire3, fire4, fire5, fire6, fire7;

uint8_t get_fire(int i) {
    if (i==0) return fire0;
    if (i==1) return fire1;
    if (i==2) return fire2;
    if (i==3) return fire3;
    if (i==4) return fire4;
    if (i==5) return fire5;
    if (i==6) return fire6;
    if (i==7) return fire7;
}

void set_fire(int i, uint8_t v) {
  [...]
}</code></pre><p>Сеттер описывать не буду, его структура будет такой же, как у геттера. Код тривиальный, но по факту я сделал связный список вместо массива, и чтобы добраться до двухтысячного элемента, мне придётся сделать две тысячи сравнений. Оно, конечно, абсолютно пофиг на таком размере данных, но что-то неспокойна моя душа. Впрочем, ничто не мешает искать нужную переменную при помощи дихотомии, сведя сложность от линейной к логарифмической:</p><pre><code class="cpp">uint8_t get_fire(int i) {
    if (i&lt;4) {
        if (i&lt;2) {
            if (i&lt;1) {
                return fire0;
            } else {
                return fire1;
            }
        } else {
            if (i&lt;3) {
                return fire2;
            } else {
                return fire3;
            }
        }
    } else {
        if (i&lt;6) {
            if (i&lt;5) {
                return fire4;
            } else {
                return fire5;
            }
        } else {
            if (i&lt;7) {
                return fire6;
            } else {
                return fire7;
            }
        }
    }
}</code></pre><p>Это уже сильно приятнее. И как раз вот этот код и дал толчок к данной статье. Как мне сгенерировать эту функцию? Руками писать сильно неохота :)</p><p>Мой язык местами сильно похож на си, так что если сделать сишный код, то его можно протестировать сначала нормально, а потом скопировать в исходник на wend.</p><p>Консоль у меня 80x25, так что мне нужна память на две тысячи ячеек. 2048 очень близко к 2000, и при этом является точной степенью двойки, так что с минимальным оверхедом мне не надо себе ломать голову над граничными условиями, и можно сделать полностью сбалансированное двоичное дерево поиска. Очевидно, что я мог взять любой язык программирования, и сгенерировать соответствующую строку текста, однако мне почему-то захотелось сделать в оригинальном исходнике с огнём простой переключатель на дефайне, который бы переключал между обычным массивом и эрзац-массивом: это был бы простой способ убедиться в том, что я нигде не напортачил. И вот тут я задался вопросом: а нельзя ли эту самую функцию сгенерировать именно при помощи препроцессора C?</p><p>Для этого мне пришлось бы написать рекурсивный <code>#define</code>. Можно ли это сделать, и если да, то как? Разумеется, я пошёл задавать вопрос гуглу. И среди прочего наткнулся на <a href="https://cplusplus.com/forum/general/9036/" rel="noopener noreferrer nofollow">любопытный тред</a> на cplusplus.com, давайте я его даже заскриню:</p><details class="spoiler"><summary>Hidden text</summary><div class="spoiler__content"><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/c7a/d83/168/c7ad83168922ebaf185e571e93e92da6.png" width="1013" height="1403" data-src="https://habrastorage.org/getpro/habr/upload_files/c7a/d83/168/c7ad83168922ebaf185e571e93e92da6.png"/></figure><p></p></div></details><p>Наш коллега задался ровно тем же самым вопросом, что и я, и ему трижды ответили, что рекурсия на дефайнах невозможна. Ха.</p><p>Имейте в виду, что это не я такой умный, я нашёл <a href="https://github.com/pfultz2/Cloak/wiki/C-Preprocessor-tricks,-tips,-and-idioms" rel="noopener noreferrer nofollow">правильную ссылку</a> на stackoverflow, и попытался лишь скомпилировать полученное знание. </p><h2>Как работает препроцессор или почему макрокоманда - это не функция</h2><p>Давайте разбираться с тем, как работает препроцессор C. В вышеприведённом коде с огнём мы уже встречались с дефайном <code>#define WIDTH 80</code>, это вполне стандартная практика определения констант (примечание: не делайте так в C++, <code>constexpr</code> - это хорошо! У дефайнов есть много неприятных моментов, которые начисто убираются при помощи <code>constexpr</code>). И когда лексер встречает лексему <code>WIDTH</code>, он её подменяет на 80 ещё <strong>до</strong> запуска непосредственно компилятора. Макрокоманды бывают ещё и похожими на функции, например, знаменитый <code>#define MIN(X, Y) (((X) &lt; (Y)) ? (X) : (Y))</code>. Примечание: не делайте так, на третьем десятке двадцать первого века я не могу придумать ни одной причины, чтобы продолжать использовать код из семидесятых.</p><p>"Выполнение", а точнее, разворачивание макрокоманд является чисто текстовым. Препроцессор не понимает язык Си, поэтому, если вы ему дадите <code>MIN(habracadabra, circ][(beg+++))</code>, то он её радостно преобразует в <code>(((habracadabra) &lt; (circ][(beg+++))) ? (habracadabra) : (circ][(beg+++)</code>! Проверьте сами при помощи gcc -E source.c.</p><p>Когда мы хотим развернуть макрокоманду, похожую на функцию, то видя похожий синтаксис, большинство программистов считают, что и работает это как функция, то есть, сначала мы оценим значения параметров, и передадим в тело родительской макрокоманды. И чаще всего такая интуиция не противоречит тому, что мы видим. Но препроцессор - это не сам C, и макросы ведут себя совсем не так, и вышепривённый пример с <code>MIN</code> тому подтверждение.</p><p>Давайте я приведу правила подстановки для макрокоманд (в порядке их выполнения):</p><ul><li><p>Приведение к строке (оператор <code>#</code>, в этой статье не встречается)</p></li><li><p>Подстановка текста аргументов вместо имён параметров (без разворачивания лексем) </p></li><li><p>Склеивание лексем (оператор <code>##</code>, в этой статье встречается повсеместно)</p></li><li><p>Разворачивание лексем параметров</p></li><li><p>Повторное сканирование и разворачивание результата.</p></li></ul><h3>Настали тёмные времена, или чёрная магия</h3><p>Давайте рассмотрим простейший пример (пока на си) хвостовой рекурсии:</p><pre><code class="cpp">void recursion(int d) {
    printf("%d ", d);
    if (d!=0) recursion(d - 1);
}</code></pre><p>Если мы вызовем <code>recursion(3)</code>, то на экране будет выведено <code>3 2 1 0</code>. Нам нужно научиться сделать подобное исключительно на макросах. Итак, перечислим необходимые нам ингредиенты в порядке возрастающей сложности:</p><ul><li><p>нужно уметь делать декремент</p></li><li><p>нужно уметь делать ветвление</p></li><li><p>нужно уметь проверить числовое значение на равенство нулю</p></li><li><p>ну и научиться делать непосредственно рекурсивный вызов.</p></li></ul><h2>Декремент</h2><p>Давайте начнём с самого первого, с декремента. Препроцессор довольно тупой. Он выполняет подстановку текста, и ничего больше. Временами это раздражает, но это также позволяет вам манипулировать частями выражений, если вы того хотите, так что в этом есть определенный смысл.</p><p>Тот факт, что препроцессор ничего не знает про арифметику, делая исключительно текстовые подстановки, несколько затрудняет жизнь. Давайте сделаем первую попытку:</p><pre><code class="cpp">ssloy@home:~$ gcc -P -E - &lt;&lt;&lt;'
#define DEC(n) n - 1

DEC(3)
'
3 - 1</code></pre><p>Для наглядности я буду запускать gcc сразу на коде из командной строки, так что вы видите и сам код, и результат работы препроцессора. Итак, макрокоманда <code>DEC(3)</code>, разворачивается не в желаемую константу <code>2</code>, а в выражение <code>3-1</code>.</p><p>Не беда, давайте попробуем чуть схитрить, используя возможности склеивания лексем:</p><pre><code class="cpp">ssloy@home:~$ gcc -P -E - &lt;&lt;&lt;'
#define DEC(n) DEC_##n
#define DEC_0 0
#define DEC_1 0
#define DEC_2 1
#define DEC_3 2

DEC(3)
DEC(DEC(3))
'
2
DEC_DEC(3)</code></pre><p>Когда мы разворачиваем <code>DEC(3)</code>, то в происходит склеивание лексем <code>DEC_</code> и <code>3</code>, и создаётся новая лексема <code>DEC_3</code>, которая развёртывается в <code>2</code>, отлично! А вот с <code>DEC(DEC(3))</code> фокус не прошёл, почему? Не зря я правила разворачивания макрокоманд приводил, склеивание происходит на этап раньше развёртывания параметров, и поэтому код в реальности делает не то, что кажется на первый взгляд: мы приклеиваем лексему <code>DEC_</code> к неразвёрнутому тексту параметра <code>DEC(3)</code>, и на этом всё останавливается. Этому горю помочь несложно, достаточно спрятать склеивание на один уровень глубже:</p><pre><code class="cpp">ssloy@home:~$ gcc -P -E - &lt;&lt;&lt;'
#define CONCAT(a,b) a##b

#define DEC(n) CONCAT(DEC_,n)
#define DEC_0 0
#define DEC_1 0
#define DEC_2 1
#define DEC_3 2

DEC(3)
DEC(DEC(3))
DEC(DEC(DEC(3)))
&gt; '
2
1
0</code></pre><p>Я объявил макрокоманду склеивания двух лексем <code>CONCAT</code>, и все проблемы пропали, декремент прекрасно работает, оперируя сразу численными константами, а не выражениями. Обратите внимание, что в данном коде я не могу декрементировать, например, 4. Вполне правомерен вопрос: а насколько это вообще разумно, хотеть определять по макрокоманде на каждое численное значние? Краткий ответ: про какую разумность может идти речь при программировании чисто на лексере?! Развёрнутый ответ: в данном случае декремент идёт по глубине рекурсии, и очень редко она бывает нужна дальше десятка-двух уровней.</p><h2>Ветвление</h2><p>Итак, мы познакомились с самым главным: мы можем генерировать новые лексемы путём склеивания кусков, и эти лексемы могут быть именами других макрокоманд! В таком случае, ветвление труда не составит. Давайте посмотрим на следующий код:</p><pre><code class="cpp">ssloy@home:~$ gcc -P -E - &lt;&lt;&lt;'
#define IF_ELSE(b) CONCAT(IF_,b)
#define IF_0(i) ELSE_0
#define IF_1(i) i ELSE_1
#define ELSE_0(e) e
#define ELSE_1(e)

IF_ELSE(1)(then body)(else body)
IF_ELSE(0)(then body)(else body)
'
then body
else body
</code></pre><p><code>IF_ELSE</code> - это макрокоманда, принимающая в качестве аргумента исключительно 0 или 1, и которая генерирует либо лексему <code>IF_0</code>, либо лексему <code>IF_1</code> путём тривиального склеивания. IF_0 - это команда, которая генерирует лексему ELSE_0, по пути просто съедая свои собственные аргументы. Ну а <code>ELSE_0</code> - это просто тождественное отображение. Давайте проследим всю цепочку развёртывания <code>IF_ELSE(0)(then body)(else body):</code></p><pre><code class="cpp">IF_ELSE(0)(then body)(else body)
IF_0(then body)(else body)
ELSE_0(else body)
(else body)</code></pre><p>Разворачивание с аргументом 1 происходит совершенно аналогично.</p><h2>Проверка на равенство нулю</h2><p>Теперь вы закалённые метапрограммисты, и не испугаетесь простой проверки на ноль :)</p><pre><code class="cpp">ssloy@home:~$ gcc -P -E - &lt;&lt;&lt;'
#define SECOND(a, b, ...) b
#define TEST(...) SECOND(__VA_ARGS__, 0)
#define ISZERO(n) TEST(ISZERO_ ## n)
#define ISZERO_0 ~, 1

ISZERO(0)
ISZERO(3)
'
1
0</code></pre><p>Давайте разбираться. Когда мы развёртываем <code>ISZERO(n)</code>, то первое, что мы делаем (ещё раз смотрим в порядок разворачивания макрокоманд) - это склейка. В данном примере я тестировал <code>ISZERO(0)</code> и <code>ISZERO(3)</code>. Во втором случае мы генерируем лексему <code>ISZERO_3</code>, а вот в первом <code>ISZERO_0</code>, которая является именем уже существующей макрокоманды! А вот она, в свою очередь, разворачивается в список <code>~,1</code> . Это ключевой момент: Только передавая ноль в команду <code>ISZERO</code>, мы внутри получим что-то, содержащее запятую. При передаче любого другого числа получится просто несуществующий токен. Нет, конечно, ничто нам не помешает засунуть в аргументы <code>ISZERO</code> не число, а что-то, разворачивающееся так же, как и <code>ISZERO_0</code>, но это же си, тут каждый может выстрелить себе в ногу, если ему так хочется :)</p><p>Оставшуюся работу делает вариативная макрокоманда <code>SECOND</code>, которая возвращает свой второй аргумент. Мы точно знаем, что она получит на вход как минимум два аргумента:  <code>ISZERO(3)</code> разворачивается в <code>SECOND(ISZERO_3, 0)</code>, и в итоге получается 0. Ну а <code>ISZERO(0)</code> разворачивается в <code>SECOND(~,1,0)</code> и сводится к 1. Значок тильды ~ здесь - это не магическая команда, он просто выбран от балды, поскольку вероятнее всего создаст синтаксическую ошибку при баге в наших макросах.</p><h2>Рекурсия</h2><p>Итак, мы научились делать декремент, научились ветвить код по равенству нулю, остался последний рывок. Если вы сумели продраться через равенство нулю, вам теперь должно быть море по колено.</p><p>Очень важно понимать, что все подстановки в макросах выполняются во время работы лексера, ещё <strong>ДО</strong> запуска парсера. И именно парсер по идее должен заниматься рекурсиями (привет, полнота по Тьюрингу у темплейтов). А создатели лексера приложили значительные усилия, чтобы <strong>рекурсивных вызовов не допустить</strong>.</p><p>Это необходимо для того, чтобы избежать бесконечной рекурсии при разворачивании макросов. Например, рассмотрим такой случай:</p><pre><code class="cpp">ssloy@home:~$ gcc -P -E - &lt;&lt;&lt;'
#define FOO F BAR
#define BAR B FOO
 
FOO
BAR
'
F B FOO
B F BAR</code></pre><p>Работает это так: препроцессор знает, какие макросы он разворачивает, и если во время раскрытия одного из макросов он снова его встречает, то "помечает синим цветом" (жаргон компиляторщиков) повторное появление лексемы, и оставляет её дальше как есть.</p><p>Допустим, мы хотим развернуть лексему <code>FOO</code>. Препроцессор заходит в состояние "разворачиваем <code>FOO</code>", обрабатывает лексему <code>F</code> . Но когда он разворачивает макрос <code>BAR</code>, то снова встречает лексему <code>FOO</code> , и сразу же её помечает, запрещая дальнейшее раскрытие. Примерно такая же история при раскрытии макроса <code>BAR</code>.</p><p>А теперь давайте хитрить!</p><pre><code class="cpp">ssloy@home:~$ gcc -P -E - &lt;&lt;&lt;'
#define FOO() F BAR
#define BAR() B FOO

FOO()()()()()()()()()
'
F B F B F B F B F BAR</code></pre><p>Любопытно, любопытно. А что же произошло? А случилась крайне интересная вещь: мы превратили макрокоманду FOO в команду с параметрами. Давайте проследим два уровня развёртывания:</p><pre><code class="cpp">FOO()()()()()()()()()
F BAR()()()()()()()()
F B FOO()()()()()()() &lt;- вот тут FOO не помечен синим!</code></pre><p>Когда мы второй раз встретились с <code>FOO</code>, лексер его не узнал, поскольку сгенерировал лексему <code>FOO</code> <strong>без параметров</strong>. И на этом обработка одной <code>FOO</code> закончилась. А затем лексер продолжил, обнаружил скобки, и вызвал <code>FOO</code> во второй раз.  А потом в третий. И четвёртый...</p><p>И тут мне пошла карта. Только вот рекурсия бывает не только хвостовой, но даже для хвостовой мне не хочется генерировать заранее все параметры :)</p><p>Напоминаю, что прямой вызов <code>FOO()</code> внутри <code>BAR</code> не работает, нужно именно остановить контекст развёртывания макрокоманды прежде, чем встретится лексема этой же макрокоманды с параметрами. И, оказывается, это несложно сделать. Для начала давайте добавим пустую макрокоманду <code>EMPTY()</code> :</p><pre><code class="cpp">ssloy@home:~$ gcc -P -E - &lt;&lt;&lt;'
#define EMPTY()
#define FOO() F BAR EMPTY() ()
#define BAR() B FOO EMPTY() ()

FOO()

#define EVAL(x) x
EVAL(FOO())
EVAL(EVAL(FOO()))
EVAL(EVAL(EVAL(FOO())))
EVAL(EVAL(EVAL(EVAL(FOO()))))
'
F BAR ()
F B FOO ()
F B F BAR ()
F B F B FOO ()
F B F B F BAR ()
</code></pre><p>Теперь при попытке разворачивания <code>FOO()</code> лексер создаёт лексему <code>F</code>, лексему <code>BAR</code>, не совпадающую с именем макрокоманды <code>BAR()</code>, обрабатывает пустую лексему, оставляет скобки <code>()</code> как есть. Всё, контекст <code>FOO()</code>завершился, и ничто не было покрашено синим! Только вот разворачивается <code>FOO()</code>в весьма скучное <code>F BAR ()</code>, ровно как и раньше. Что же мы выиграли? А смотрите дальше по коду. Я определил макрокоманду тождественного отображения <code>#define EVAL(x) x</code>, и вот уже развёртывание <code>EVAL(FOO())</code> сильно интереснее. Давайте проследим всю цепочку (освежите в памяти правила развёртывания, особенно последнее):</p><pre><code class="cpp">EVAL(FOO()) &lt;- заходим в контекст EVAL
FOO()       &lt;- на этом этапе происходит развёртывание лексем параметров EVAL
F BAR ()    &lt;- единственный параметр EVAL развёрнут
F B FOO ()  &lt;- ПОВТОРНОЕ СКАНИРОВАНИЕ после разворачивания параметров EVAL!</code></pre><p>Ну, собственно, и всё. Обернув в два <code>EVAL</code>, пройдём дальше. В целом нужно (примерно) столько же обёрток <code>EVAL</code>, какая у нас глубина рекурсии, это можно обеспечить всего несколькими строчками кода. Давайте соберём всё вместе, напоминаю, что нам нужно получить подобие вот этого сишного кода, но с рекурсией на макросах!</p><pre><code class="cpp">ssloy@home:~$ gcc -xc - &lt;&lt;&lt;'
#include &lt;stdio.h&gt;
void foo(int d) {
    printf("%d ", d);
    if (d!=0) foo(d - 1);
}
int main() {
    foo(3);
    return 0;
}
' &amp;&amp; ./a.out
3 2 1 0 ssloy@home:~$ </code></pre><p>Да не вопрос вообще! Это простой копи-пейст вышеприведённых кусков кода. Единственный момент, с которым пришлось быть аккуратным, это ещё один уровень задержки на строчке 29, поскольку лексема <code>BAR</code> генерируется внутри команды ветвления, и нам нужно подождать ещё одну итерацию <code>EVAL</code>, чтобы <code>BAR</code> не покрасился.</p><pre><code class="cpp">ssloy@home:~$ gcc -xc - &lt;&lt;&lt;'
#include &lt;stdio.h&gt;

#define CONCAT(a,b) a##b

#define DEC(n) CONCAT(DEC_,n)
#define DEC_0 0
#define DEC_1 0
#define DEC_2 1
#define DEC_3 2

#define IF_ELSE(b) CONCAT(IF_,b)
#define IF_0(i) ELSE_0
#define IF_1(i) i ELSE_1
#define ELSE_0(e) e
#define ELSE_1(e)

#define SECOND(a, b, ...) b
#define TEST(...) SECOND(__VA_ARGS__, 0)
#define ISZERO(n) TEST(ISZERO_ ## n)
#define ISZERO_0 ~, 1

#define EMPTY()
#define FOO(d) \
    printf("%d ", d); \
    IF_ELSE(ISZERO(d)) \
    ( ) \
    ( BAR EMPTY EMPTY() () (DEC(d)) )
#define BAR(d) FOO EMPTY() (d)

#define EVAL(x)  EVAL1(EVAL1(EVAL1(x)))
#define EVAL1(x) EVAL2(EVAL2(EVAL2(x)))
#define EVAL2(x) EVAL3(EVAL3(EVAL3(x)))
#define EVAL3(x) x

int main() {
    EVAL(FOO(3))
    return 0;
}
' &amp;&amp; ./a.out 
3 2 1 0 ssloy@home:~$ </code></pre><p>Ну а исходник проклятого огня можно найти <a href="https://github.com/ssloy/tinycompiler/blob/main/gfx/fire_cursed.c" rel="noopener noreferrer nofollow">тут</a>. Как и обещал, весь фреймбуфер хранится в скопище отдельных переменных, никаких массивов!</p><h2>Полон ли по Тьюрингу препроцессор C?</h2><p>В разговорной речи термин "Тьюринг-полный" означает, что любой реальный компьютер общего назначения или компьютерный язык может приблизительно моделировать вычислительные аспекты любого другого реального компьютера общего назначения или компьютерного языка. Ни одна реальная система не может иметь бесконечную память, но если пренебречь ограничением конечной памяти, то большинство языков программирования в остальном являются Тьюринг-полными.</p><p>У препроцессора конечна не только память, но и количество уровней ре-сканирования лексем (которое мы задаём при помощи <code>EVAL</code>), но ведь это всего-навсего одна из форм ограничений по памяти, так что в обывательском смысле препроцессор вполне себе полон по Тьюрингу. </p><p>Уже после написания этой статьи, я нашёл ещё <a href="https://github.com/Hirrolot/metalang99" rel="noopener noreferrer nofollow">одну ссылку</a>, где граждане натурально забабахали метаязык программирования исключительно на дефайнах, но это уже психопатство запредельного уровня, и, к сожалению, слишком сложное для первого знакомства с ч0рной магией препроцессора. Трюки, которые показал я, вполне ещё могут пойти в продакшн, а вот metalang99 - сомневаюсь :)</p><h2>Бонус</h2><p>Современные оптимизирующие компиляторы - это, пожалуй, самое сложное и впечатляющее творение человечества в области программной инженерии. Но это не значит, что там есть что-то магическое. Обычный человеческий мозг в несколько секунд скажет, во что должен скомпилироваться нижеприведённый весьма тривиальный код, а вот gcc понадобится куча экзабайт памяти и много-много лет, для того, чтобы дать ответ.</p><details class="spoiler"><summary>Hidden text</summary><div class="spoiler__content"><pre><code class="cpp">#define X1(x) X2(x)+X2(x)
#define X2(x) X3(x)+X3(x)
#define X3(x) X4(x)+X4(x)
#define X4(x) X5(x)+X5(x)
#define X5(x) X6(x)+X6(x)
#define X6(x) X7(x)+X7(x)
#define X7(x) X8(x)+X8(x)
#define X8(x) X9(x)+X9(x)
#define X9(x) X10(x)+X10(x)
#define X10(x) X11(x)+X11(x)
#define X11(x) X12(x)+X12(x)
#define X12(x) X13(x)+X13(x)
#define X13(x) X14(x)+X14(x)
#define X14(x) X15(x)+X15(x)
#define X15(x) X16(x)+X16(x)
#define X16(x) X17(x)+X17(x)
#define X17(x) X18(x)+X18(x)
#define X18(x) X19(x)+X19(x)
#define X19(x) X20(x)+X20(x)
#define X20(x) X21(x)+X21(x)
#define X21(x) X22(x)+X22(x)
#define X22(x) X23(x)+X23(x)
#define X23(x) X24(x)+X24(x)
#define X24(x) X25(x)+X25(x)
#define X25(x) X26(x)+X26(x)
#define X26(x) X27(x)+X27(x)
#define X27(x) X28(x)+X28(x)
#define X28(x) X29(x)+X29(x)
#define X29(x) X30(x)+X30(x)
#define X30(x) X31(x)+X31(x)
#define X31(x) X32(x)+X32(x)
#define X32(x) X33(x)+X33(x)
#define X33(x) X34(x)+X34(x)
#define X34(x) X35(x)+X35(x)
#define X35(x) X36(x)+X36(x)
#define X36(x) X37(x)+X37(x)
#define X37(x) X38(x)+X38(x)
#define X38(x) X39(x)+X39(x)
#define X39(x) X40(x)+X40(x)
#define X40(x) X41(x)+X41(x)
#define X41(x) X42(x)+X42(x)
#define X42(x) X43(x)+X43(x)
#define X43(x) X44(x)+X44(x)
#define X44(x) X45(x)+X45(x)
#define X45(x) X46(x)+X46(x)
#define X46(x) X47(x)+X47(x)
#define X47(x) X48(x)+X48(x)
#define X48(x) X49(x)+X49(x)
#define X49(x) X50(x)+X50(x)
#define X50(x) X51(x)+X51(x)
#define X51(x) X52(x)+X52(x)
#define X52(x) X53(x)+X53(x)
#define X53(x) X54(x)+X54(x)
#define X54(x) X55(x)+X55(x)
#define X55(x) X56(x)+X56(x)
#define X56(x) X57(x)+X57(x)
#define X57(x) X58(x)+X58(x)
#define X58(x) X59(x)+X59(x)
#define X59(x) X60(x)+X60(x)
#define X60(x) X61(x)+X61(x)
#define X61(x) X62(x)+X62(x)
#define X62(x) X63(x)+X63(x)
#define X63(x) X64(x)+X64(x)
#define X64(x) x+x

int main() {
  return X1(0);
}
</code></pre><p></p></div></details><h2>Послесловие</h2><p>Не забудьте выйти из хаба "ненормальное программирование", и <a href="https://habr.com/ru/articles/787800/" rel="noopener noreferrer nofollow">вернуться ко вполне нормальному.</a> Have fun!</p><p></p></div></div></div><!----><!----></div><!----><!----></div><!--]--><!----><div class="tm-article-presenter__meta" data-test-id="article-meta-links"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span><ul class="tm-separated-list__list"><!--[--><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[%D0%BD%D0%B5%D0%BD%D0%BE%D1%80%D0%BC%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5+%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5]" class="tm-tags-list__link"><span>ненормальное программирование</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[%D0%BC%D0%B0%D0%B3%D0%B8%D1%8F]" class="tm-tags-list__link"><span>магия</span></a><!--]--></li><!--]--><!----></ul></div><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span><ul class="tm-separated-list__list"><!--[--><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/crazydev/" class="tm-hubs-list__link"><!--[--><span>Ненормальное программирование</span><!--]--></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/programming/" class="tm-hubs-list__link"><!--[--><span>Программирование</span><!--]--></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/gamedev/" class="tm-hubs-list__link"><!--[--><span>Разработка игр</span><!--]--></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/compilers/" class="tm-hubs-list__link"><!--[--><span>Компиляторы</span><!--]--></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/c/" class="tm-hubs-list__link"><!--[--><span>C</span><!--]--></a><!--]--></li><!--]--><!----></ul></div></div><div class="article-donation-block"><div class="article-donation-block__message">Если эта публикация вас вдохновила и вы хотите поддержать автора — не&nbsp;стесняйтесь нажать на кнопку</div><button class="btn btn_solid btn_small tm-button tm-button_color-horizon article-donation-block__button" type="button"><!--[--><!--[-->Задонатить<!--]--><!--]--></button><!----></div><!--]--></article><!--]--></div><!----></div><div style="" class="tm-article-sticky-panel" data-test-id="article-sticky-panel"><div class="tm-data-icons tm-data-icons tm-data-icons_space-big tm-article-sticky-panel__icons" data-test-id="article-stats-icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon tm-votes-meter__icon_appearance-article" height="24" width="24"><title>Всего голосов 169: ↑169 и ↓0</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-rating"></use></svg><span class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_appearance-article tm-votes-meter__value_rating tm-votes-meter__value" data-test-id="votes-meter-value" title="Всего голосов 169: ↑169 и ↓0">+169</span></div><!--teleport start--><!--teleport end--><!----></div><!----><!----><button class="bookmarks-button tm-data-icons__item" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><span class="bookmarks-button__counter" title="Количество пользователей, добавивших публикацию в закладки">221</span></button><div class="tm-sharing tm-data-icons__item" title="Поделиться"><button class="tm-sharing__button" type="button"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="tm-sharing__icon"><path fill="currentColor" d="M13.8 13.8V18l7.2-6.6L13.8 5v3.9C5 8.9 3 18.6 3 18.6c2.5-4.4 6-4.8 10.8-4.8z"></path></svg></button><!--teleport start--><!--teleport end--></div><div class="tm-article-comments-counter-link tm-data-icons__item" title="Читать комментарии"><a href="/ru/articles/787442/comments/" class="tm-article-comments-counter-link__link" data-test-id="counter-comments"><!--[--><svg class="tm-svg-img tm-article-comments-counter-link__icon" height="24" width="24"><title>Комментарии</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-comments"></use></svg><span class="tm-article-comments-counter-link__value">65</span><!--]--></a><!----></div><!--[--><!--[--><!--[--><!----><!--]--><!--]--><!--]--><!--teleport start--><!--teleport end--><!----></div></div></div><!--[--><!--]--><div class="tm-article-presenter__footer"><!--[--><!--[--><div class="tm-article-blocks"><!----><!--[--><section class="tm-block tm-block tm-block_spacing-bottom"><!----><!--[--><div class="tm-block__body tm-block__body tm-block__body_variant-balanced"><!--[--><div class="tm-article-author" data-test-id="article-author-info"><!--[--><!--]--><div class="tm-user-card tm-user-card tm-user-card_variant-article tm-article-author__user-card" data-async-called="true"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/haqreu/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" src="//habrastorage.org/getpro/habr/avatars/94a/ae6/d03/94aae6d03dfb408e5f26bc21f42b49b6.png"></div></a><div class="tm-user-card__meta"><div class="tm-counter-container tm-karma tm-karma" title=" 630 голосов "><div class="tm-counter-container__header"><!--[--><div class="karma-display positive" data-v-7635202e>550</div><!----><!--]--></div><div class="tm-counter-container__footer"><!--[--><div class="tm-karma__text">Карма</div><!--teleport start--><!--teleport end--><!--]--></div></div><div class="tm-counter-container" title="Рейтинг пользователя"><div class="tm-counter-container__header"><!--[--><!--[--><!--]--><div class="tm-votes-lever tm-votes-lever tm-votes-lever_appearance-rating"><!----><div class="tm-votes-lever__score tm-votes-lever__score_appearance-rating tm-votes-lever__score"><!--[--><span><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter_rating tm-votes-lever__score-counter" data-test-id="votes-score-counter">0.2</span></span><!--]--></div><!----></div><!--]--></div><div class="tm-counter-container__footer"><!--[--><span class="tm-rating__text tm-rating__text">Рейтинг</span><!--]--></div></div></div></div></div><div class="tm-user-card__info tm-user-card__info_variant-article tm-user-card__info"><div class="tm-user-card__title tm-user-card__title_variant-article tm-user-card__title"><!----><a href="/ru/users/haqreu/" class="tm-user-card__nickname tm-user-card__nickname tm-user-card__nickname_variant-article"> @haqreu</a><!----></div><p class="tm-user-card__short-info tm-user-card__short-info_variant-article tm-user-card__short-info" data-test-id="user-card-speciality">Довожу здравый смысл до абсурда</p></div></div><div class="tm-user-card__buttons tm-user-card__buttons_variant-article tm-user-card__buttons"><!----><div class="tm-user-card__button"><div class="tm-button-follow tm-user-card__button-follow"><!----><button class="tm-button-follow__button tm-button-follow__button_big" data-test-id="follow-button" type="button">Подписаться</button></div></div><!----><div class="tm-user-card__button tm-user-card__button_write" data-test-id="user-card-conversations"><svg class="tm-svg-img tm-user-card__button-icon" height="16" width="16"><title>Отправить сообщение</title><use xlink:href="/img/megazord-v28.7909a852..svg#mail"></use></svg></div><!----></div><!----></div><!----></div><!--]--></div><!--]--><!----></section><!----><!--[--><div class="banner-wrapper leaderboard tm-page-article__banner" style="--8c60b148:200px;--27848d7d:auto;" data-v-bf8a3ee7><!--[--><div class="placeholder-wrapper placeholder" data-v-bf8a3ee7><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="adfox-banner-placeholder leaderboard" data-v-12f7bcca><div class="image loads" data-v-12f7bcca></div><div class="lines" data-v-12f7bcca><div class="line loads" data-v-12f7bcca></div><div class="line loads" data-v-12f7bcca></div><div class="line loads" data-v-12f7bcca></div></div></div></div><div id="adfox_164725660339535756" class="tm-adfox-banner" data-v-bf8a3ee7></div><!--]--></div><!--]--><!--]--><div class="tm-article-blocks__comments"><div id="publication-comments" class="tm-article-page-comments"><div data-async-called="true" data-server-rendered="true"><div class="tm-article-comments" data-test-id="article-comments"><div class="tm-comments-wrapper"><div class="tm-comments-wrapper__wrapper"><header class="tm-comments-wrapper__header"><h2 class="tm-comments-wrapper__title">Комментарии <span class="tm-comments-wrapper__comments-count">65</span></h2><div class="tm-comments-wrapper__header-aside"><!--[--><!--[--><!----><button class="tm-rss-button tm-rss-button_comments-header"><span class="tm-svg-icon__wrapper tm-rss-button__icon"><svg class="tm-svg-img tm-svg-icon" height="16" width="16"><title>Скопировать ссылку на RSS</title><use xlink:href="/img/megazord-v28.7909a852..svg#rss"></use></svg></span></button><!----><!--]--><!--]--></div></header><div class="tm-comments-wrapper__inner"><!--[--><!--[--><!--[--><!--]--><!----><div class="tm-comments__tree" data-comments-list><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26405186" class="tm-comment-thread__target" name="comment_26405186"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-0"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-0" data-comment-body="26405186"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/rukhi7/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="rukhi7"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/003.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/rukhi7/" class="tm-user-info__username">rukhi7 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26405186"><time datetime="2024-01-21T16:44:10.000Z" title="2024-01-21, 19:44">21  янв  2024 в 19:44</time><svg class="tm-svg-img tm-comment-thread__icon-pencil" height="16" width="16"><title>Комментарий был изменен</title><use xlink:href="/img/megazord-v28.7909a852..svg#pencil-small"></use></svg></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><!----><!----></div></header><div class="tm-comment__body-content_muted tm-comment__body-content_v2 tm-comment__body-content" style="opacity:0.4;"><div xmlns="http://www.w3.org/1999/xhtml"><blockquote><p>можно ли полноценно программировать при помощи директивы <code>#define</code> в языке C?  </p></blockquote><p>может сначала нужно было ответить на вопрос: "А нужно ли?". Вроде как Дефайны не раз были объявлены воплощением зла в программировании? Хотя, без них и в самом модном С++100500+, все также никуда, кажется.</p><p>Хотя, может я что-то пропустил ... ? какой-то сбой в матрице?</p><p>Но вот для конструкций с битами в портах в embedded, лучше #define-ов не придумать, это точно. Я правда подзабыл как это было, никто не напомнит?</p><p></p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26405186"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26405188" class="tm-comment-thread__target" name="comment_26405188"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-1"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-1" data-comment-body="26405188"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/haqreu/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="haqreu"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/94a/ae6/d03/94aae6d03dfb408e5f26bc21f42b49b6.png" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/haqreu/" class="tm-user-info__username">haqreu <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26405188"><time datetime="2024-01-21T16:45:59.000Z" title="2024-01-21, 19:45">21  янв  2024 в 19:45</time><svg class="tm-svg-img tm-comment-thread__icon-pencil" height="16" width="16"><title>Комментарий был изменен</title><use xlink:href="/img/megazord-v28.7909a852..svg#pencil-small"></use></svg></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><blockquote><p>может сначала нужно было ответить на вопрос: "А нужно ли?". </p></blockquote><p>Вы серьёзно задаёте этот вопрос по тексту, опубликованному в хабе "ненормальное программирование"? Впрочем, даже если так, то некоторые техники, которые я показал, могут оказаться полезными много где.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26405188"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26405206" class="tm-comment-thread__target" name="comment_26405206"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-2"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-2" data-comment-body="26405206"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/rukhi7/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="rukhi7"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/003.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/rukhi7/" class="tm-user-info__username">rukhi7 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26405206"><time datetime="2024-01-21T16:53:15.000Z" title="2024-01-21, 19:53">21  янв  2024 в 19:53</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><blockquote><p>Вы серьёзно задаёте этот вопрос по тексту, опубликованному в хабе "ненормальное программирование"?  </p></blockquote><p>так я же на него, вроде как, сам и ответил:</p><blockquote><p>Хотя, без них и в самом модном С++100500+, все также никуда, кажется.</p></blockquote><p>Там есть другой вопрос, он намного интересней, мне кажется.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26405206"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><!--]--></div><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26405644" class="tm-comment-thread__target" name="comment_26405644"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-1"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-1" data-comment-body="26405644"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/danek12/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="danek12"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/015.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/danek12/" class="tm-user-info__username">danek12 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26405644"><time datetime="2024-01-21T19:52:48.000Z" title="2024-01-21, 22:52">21  янв  2024 в 22:52</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Часто при программировании под AVR использовал конструкции типа ON(PORT, N) и OFF(PORT, N). Сами конструкции были типа <em>(PORT|=(1&lt;&lt;N))</em> и (<em>PORT&amp;=~(1&lt;&lt;N)).</em>  </p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26405644"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26406294" class="tm-comment-thread__target" name="comment_26406294"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-2"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-2" data-comment-body="26406294"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/rukhi7/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="rukhi7"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/003.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/rukhi7/" class="tm-user-info__username">rukhi7 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26406294"><time datetime="2024-01-22T05:38:47.000Z" title="2024-01-22, 08:38">22  янв  2024 в 08:38</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>вроде не так, там что-то хитрое было, была задача и было решение. Что-то про PortA.3</p><p>PortB.5, DDRD.7, ...</p><p>Придется искать - найду, напишу позже.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26406294"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26407444" class="tm-comment-thread__target" name="comment_26407444"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-3"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-3" data-comment-body="26407444"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/SuperTEHb/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="SuperTEHb"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/051.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/SuperTEHb/" class="tm-user-info__username">SuperTEHb <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26407444"><time datetime="2024-01-22T10:02:39.000Z" title="2024-01-22, 13:02">22  янв  2024 в 13:02</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Такое, как минимум CVAVR умеет. Прикол АВРок в этом плане в том, что там есть специальные команды битового доступа до некоторой периферии. То есть в идеале мы должны получить одну машинную инструкцию на выходе, а не чтение-модификация-запись. Впрочем, и в СТМ32 есть похожий механизм. Если таки найдёте как грамотно внедрить такие конструкции, то буду признателен. </p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26407444"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26407788" class="tm-comment-thread__target" name="comment_26407788"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-4"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-4" data-comment-body="26407788"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/rukhi7/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="rukhi7"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/003.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/rukhi7/" class="tm-user-info__username">rukhi7 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26407788"><time datetime="2024-01-22T11:23:13.000Z" title="2024-01-22, 14:23">22  янв  2024 в 14:23</time><svg class="tm-svg-img tm-comment-thread__icon-pencil" height="16" width="16"><title>Комментарий был изменен</title><use xlink:href="/img/megazord-v28.7909a852..svg#pencil-small"></use></svg></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>как-то так было:</p><pre><code class="cpp">// Макросы
#define set_out2(port, bit) do { DDR ## port  |= (1&lt;&lt;bit) } while(0)
#define set_in2(port, bit) do { DDR ## port  &amp;= ~(1&lt;&lt;bit) } while(0)
#define on2(port, bit) do { PORT ## port  |= (1&lt;&lt;bit) } while(0)

#define set_out(...) set_out2(__VA_ARGS__)
#define set_in(...) set_in2(__VA_ARGS__)
#define on(...) on2(__VA_ARGS__)
// определяем порт (обратите внимание - задана буква порта, PORT/PIN/DDR приписываем к нему в макросах через ##)
#define W1 C, 5
 
// настраиваем порт
set_out(W1);
// используем
on(W1);</code></pre><p><a href="https://www.cyberforum.ru/avr/thread2085120.html?ysclid=lrotusre6p510994698" rel="noopener noreferrer nofollow">вот здесь</a> вот нашел что-то похожее на то что я имел ввиду. Но у меня не было __<strong>VA_ARGS__, </strong>это что-то и для меня уже новенькое.</p><p>Я сам уже с портами несколько лет ничего не писал, своих проектов не найду ни как.</p><p><strong>А! вот! по той же ссылке, найдите</strong>:</p><p>чтобы с компиляторозависимыми __VA_ARGS__ не связываться, можно просто еще раз в дополнительные макросы с одним аргументом обернуть:  </p><p>...</p><p>Вот такого вида дефайны имелись в виду, по крайней мере очень похоже на то что меня когда-то впечатлило.</p><p></p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26407788"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26407924" class="tm-comment-thread__target" name="comment_26407924"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-5"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-5" data-comment-body="26407924"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/SuperTEHb/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="SuperTEHb"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/051.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/SuperTEHb/" class="tm-user-info__username">SuperTEHb <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26407924"><time datetime="2024-01-22T12:02:11.000Z" title="2024-01-22, 15:02">22  янв  2024 в 15:02</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Эх, а я уж губу раскатал на прямой битовый доступ. </p><p>Вместо подобных "функций" с передачей порта и бита себе сразу пишу конструкции типа</p><pre><code class="cpp">#define LedON() GPIOB-&gt;BSRR |= GPIO_BSRR_BS_1
#define LedOFF() GPIOB-&gt;BSRR |= GPIO_BSRR_BR_1</code></pre><p>Просто потому что знаю, что в данном конкретном проекте у меня светодиод висит на первой ноге порта Б и в процессе работы никуда не девается. Это для СТМов, где есть специальный регистр для изменения отдельных битов порта, не затрагивающий другие. Тоже получается чисто запись, а не чтение-модификация-запись.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26407924"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26408120" class="tm-comment-thread__target" name="comment_26408120"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-6"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-6" data-comment-body="26408120"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/rukhi7/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="rukhi7"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/003.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/rukhi7/" class="tm-user-info__username">rukhi7 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26408120"><time datetime="2024-01-22T12:48:13.000Z" title="2024-01-22, 15:48">22  янв  2024 в 15:48</time><svg class="tm-svg-img tm-comment-thread__icon-pencil" height="16" width="16"><title>Комментарий был изменен</title><use xlink:href="/img/megazord-v28.7909a852..svg#pencil-small"></use></svg></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><blockquote><p>Тоже получается чисто запись, а не чтение-модификация-запись.  </p></blockquote><p>там дело не в этом, а в том что когда функция (светодиод например, или управление кем то) перетаскивается с одной ноги на другую, не надо по всему проекту строчки искать которые ее используют, просто меняете в дефайне номер порта и номер пина. На самом деле это очень полезная штука, и в коде лучше понятно с какой функцией мы работаем.</p><p>Типа так:</p><p>вместо LedON()   </p><p>TurnOn(LedX)</p><p>соответственно можно для какого-нибудь ControlY</p><p>TurnOn(ControlY)</p><p>То есть не надо для каждой ноги свой Дефайн писать!</p><p>И функции в одном месте по ногам выписаны в виде порт:пин - вот это меня особенно порадовало, я помню, когда у меня такой список в коде появился!</p><p></p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26408120"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26408202" class="tm-comment-thread__target" name="comment_26408202"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-7"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-7" data-comment-body="26408202"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/SuperTEHb/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="SuperTEHb"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/051.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/SuperTEHb/" class="tm-user-info__username">SuperTEHb <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26408202"><time datetime="2024-01-22T13:02:20.000Z" title="2024-01-22, 16:02">22  янв  2024 в 16:02</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Так ведь та же история и выходит. Что LedX определить, что LedON() сделать. Всё в main.h какой-нибудь вынести, вот в одном месте и получается. Не вижу явных плюсов или минусов.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26408202"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26408302" class="tm-comment-thread__target" name="comment_26408302"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-8"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-8" data-comment-body="26408302"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/rukhi7/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="rukhi7"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/003.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/rukhi7/" class="tm-user-info__username">rukhi7 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26408302"><time datetime="2024-01-22T13:21:30.000Z" title="2024-01-22, 16:21">22  янв  2024 в 16:21</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><blockquote><p>Что LedX определить, что LedON() сделать.  </p></blockquote><p>ну так плюсы появляются когда у вас много пинов с разными функциями как пины используются. Когда у вас Led1 .. Led9 и</p><p>например, Key1 .. Key 5</p><p>и фиг знает какие еще пины, в общем если есть штук десять пинов в работе, и если их просто начинаешь проверять-искать по всему коду или</p><p>они у тебя определены как дефайны и подписаны как функции ноги, и используются везде только по имени функции</p><p>то чуствуешь разницу с таким подходом.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26408302"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26408374" class="tm-comment-thread__target" name="comment_26408374"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-9"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-9" data-comment-body="26408374"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/SuperTEHb/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="SuperTEHb"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/051.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/SuperTEHb/" class="tm-user-info__username">SuperTEHb <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26408374"><time datetime="2024-01-22T13:39:44.000Z" title="2024-01-22, 16:39">22  янв  2024 в 16:39</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><blockquote><p>начинаешь проверять-искать по всему коду  </p></blockquote><p>У нас явно возникло какое-то досадное недопонимание. Зачем по всему? Один раз дефайном объявляется LedON() на светодиод, или наоборот, всякие IsEnable() для опроса состояния ноги-входа и всё, дальше уже используются. При изменении порта все правки по-прежнему происходят в одном месте. Хоть одна нога, хоть десять, всё равно все правки ровно однократные и в одном месте. Точно так же, как однократно объявить TurnOn() и пучок LedX.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26408374"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26408440" class="tm-comment-thread__target" name="comment_26408440"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-10"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-10" data-comment-body="26408440"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/rukhi7/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="rukhi7"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/003.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/rukhi7/" class="tm-user-info__username">rukhi7 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26408440"><time datetime="2024-01-22T13:54:21.000Z" title="2024-01-22, 16:54">22  янв  2024 в 16:54</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><blockquote><p>Один раз дефайном объявляется LedON() на светодиод  </p></blockquote><p>а если у нас три светодиода?</p><p>Но все это конечно не чудо, вопрос только в том есть ли желание попробовать другую технику. Вы решили что вам не к чему. Я уважаю ваше решение.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26408440"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><!--]--></div><!----></section><!--]--></div><!----></section><!--]--></div><!----></section><!--]--></div><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26414868" class="tm-comment-thread__target" name="comment_26414868"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-6"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-6" data-comment-body="26414868"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/Dark_Purple/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="Dark_Purple"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/1fc/f32/92e/1fcf3292efe1c8ec6d10a74710d74da5.jpg" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/Dark_Purple/" class="tm-user-info__username">Dark_Purple <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26414868"><time datetime="2024-01-23T22:01:14.000Z" title="2024-01-24, 01:01">24  янв  2024 в 01:01</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><pre><code>
/*******************************************************************************
  port
*******************************************************************************/
// port 
#define A0_PORT                 GPIOA
#define A1_PORT                 GPIOA
...
..

/*******************************************************************************
  pin
*******************************************************************************/
// port A
#define A0_PIN                  GPIO_PIN_0
#define A1_PIN                  GPIO_PIN_1
...
..

/*******************************************************************************
  macro
*******************************************************************************/

#define GPIO_PORT_(x)           x##_PORT
#define GPIO_PIN_(x)            x##_PIN
#define GPIO_PORT_NUM_(x)       x##_PORT_NUM
#define GPIO_PIN_NUM_(x)        x##_PIN_NUM

#define GPIO_PORT(x)            GPIO_PORT_(x)
#define GPIO_PIN(x)             GPIO_PIN_(x)
#define GPIO_PORT_NUM(x)        GPIO_PORT_NUM_(x)
#define GPIO_PIN_NUM(x)         GPIO_PIN_NUM_(x)

//pin config
#define GPIO_CONFIG_IN_M(pin)           (GPIO_PORT_(pin)-&gt;MODER &amp;= ~(3U&lt;&lt;(2*GPIO_PIN_NUM_(pin))))
#define GPIO_CONFIG_OUT_M(pin)          (GPIO_PORT_(pin)-&gt;MODER |= 1&lt;&lt;(2*GPIO_PIN_NUM_(pin)))

// pin set
#define GPIO_READ_PIN_M(pin)            (GPIO_PORT_(pin)-&gt;IDR &amp; GPIO_PIN_(pin))
#define GPIO_SET_PIN_M(pin)             (GPIO_PORT_(pin)-&gt;BSRR = GPIO_PIN_(pin))
#define GPIO_RESET_PIN_M(pin)           (GPIO_PORT_(pin)-&gt;BRR = GPIO_PIN_(pin))

// port set
#define GPIO_SET_PORT_M(port, value)    (port-&gt;BSRR = value)
#define GPIO_RESET_PORT_M(port, value)  (port-&gt;BRR = value)
#define GPIO_ASSIGN_PORT_M(port, value) (port-&gt;ODR = value)

//работает так
#define LED_RED    A1  
GPIO_SET_PIN_M(LED_RED)</code></pre><p></p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26414868"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26415564" class="tm-comment-thread__target" name="comment_26415564"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-7"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-7" data-comment-body="26415564"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/rukhi7/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="rukhi7"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/003.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/rukhi7/" class="tm-user-info__username">rukhi7 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26415564"><time datetime="2024-01-24T05:47:29.000Z" title="2024-01-24, 08:47">24  янв  2024 в 08:47</time><svg class="tm-svg-img tm-comment-thread__icon-pencil" height="16" width="16"><title>Комментарий был изменен</title><use xlink:href="/img/megazord-v28.7909a852..svg#pencil-small"></use></svg></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>ага, вот оно. А я только версию для АВР-ов раньше видел значит, эта еще интереснее. </p><p></p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26415564"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><!--]--></div><!----></section><!--]--></div><!----></section><!--]--></div><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26408928" class="tm-comment-thread__target" name="comment_26408928"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-4"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-4" data-comment-body="26408928"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/dmitrystu/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="dmitrystu"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/96b/5ea/651/96b5ea6519d045185faf85f276fa2ce0.png" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/dmitrystu/" class="tm-user-info__username">dmitrystu <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26408928"><time datetime="2024-01-22T16:00:10.000Z" title="2024-01-22, 19:00">22  янв  2024 в 19:00</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Это называется Bit-Banding. Грамотно внедрить его можете сами, достаточно немного почитать документацию. А еще есть такие полезные регистры в GPIO как BSRR и BRR, которые позволяют менять состояния пинов без RMW.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26408928"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26412266" class="tm-comment-thread__target" name="comment_26412266"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-5"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-5" data-comment-body="26412266"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/SuperTEHb/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="SuperTEHb"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/051.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/SuperTEHb/" class="tm-user-info__username">SuperTEHb <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26412266"><time datetime="2024-01-23T11:20:26.000Z" title="2024-01-23, 14:20">23  янв  2024 в 14:20</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>В СТМах без проблем, там, как вы и пишете, отдельные регистры для таких манёвров. А вот в АВРах не регистр, а отдельная команда. Это было бы интереснее из С.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26412266"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26413278" class="tm-comment-thread__target" name="comment_26413278"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-6"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-6" data-comment-body="26413278"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/dmitrystu/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="dmitrystu"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/96b/5ea/651/96b5ea6519d045185faf85f276fa2ce0.png" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/dmitrystu/" class="tm-user-info__username">dmitrystu <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26413278"><time datetime="2024-01-23T14:38:03.000Z" title="2024-01-23, 17:38">23  янв  2024 в 17:38</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>AVR вообще значительно проще устроен. Я не только про ядро, я про вообще. Такие штуки зависят от реализации конкретной периферии в конкретном микроконтроллере, ну или в серии.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26413278"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><!--]--></div><!----></section><!--]--></div><!----></section><!--]--></div><!----></section><!--]--></div><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26437056" class="tm-comment-thread__target" name="comment_26437056"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-2"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-2" data-comment-body="26437056"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/Chernysh_Aleksandr/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="Chernysh_Aleksandr"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/049.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/Chernysh_Aleksandr/" class="tm-user-info__username">Chernysh_Aleksandr <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26437056"><time datetime="2024-01-29T14:09:23.000Z" title="2024-01-29, 17:09">29  янв  2024 в 17:09</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>sbi и cbi</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26437056"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><!--]--></div><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26406774" class="tm-comment-thread__target" name="comment_26406774"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-1"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-1" data-comment-body="26406774"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/RranAmaru/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="RranAmaru"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/454/e65/07a/454e6507ae62d809ba66a47e58fe017e.png" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/RranAmaru/" class="tm-user-info__username">RranAmaru <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26406774"><time datetime="2024-01-22T07:11:31.000Z" title="2024-01-22, 10:11">22  янв  2024 в 10:11</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Ну чинить часы молотком также неудобно как и забивать гвозди микроскопом. Если использовать препроцессор не по назначению, то конечно он будет для вас "злом".</p><p>Для данного хаба - самое то!</p><p>Я в далеком 2005 и сам занимался подобными <a href="https://rranamaru.blogspot.com/2013/07/blog-post_10.html" rel="noopener noreferrer nofollow">извращениями</a>.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26406774"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><!--]--></div><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26405400" class="tm-comment-thread__target" name="comment_26405400"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-0"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-0" data-comment-body="26405400"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/ImagineTables/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="ImagineTables"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/102.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/ImagineTables/" class="tm-user-info__username">ImagineTables <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26405400"><time datetime="2024-01-21T18:09:26.000Z" title="2024-01-21, 21:09">21  янв  2024 в 21:09</time><svg class="tm-svg-img tm-comment-thread__icon-pencil" height="16" width="16"><title>Комментарий был изменен</title><use xlink:href="/img/megazord-v28.7909a852..svg#pencil-small"></use></svg></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><!----><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Всё, описанное в статье, невероятно круто.</p><p>Я тут подумал… Интересно, а есть ли альтернативные встроенному препроцессоры, заточенные под C/++, как LESS заточен под CSS? И что с их помощью можно было бы сделать, если бы они были? (Да, вот такая упячная постановка вопроса в духе «Есть ли жизнь на Марсе и как с ней бороться?» ;).</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26405400"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26406596" class="tm-comment-thread__target" name="comment_26406596"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-1"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-1" data-comment-body="26406596"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/ImagineTables/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="ImagineTables"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/102.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/ImagineTables/" class="tm-user-info__username">ImagineTables <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26406596"><time datetime="2024-01-22T06:12:49.000Z" title="2024-01-22, 09:12">22  янв  2024 в 09:12</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Я вчера немножко наспех и левой ногой написал этот комментарий, и хочу дополнить.</p><p>Если встроенный препроцессор настолько ограничен, что автору пришлось всеми правдами и неправдами добиваться от него каких-то примитивных вещей, так неужели никто не думал написать свой, где рекурсия и прочее шли бы из коробки?</p><p>А спрашивая «Для чего?», я имел в виду следующее. Я знаю, для чего он пригодился бы <em>мне</em>. Но мне интересно послушать, как бы его использовали другие.</p><p>Для чего он пригодился бы мне: мне давно не хватает нормальных макросов. Скажем, недавно тут публиковалась статья с примером такого ошибочного кода:</p><pre><code>void adns__querysend_tcp(adns_query qu, struct timeval now) {
  ...
  if (!(errno == EAGAIN || EWOULDBLOCK || 
        errno == EINTR || errno == ENOSPC ||
        errno == ENOBUFS || errno == ENOMEM)) {
  ...
}
</code></pre><p>Чтобы не допускать ошибок, предлагалось правильно форматировать код. С моей точки зрения, если эта ошибка — рак поджелудочной железы, то форматирование — это свекольный сок. А химиотерапией был бы <code>is in set</code>. Только вот как его сделать? Единственное адекватное решение, которое мне предложили, когда я задал этот вопрос, включало в себя шаблоны и вызов функции. Шаблонам в нешаблонном коде делать нечего, это семантически неправильно и эстетически отвратительно, а оптимизация вызова всё ещё зависит от выбора правильного компилятора (и это не студия). И, конечно же, ни в какой стандартной библиотеке этой жизненно необходимой для избежания ошибок штуки нет.</p><details class="spoiler"><summary>Предложенный вариант на шаблонах</summary><div class="spoiler__content"><pre><code>// © vopl
#include &lt;errno.h&gt;

template &lt;auto... set&gt;
bool isin(auto val)
{
    return (false || ... || (set == val));
}

int main() 
{
    // 
    if(isin&lt;EAGAIN,
            EWOULDBLOCK,
            EINTR,
            ENOSPC,
            ENOBUFS,
            ENOMEM&gt;(errno))
    {
        return 0;
    }

    return 1;
}
</code></pre></div></details><p>Правда, таскать дополнительный препроцессор это тот ещё геморрой, но если правильно его встроить в IDE, можно было бы видеть результирующий код только при отладке.</p><p>Что такое <a href="https://lesscss.org/" rel="noopener noreferrer nofollow">LESS</a> и CSS, я думаю, все знают и так, и почему я про них вспомнил — тоже.</p><p>В общем, чем дольше я думаю, тем больше хочу такой инструмент. Даже жаль, что в написании препроцессоров до автора мне далеко.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26406596"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26406788" class="tm-comment-thread__target" name="comment_26406788"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-2"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-2" data-comment-body="26406788"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/unreal_undead2/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="unreal_undead2"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/018.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/unreal_undead2/" class="tm-user-info__username">unreal_undead2 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26406788"><time datetime="2024-01-22T07:14:09.000Z" title="2024-01-22, 10:14">22  янв  2024 в 10:14</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><blockquote><p>так неужели никто не думал написать свой, где рекурсия и прочее шли бы из коробки?  </p></blockquote><p>Ну вроде m4 помощнее будет (хотя руками я его не щупал).</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26406788"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26407022" class="tm-comment-thread__target" name="comment_26407022"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-3"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-3" data-comment-body="26407022"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/ImagineTables/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="ImagineTables"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/102.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/ImagineTables/" class="tm-user-info__username">ImagineTables <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26407022"><time datetime="2024-01-22T08:16:51.000Z" title="2024-01-22, 11:16">22  янв  2024 в 11:16</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Спасибо, не слышал про такой. Он, кстати, через три года будет праздновать юбилей — 50 лет ))</p><p>Я думал про что-нибудь более заточенное под задачу и более современное.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26407022"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><!--]--></div><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26409676" class="tm-comment-thread__target" name="comment_26409676"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-2"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-2" data-comment-body="26409676"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/Woodroof/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="Woodroof"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/410/8d8/cb9/4108d8cb918a909606cf038b6cfb2892.png" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/Woodroof/" class="tm-user-info__username">Woodroof <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26409676"><time datetime="2024-01-22T19:31:57.000Z" title="2024-01-22, 22:31">22  янв  2024 в 22:31</time><svg class="tm-svg-img tm-comment-thread__icon-pencil" height="16" width="16"><title>Комментарий был изменен</title><use xlink:href="/img/megazord-v28.7909a852..svg#pencil-small"></use></svg></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Можно без шаблонов (если не считать таковым сам initializer_list) и читабельнее:</p><pre><code>bool in(const int test_value, const std::initializer_list&lt;int&gt; values) {
  for (const auto &amp; value : values)
  {
    if (test_value == value)
    {
      return true;
    }
  }

  return false;
}
// И где-то ниже
if (!in(errno, {EAGAIN, EWOULDBLOCK, EINTR, ENOSPC, ENOBUFS, ENOMEM}))</code></pre><p>Хотя ещё лучше сделать in шаблоном и вместо int использовать T.<br/>Но в любом случае это не шаблоны на списке типов, где каждый новый список - это новая сгенерированная функция.<br/>А вообще в c++ появляется всё больше разного для замены макросов. И в шаблонах, и, например, constexpr/consteval для вычисления в compile time.</p><p></p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26409676"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26410230" class="tm-comment-thread__target" name="comment_26410230"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-2"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-2" data-comment-body="26410230"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/VADemon/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="VADemon"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/f4f/22d/c44/f4f22dc442931200c06fe18fb99e023a.png" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/VADemon/" class="tm-user-info__username">VADemon <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26410230"><time datetime="2024-01-22T23:47:01.000Z" title="2024-01-23, 02:47">23  янв  2024 в 02:47</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Конкретно в этом случае (если там условно только return false) как раз switch-case с fallthrough подходит? Но если развивать идею, то куски кода побольше уже в нужный case не засунешь. А выпригивать из switch в опрятный код ничем не лучше.</p><p>Честно, конструкция понравилась. Странно, что её нет в языках.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26410230"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26411000" class="tm-comment-thread__target" name="comment_26411000"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-3"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-3" data-comment-body="26411000"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/ImagineTables/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="ImagineTables"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/102.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/ImagineTables/" class="tm-user-info__username">ImagineTables <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26411000"><time datetime="2024-01-23T07:15:19.000Z" title="2024-01-23, 10:15">23  янв  2024 в 10:15</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>switch не подходит по многим причинам.</p><p>Во-первых, как мне было указано, в некоторых реализациях некоторые значения множеств из приведённого примера совпадают, а это приведёт к ошибке компиляции.</p><p>Во-вторых, цель в том, чтобы уменьшить число ошибок, а если заниматься тем, что выражать отрицание через default, по-моему, ошибок в итоге будет больше.</p><p>В-третьих, и вообще, выразительность хромает.</p><blockquote><p>Честно, конструкция понравилась. Странно, что её нет в языках.</p></blockquote><p>Именно потому мне и не хватает нормальных макросов.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26411000"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><!--]--></div><!----></section><!--]--></div><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26408370" class="tm-comment-thread__target" name="comment_26408370"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-1"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-1" data-comment-body="26408370"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/Kelbon/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="Kelbon"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/004.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/Kelbon/" class="tm-user-info__username">Kelbon <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26408370"><time datetime="2024-01-22T13:38:23.000Z" title="2024-01-22, 16:38">22  янв  2024 в 16:38</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>я добавлял рекурсию в макросы в ллвм, но как-то всё остановилось, т.к. все боятся препроцессора как огня (в коммитете)<br/><br/><a href="https://github.com/llvm/llvm-project/pull/65851" rel="noopener noreferrer nofollow">https://github.com/llvm/llvm-project/pull/65851</a></p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26408370"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26412504" class="tm-comment-thread__target" name="comment_26412504"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-1"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-1" data-comment-body="26412504"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/Gryphon88/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="Gryphon88"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/056.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/Gryphon88/" class="tm-user-info__username">Gryphon88 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26412504"><time datetime="2024-01-23T12:13:34.000Z" title="2024-01-23, 15:13">23  янв  2024 в 15:13</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Упоминали М4, но он ужасен. Общий принцип: если хотите сложную кодогенерацию, лучше взять условный питон и засунуть его в prebuild шаг сборки. Отладка макросов это очень больно.</p><p>В принципе, можно сломать мозг и попробовать осмыслить препроцессор как РЕФАЛ-машину с её подстановками и без присваивания, но практический смысл околонулевой.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26412504"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26412736" class="tm-comment-thread__target" name="comment_26412736"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-2"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-2" data-comment-body="26412736"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/ImagineTables/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="ImagineTables"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/102.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/ImagineTables/" class="tm-user-info__username">ImagineTables <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26412736"><time datetime="2024-01-23T12:55:10.000Z" title="2024-01-23, 15:55">23  янв  2024 в 15:55</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><blockquote><p>если хотите сложную кодогенерацию, лучше взять условный питон</p></blockquote><p>ИМХО, в этом вопросе главное — синтаксис и стоящие за ним идеи (у меня их нет), а не то, на чём и как это писать.</p><blockquote><p>Отладка макросов это очень больно.</p></blockquote><p>Опять же ИМХО, но это касается только встроенного препроцессора. (Вроде бы, студию вообще нельзя заставить выдать код после обработки). Если сделать внешний препроцессор в виде плагина к IDE, чтобы он при отладке переключался на сгенерированный код, откуда возьмётся боль?</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26412736"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26412784" class="tm-comment-thread__target" name="comment_26412784"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-3"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-3" data-comment-body="26412784"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/Gryphon88/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="Gryphon88"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/056.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/Gryphon88/" class="tm-user-info__username">Gryphon88 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26412784"><time datetime="2024-01-23T13:03:20.000Z" title="2024-01-23, 16:03">23  янв  2024 в 16:03</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>про питон это я в целях удобства и понимаемости, чтобы писать "шаблоны" в той же парадигме, что и остальной код. Касательно отладки макросов: пока все просто, понятно, во что развернется макрос, а вот если попробуете добавить в код полиформизм с помощью макросов или еще что хитрое, там начинается конкатенация токенов, в итоге вы ловите ошибку компиляции из-за криво развернувшегося макроса, а почему он криво развернулся - только руками, ide поможет слабо, максимум - пошаговым разворачиванием.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26412784"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26412860" class="tm-comment-thread__target" name="comment_26412860"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-4"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-4" data-comment-body="26412860"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/ImagineTables/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="ImagineTables"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/102.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/ImagineTables/" class="tm-user-info__username">ImagineTables <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26412860"><time datetime="2024-01-23T13:15:20.000Z" title="2024-01-23, 16:15">23  янв  2024 в 16:15</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Теперь я понял.</p><p>Нуууууууу… это как с шаблонными классами и алгоритмами, ИМХО. В том смысле, что нормальный (в математическом смысле) прикладник ими только пользуется. Конечно, это не C++ way, но лично я был бы счастлив.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26412860"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26413236" class="tm-comment-thread__target" name="comment_26413236"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-4"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-4" data-comment-body="26413236"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/unreal_undead2/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="unreal_undead2"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/018.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/unreal_undead2/" class="tm-user-info__username">unreal_undead2 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26413236"><time datetime="2024-01-23T14:30:03.000Z" title="2024-01-23, 17:30">23  янв  2024 в 17:30</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><blockquote><p>чтобы писать "шаблоны" в той же парадигме, что и остальной код  </p></blockquote><p>C/C++ с препроцессингом на питоне - это скорее адская смесь, чем общая парадигма. Тут хороший пример - Лисп, где макросы пишутся на том же языке, что основной код, и синтаксис просто мапится на удобные для обработки структуры данных - но не всем такой синтаксис нравится )</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26413236"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26413358" class="tm-comment-thread__target" name="comment_26413358"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-5"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-5" data-comment-body="26413358"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/Gryphon88/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="Gryphon88"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/056.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/Gryphon88/" class="tm-user-info__username">Gryphon88 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26413358"><time datetime="2024-01-23T14:51:16.000Z" title="2024-01-23, 17:51">23  янв  2024 в 17:51</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Лисп, конечно, идеал, но питон на С похож больше, чем собственный сёвый препроцессор)</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26413358"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><!--]--></div><!----></section><!--]--></div><!----></section><!--]--></div><!----></section><!--]--></div><!----></section><!--]--></div><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26405402" class="tm-comment-thread__target" name="comment_26405402"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-0"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-0" data-comment-body="26405402"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/NickDoom/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="NickDoom"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/getpro/habr/avatars/154/f53/85b/154f5385b6b485771c93d1c1b86a293e.gif" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/NickDoom/" class="tm-user-info__username">NickDoom <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26405402"><time datetime="2024-01-21T18:10:09.000Z" title="2024-01-21, 21:10">21  янв  2024 в 21:10</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><!----><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><blockquote><p>в несколько секунд скажет, во что должен скомпилироваться нижеприведённый весьма тривиальный код</p></blockquote><p>В слёзы :-D</p><p>Пару секунд прикидывал, сколько раз оно само с собой сложится, и тут заметил, что там ноль :-D</p><p>Это не просто программистская шутка, это классический анекдот с классической концовкой-переворотом, и несмотря на язык, на котором этот анекдот написан — я ржал как <s>конь</s> <s>идиот</s> конь-идиот :-D</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26405402"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26405646" class="tm-comment-thread__target" name="comment_26405646"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-1"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-1" data-comment-body="26405646"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/Tihron/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="Tihron"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/029.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/Tihron/" class="tm-user-info__username">Tihron <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26405646"><time datetime="2024-01-21T19:52:50.000Z" title="2024-01-21, 22:52">21  янв  2024 в 22:52</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Будет 2^63 - 1 сложений. Нуля :)</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26405646"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26406802" class="tm-comment-thread__target" name="comment_26406802"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-1"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-1" data-comment-body="26406802"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/Gummilion/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="Gummilion"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/146.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/Gummilion/" class="tm-user-info__username">Gummilion <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26406802"><time datetime="2024-01-22T07:16:29.000Z" title="2024-01-22, 10:16">22  янв  2024 в 10:16</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Да, классическая задача с зернышками на шахматной доске (там же неспроста 64 макроса?), только на первой клетке... 0 зернышек!</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26406802"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><!--]--></div><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26406062" class="tm-comment-thread__target" name="comment_26406062"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-0"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-0" data-comment-body="26406062"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/iStyx/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="iStyx"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/478/2d5/275/4782d527566cfe58b2201b2e89539e2a.jpg" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/iStyx/" class="tm-user-info__username">iStyx <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26406062"><time datetime="2024-01-22T01:21:54.000Z" title="2024-01-22, 04:21">22  янв  2024 в 04:21</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><!----><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Сишный код вывел "3 2 1 0", а версия на макросах "3 2 1".</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26406062"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26406254" class="tm-comment-thread__target" name="comment_26406254"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-1"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-1" data-comment-body="26406254"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/haqreu/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="haqreu"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/94a/ae6/d03/94aae6d03dfb408e5f26bc21f42b49b6.png" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/haqreu/" class="tm-user-info__username">haqreu <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26406254"><time datetime="2024-01-22T05:16:12.000Z" title="2024-01-22, 08:16">22  янв  2024 в 08:16</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Да, действительно, в макросах у меня нет принта при d==0. Сейчас поправлю. Спасибо!</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26406254"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><!--]--></div><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26406186" class="tm-comment-thread__target" name="comment_26406186"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-0"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-0" data-comment-body="26406186"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/DimaFromMai/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="DimaFromMai"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/c20/f41/b39/c20f41b392af46c8812705d3baf73277.jpg" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/DimaFromMai/" class="tm-user-info__username">DimaFromMai <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26406186"><time datetime="2024-01-22T04:27:41.000Z" title="2024-01-22, 07:27">22  янв  2024 в 07:27</time><svg class="tm-svg-img tm-comment-thread__icon-pencil" height="16" width="16"><title>Комментарий был изменен</title><use xlink:href="/img/megazord-v28.7909a852..svg#pencil-small"></use></svg></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><!----><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Просто вопрос, правда не совсем в тему, интересно, может кто знает, когда делали старые игры, например Sonic, там же получается так же делали анимацию? Если да, то просто не представляю даже, чего стоило такие игры делать, во времена то были.<br/> </p><figure class=""><img src="https://habrastorage.org/getpro/habr/comment_images/57f/857/649/57f857649b5ca996b87131988fe2dee4.gif" alt="Sonic the Hedgehog" data-src="https://habrastorage.org/getpro/habr/comment_images/57f/857/649/57f857649b5ca996b87131988fe2dee4.gif"/><div><figcaption>Sonic the Hedgehog</figcaption></div></figure></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26406186"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26406250" class="tm-comment-thread__target" name="comment_26406250"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-1"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-1" data-comment-body="26406250"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/y_n_vasya/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="y_n_vasya"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/a96/172/8b6/a961728b611d3684008a4e2701ade189.png" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/y_n_vasya/" class="tm-user-info__username">y_n_vasya <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26406250"><time datetime="2024-01-22T05:14:32.000Z" title="2024-01-22, 08:14">22  янв  2024 в 08:14</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Насколько я помню, для анимирования использовалась циклическая смена палитры тайлов, поэтому так и создаётся эффект воды и водопада. <br/><br/>Хитрые приёмы, зато как классно работают) Можно почитать здесь на счёт архетектуры и приёмов в Genesis, если интересно: <a href="https://habr.com/ru/articles/471914/" rel="noopener noreferrer nofollow">https://habr.com/ru/articles/471914/</a><br/></p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/b20/38a/0b7/b2038a0b7a34901a44cb785557da975b.png" width="1102" height="848" data-src="https://habrastorage.org/getpro/habr/upload_files/b20/38a/0b7/b2038a0b7a34901a44cb785557da975b.png"/></figure><p></p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26406250"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26406252" class="tm-comment-thread__target" name="comment_26406252"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-1"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-1" data-comment-body="26406252"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/adcsan/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="adcsan"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/346/e06/f59/346e06f59e972a2bffc9006658e99943.jpg" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/adcsan/" class="tm-user-info__username">adcsan <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26406252"><time datetime="2024-01-22T05:14:39.000Z" title="2024-01-22, 08:14">22  янв  2024 в 08:14</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Недавно читал тут на хабре <a href="https://habr.com/ru/companies/ruvds/articles/775202/" rel="noopener noreferrer nofollow">статью про палитровую анимацию</a>, несколько примеров как-раз из Cоника было.</p><p></p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26406252"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26406562" class="tm-comment-thread__target" name="comment_26406562"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-1"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-1" data-comment-body="26406562"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/haqreu/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="haqreu"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/94a/ae6/d03/94aae6d03dfb408e5f26bc21f42b49b6.png" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/haqreu/" class="tm-user-info__username">haqreu <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26406562"><time datetime="2024-01-22T06:01:21.000Z" title="2024-01-22, 09:01">22  янв  2024 в 09:01</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Игры во все времена выжимали и продолжают выжимать из железа максимум возможного. Другой вопрос, что тридцать лет назад инструменты были настолько убогими, что даже с простой архитектурой железа достигнутые результаты меня впечатляют до сих пор.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26406562"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26430166" class="tm-comment-thread__target" name="comment_26430166"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-2"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-2" data-comment-body="26430166"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/pluton_tut/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="pluton_tut"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/119.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/pluton_tut/" class="tm-user-info__username">pluton_tut <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26430166"><time datetime="2024-01-27T19:35:06.000Z" title="2024-01-27, 22:35">27  янв  2024 в 22:35</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Привет, как  с продолжением о троичном процессоре?</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26430166"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26430170" class="tm-comment-thread__target" name="comment_26430170"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-3"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-3" data-comment-body="26430170"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/haqreu/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="haqreu"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/94a/ae6/d03/94aae6d03dfb408e5f26bc21f42b49b6.png" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/haqreu/" class="tm-user-info__username">haqreu <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26430170"><time datetime="2024-01-27T19:35:38.000Z" title="2024-01-27, 22:35">27  янв  2024 в 22:35</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p><a href="https://habr.com/ru/articles/787800/comments/#comment_26405162" rel="noopener noreferrer nofollow">https://habr.com/ru/articles/787800/comments/#comment_26405162</a></p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26430170"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><!--]--></div><!----></section><!--]--></div><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26406642" class="tm-comment-thread__target" name="comment_26406642"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-1"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-1" data-comment-body="26406642"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/DennisP/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="DennisP"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/090.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/DennisP/" class="tm-user-info__username">DennisP <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26406642"><time datetime="2024-01-22T06:30:32.000Z" title="2024-01-22, 09:30">22  янв  2024 в 09:30</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>на PC подобные эффекты делали с помощью изменения палитры. На приставках - без понятия...</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26406642"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><!--]--></div><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26407372" class="tm-comment-thread__target" name="comment_26407372"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-0"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-0" data-comment-body="26407372"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/domix32/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="domix32"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/7e2/a28/279/7e2a2827914de22fc9d32a5dc7976361.png" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/domix32/" class="tm-user-info__username">domix32 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26407372"><time datetime="2024-01-22T09:47:54.000Z" title="2024-01-22, 12:47">22  янв  2024 в 12:47</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><!----><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><blockquote><p>я нашёл <a href="https://github.com/pfultz2/Cloak/wiki/C-Preprocessor-tricks,-tips,-and-idioms" rel="noopener noreferrer nofollow">правильную ссылку</a></p></blockquote><p>главное в такой ситуации не устроить случайно компилятору <a href="https://en.wikipedia.org/wiki/Billion_laughs_attack" rel="noopener noreferrer nofollow">billion laughs</a>.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26407372"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26407386" class="tm-comment-thread__target" name="comment_26407386"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-1"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-1" data-comment-body="26407386"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/haqreu/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="haqreu"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/94a/ae6/d03/94aae6d03dfb408e5f26bc21f42b49b6.png" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/haqreu/" class="tm-user-info__username">haqreu <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26407386"><time datetime="2024-01-22T09:50:10.000Z" title="2024-01-22, 12:50">22  янв  2024 в 12:50</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Ну пример со сложением 2^64 количества нулей недалеко ушёл :)</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26407386"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><!--]--></div><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26407746" class="tm-comment-thread__target" name="comment_26407746"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-0"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-0" data-comment-body="26407746"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/FromMEwithLove/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="FromMEwithLove"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/001.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/FromMEwithLove/" class="tm-user-info__username">FromMEwithLove <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26407746"><time datetime="2024-01-22T11:13:57.000Z" title="2024-01-22, 14:13">22  янв  2024 в 14:13</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><!----><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>по алгоритму огня - ощущение постоянной скорости изменения ("горения"), что выглядит не совсем натурально</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26407746"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26407760" class="tm-comment-thread__target" name="comment_26407760"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-1"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-1" data-comment-body="26407760"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/haqreu/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="haqreu"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/94a/ae6/d03/94aae6d03dfb408e5f26bc21f42b49b6.png" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/haqreu/" class="tm-user-info__username">haqreu <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26407760"><time datetime="2024-01-22T11:17:01.000Z" title="2024-01-22, 14:17">22  янв  2024 в 14:17</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Тут вопрос компромисса: нужно максимизировать визуальный результат при минимизации количества и сложности строк кода. Присылайте пулл реквест :)<br/><br/>Кстати, спойлер: следующая моя демка будет с гидродинамикой сглаженных частиц.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26407760"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><!--]--></div><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26408800" class="tm-comment-thread__target" name="comment_26408800"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-0"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-0" data-comment-body="26408800"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/AndronNSK/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="AndronNSK"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/047.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/AndronNSK/" class="tm-user-info__username">AndronNSK <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26408800"><time datetime="2024-01-22T15:24:44.000Z" title="2024-01-22, 18:24">22  янв  2024 в 18:24</time><svg class="tm-svg-img tm-comment-thread__icon-pencil" height="16" width="16"><title>Комментарий был изменен</title><use xlink:href="/img/megazord-v28.7909a852..svg#pencil-small"></use></svg></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><!----><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Помню, работал в одной из контор... STM32, память только набортная, динамической аллокации нет. Зато есть не SQL БД и вебморда правления миром. Нужно было как-то объявлять переменные на стеке такого размера, чтобы они были размером с поле в БД, и чтобы другие разрабы не косячили с памятью, ошибаясь в размерах. </p><p>Несколько дней почитал статьи про двухпроходный препроцессор и сгородил что-то типа табличной структуры на макросах, когда одной строкой мы получали содержимое ячейки. Ну оно заработало, удачно, ошибок в коде не было, все макросами пользовались. </p><p>Прошёл годик, я решил вспомнить как же оно работает... И не вспомнил / не понял... Ну, работает и ладно :) </p><p>Будьте осторожны в ваших макросах :) </p><p></p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26408800"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26410006" class="tm-comment-thread__target" name="comment_26410006"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-0"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-0" data-comment-body="26410006"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/QWERTYUIOPas/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="QWERTYUIOPas"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/getpro/habr/avatars/60a/567/192/60a56719212663cc39b407e13e1ea387.gif" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/QWERTYUIOPas/" class="tm-user-info__username">QWERTYUIOPas <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26410006"><time datetime="2024-01-22T21:47:30.000Z" title="2024-01-23, 00:47">23  янв  2024 в 00:47</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><!----><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Я, честно говоря, немного прифигел. Не думал, что отрисовка огня - настолько простая задача</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26410006"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26410014" class="tm-comment-thread__target" name="comment_26410014"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-1"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-1" data-comment-body="26410014"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/haqreu/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="haqreu"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/94a/ae6/d03/94aae6d03dfb408e5f26bc21f42b49b6.png" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/haqreu/" class="tm-user-info__username">haqreu <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26410014"><time datetime="2024-01-22T21:49:19.000Z" title="2024-01-23, 00:49">23  янв  2024 в 00:49</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Вот спасибо вам за комментарий, ради таких реакций (меня устраивают внутренние, не обязательно произносить) я и пишу тексты.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26410014"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><!--]--></div><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_26412530" class="tm-comment-thread__target" name="comment_26412530"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-0"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-0" data-comment-body="26412530"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/Gryphon88/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="Gryphon88"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/056.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/Gryphon88/" class="tm-user-info__username">Gryphon88 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_26412530"><time datetime="2024-01-23T12:17:23.000Z" title="2024-01-23, 15:17">23  янв  2024 в 15:17</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><!----><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Если вы любите такого рода магию, посмотрите на библиотеку <a href="https://gustedt.gitlabpages.inria.fr/p99/p99-html/index.html" rel="noopener noreferrer nofollow">P99</a> за авторством Jens Gustedt. За использование на проде меня один раз побили.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="26412530"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_27626270" class="tm-comment-thread__target" name="comment_27626270"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-0"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-0" data-comment-body="27626270"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/aabzel/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="aabzel"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/fb1/27d/698/fb127d69816e919a59f0f232e14517e0.jpg" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/aabzel/" class="tm-user-info__username">aabzel <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_27626270"><time datetime="2024-12-02T21:31:06.000Z" title="2024-12-03, 00:31">3  дек  2024 в 00:31</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><!----><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Есть ли способ пометить участок кода так, чтобы Си препроцессор его не менял? </p><p>Чтобы как встретилась строка #include &lt;file.h&gt; так и осталась в первозданном виде.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="27626270"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_27629114" class="tm-comment-thread__target" name="comment_27629114"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-1"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-1" data-comment-body="27629114"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/Gryphon88/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="Gryphon88"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/056.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/Gryphon88/" class="tm-user-info__username">Gryphon88 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_27629114"><time datetime="2024-12-03T13:10:07.000Z" title="2024-12-03, 16:10">3  дек  2024 в 16:10</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>В общем случае нет. А собственно зачем? Если препроцессор инклюд не выполнит, у вас ошибку компиляции кинет на неизвестный токен.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="27629114"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_27629280" class="tm-comment-thread__target" name="comment_27629280"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-2"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-2" data-comment-body="27629280"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/aabzel/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="aabzel"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/fb1/27d/698/fb127d69816e919a59f0f232e14517e0.jpg" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/aabzel/" class="tm-user-info__username">aabzel <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_27629280"><time datetime="2024-12-03T13:37:57.000Z" title="2024-12-03, 16:37">3  дек  2024 в 16:37</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><blockquote><p><strong>А собственно зачем?</strong> Если препроцессор инклюд не выполнит, у вас ошибку компиляции кинет на неизвестный токен.  </p></blockquote><p>Я Си-шный препроцессор cpp.exe использую для вёрстки на LaTex учебника по программированию с листингами Си кода.<br/><br/>Мне надо чтобы в одних строчках препроцессор работал, а в других -- нет.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="27629280"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><!--]--></div><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_27705810" class="tm-comment-thread__target" name="comment_27705810"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-1"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-1" data-comment-body="27705810"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/XViivi/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="XViivi"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/008.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/XViivi/" class="tm-user-info__username">XViivi <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_27705810"><time datetime="2024-12-23T22:01:55.000Z" title="2024-12-24, 01:01">24  дек  2024 в 01:01</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>если не против компиляторозависимости, то есть специальные #pragma под такое, вроде</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="27705810"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_27705824" class="tm-comment-thread__target" name="comment_27705824"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-2"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-2" data-comment-body="27705824"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/aabzel/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="aabzel"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/fb1/27d/698/fb127d69816e919a59f0f232e14517e0.jpg" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/aabzel/" class="tm-user-info__username">aabzel <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_27705824"><time datetime="2024-12-23T22:07:43.000Z" title="2024-12-24, 01:07">24  дек  2024 в 01:07</time><svg class="tm-svg-img tm-comment-thread__icon-pencil" height="16" width="16"><title>Комментарий был изменен</title><use xlink:href="/img/megazord-v28.7909a852..svg#pencil-small"></use></svg></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Я уже решил проблему воспользовавшиcь <a href="https://www.gnu.org/software/m4/m4.html" rel="noopener noreferrer nofollow">препроцессором M4</a>.</p><p><a href="https://www.gnu.org/software/m4/m4.html" rel="noopener noreferrer nofollow">https://www.gnu.org/software/m4/m4.html</a></p><p></p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="27705824"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><!--]--></div><!----></section><!--]--></div><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_27630862" class="tm-comment-thread__target" name="comment_27630862"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-0"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-0" data-comment-body="27630862"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/aabzel/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="aabzel"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/fb1/27d/698/fb127d69816e919a59f0f232e14517e0.jpg" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/aabzel/" class="tm-user-info__username">aabzel <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_27630862"><time datetime="2024-12-03T22:22:48.000Z" title="2024-12-04, 01:22">4  дек  2024 в 01:22</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><!----><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Как Си пре-процессрором cpp.exe вставить кусок текста макро функцией, сохранив при этом переносы строк?</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="27630862"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_27631586" class="tm-comment-thread__target" name="comment_27631586"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-1"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-1" data-comment-body="27631586"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/unreal_undead2/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="unreal_undead2"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/018.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/unreal_undead2/" class="tm-user-info__username">unreal_undead2 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_27631586"><time datetime="2024-12-04T06:51:36.000Z" title="2024-12-04, 09:51">4  дек  2024 в 09:51</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>А на другие препроцессоры (скажем, <a href="https://www.gnu.org/software/m4/" rel="noopener noreferrer nofollow">m4</a>) не смотрели? Всё таки сишный препроцессор делался в первую очередь именно для C, а не для общего пользования.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="27631586"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_27637116" class="tm-comment-thread__target" name="comment_27637116"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-2"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-2" data-comment-body="27637116"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/aabzel/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="aabzel"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/fb1/27d/698/fb127d69816e919a59f0f232e14517e0.jpg" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/aabzel/" class="tm-user-info__username">aabzel <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_27637116"><time datetime="2024-12-05T12:23:34.000Z" title="2024-12-05, 15:23">5  дек  2024 в 15:23</time><svg class="tm-svg-img tm-comment-thread__icon-pencil" height="16" width="16"><title>Комментарий был изменен</title><use xlink:href="/img/megazord-v28.7909a852..svg#pencil-small"></use></svg></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Как в m4 препроцессоре сделать аналог вот этой конструкции от cpp</p><p>#ifdef HAS_XYZ<br/>    #include "file_xyz.txt"<br/>#endif</p><p>?</p><p>Условная вставка содержимого файла.</p><p></p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="27637116"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_27637160" class="tm-comment-thread__target" name="comment_27637160"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-3"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-3" data-comment-body="27637160"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/unreal_undead2/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="unreal_undead2"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/018.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/unreal_undead2/" class="tm-user-info__username">unreal_undead2 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_27637160"><time datetime="2024-12-05T12:36:57.000Z" title="2024-12-05, 15:36">5  дек  2024 в 15:36</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Как то <a href="https://www.eugeneweb.com/wiki/Sites/M4Macros" rel="noopener noreferrer nofollow">так</a></p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="27637160"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_27637304" class="tm-comment-thread__target" name="comment_27637304"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-4"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-4" data-comment-body="27637304"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/aabzel/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="aabzel"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/fb1/27d/698/fb127d69816e919a59f0f232e14517e0.jpg" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/aabzel/" class="tm-user-info__username">aabzel <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_27637304"><time datetime="2024-12-05T13:10:00.000Z" title="2024-12-05, 16:10">5  дек  2024 в 16:10</time><svg class="tm-svg-img tm-comment-thread__icon-pencil" height="16" width="16"><title>Комментарий был изменен</title><use xlink:href="/img/megazord-v28.7909a852..svg#pencil-small"></use></svg></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Эта конструкция которую там предлагают</p><pre><code>define(HAS_FILE1,1)

ifdef(HAS_FILE1, include(file1.txt), )
ifdef(HAS_FILE2, include(file2.txt), )
</code></pre><p>не работает. Рушится на первой же запятой внутри file1.txt.</p><p></p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="27637304"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_27637352" class="tm-comment-thread__target" name="comment_27637352"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-5"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-5" data-comment-body="27637352"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/unreal_undead2/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="unreal_undead2"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/018.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/unreal_undead2/" class="tm-user-info__username">unreal_undead2 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_27637352"><time datetime="2024-12-05T13:23:05.000Z" title="2024-12-05, 16:23">5  дек  2024 в 16:23</time><svg class="tm-svg-img tm-comment-thread__icon-pencil" height="16" width="16"><title>Комментарий был изменен</title><use xlink:href="/img/megazord-v28.7909a852..svg#pencil-small"></use></svg></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>ifdef(`foo', `include(`bar.csv')')</p><p></p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="27637352"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><!--]--></div><!----></section><!--]--></div><!----></section><!--]--></div><!----></section><!--]--></div><!----></section><!--]--></div><!----></section><!--]--></div><!--[--><!--]--><!--]--><!----><!--teleport start--><!--teleport end--><!--]--></div></div><!--[--><div class="tm-notice tm-notice_positive tm-comments__comment-notice"><!----><div class="tm-notice__inner"><!----><div class="tm-notice__content" data-test-id="notice-content"><!--[--><a href="/kek/v1/auth/habrahabr/?back=/ru/articles/787442/&amp;hl=ru" rel="nofollow">Зарегистрируйтесь на Хабре</a><span>, чтобы оставить комментарий</span><!--]--></div></div></div><!--]--></div></div></div></div></div><!--[--><!--[--><!--]--><section class="tm-block tm-block tm-block_spacing-bottom"><header class="tm-block__header tm-block__header tm-block__header_variant-borderless"><div class="tm-block__header-container"><h2 class="tm-block__title tm-block__title tm-block__title_variant-large">Публикации</h2><!--[--><!--]--></div><!----></header><!--[--><div class="tm-block__body tm-block__body tm-block__body_variant-condensed-slim"><!--[--><!--[--><div class="tm-tabs tm-tabs"><div class=""><!--[--><span class="tm-tabs__tab-item"><button class="tm-tabs__tab-link tm-tabs__tab-link_active tm-tabs__tab-link_slim tm-tabs__tab-link">Лучшие за сутки</button></span><span class="tm-tabs__tab-item"><button class="tm-tabs__tab-link tm-tabs__tab-link_slim tm-tabs__tab-link">Похожие</button></span><!--]--></div><!----></div><div class="similar-and-daily__tab-view"><div class="daily-articles-list"><ul class="tm-article-card-list"><!--[--><!--]--><div class="tm-bordered-card"><!----><!--[--><!--]--></div></ul><div class="daily-articles-block__button-container"><button class="btn btn_transparent btn_small tm-button tm-button_color-horizon" type="button"><!--[--><!--[-->Показать лучшие за всё время<!--]--><!--]--></button></div></div><!----></div><!--]--><!--]--></div><!--]--><!----></section><!--[--><div><div class="placeholder-wrapper"><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="tm-placeholder-promo"><div class="tm-placeholder-promo__header"><div class="tm-placeholder__line tm-placeholder__line_promo-title"></div></div><div class="tm-placeholder-promo__body"><div class="tm-placeholder-promo__posts"><div class="tm-placeholder-promo__post"><div class="tm-placeholder-promo__image"></div><div class="tm-placeholder__line tm-placeholder__line_post-title"></div></div><div class="tm-placeholder-promo__post"><div class="tm-placeholder-promo__image"></div><div class="tm-placeholder__line tm-placeholder__line_post-title"></div></div><div class="tm-placeholder-promo__post"><div class="tm-placeholder-promo__image"></div><div class="tm-placeholder__line tm-placeholder__line_post-title"></div></div></div><div class="tm-placeholder-promo__dots"><div class="tm-placeholder-promo__dot"></div><div class="tm-placeholder-promo__dot"></div><div class="tm-placeholder-promo__dot"></div></div></div></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div class="placeholder-wrapper"><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="tm-placeholder-inset tm-placeholder-vacancies"><div class="tm-placeholder-inset__header"><div class="tm-placeholder__line tm-placeholder__line_inset-header loads"></div></div><div class="tm-placeholder-inset__body"><ul class="tm-placeholder-list"><!--[--><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><!--]--></ul></div><div class="tm-placeholder-inset__footer"><div class="tm-placeholder__line tm-placeholder__line_inset-footer loads"></div></div></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div><!--]--><!----><!--[--><!--]--><!--]--></div><!--]--><!--]--></div></div><!--]--><!--]--></div></div><div class="tm-page__sidebar"><!--[--><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__placeholder_initial"></div><div class="tm-sexy-sidebar_initial tm-sexy-sidebar" style="margin-top:0px;"><!--[--><!--]--><!----><div class="tm-layout-sidebar__ads_initial tm-layout-sidebar__ads"><div class="banner-wrapper half-page tm-layout-sidebar__banner tm-layout-sidebar__banner_top" style="--8c60b148:600px;--27848d7d:auto;" data-v-bf8a3ee7><!--[--><div class="placeholder-wrapper placeholder" data-v-bf8a3ee7><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="adfox-banner-placeholder half-page" data-v-12f7bcca><div class="image loads" data-v-12f7bcca></div><div class="lines" data-v-12f7bcca><div class="line loads" data-v-12f7bcca></div><div class="line loads" data-v-12f7bcca></div><div class="line loads" data-v-12f7bcca></div></div></div></div><div id="adfox_164725680533065327" class="tm-adfox-banner" data-v-bf8a3ee7></div><!--]--></div></div><!--[--><!----><section class="tm-block tm-block tm-block_spacing-around tm-stories-block" data-navigatable tabindex="0" data-async-called="true"><header class="tm-block__header tm-block__header"><div class="tm-block__header-container"><h2 class="tm-block__title tm-block__title">Истории</h2><!--[--><!--]--></div><!----></header><!--[--><div class="tm-block__body tm-block__body tm-block__body_variant-equal"><!--[--><div class="tm-stories-empty"><!--[--><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><!--]--></div><!----><!--]--></div><!--]--><!----></section><section class="tm-block tm-block tm-block_spacing-around" data-async-called="true"><header class="tm-block__header tm-block__header"><div class="tm-block__header-container"><h2 class="tm-block__title tm-block__title">Работа</h2><!--[--><!--]--></div><!----></header><!--[--><div class="tm-block__body tm-block__body"><!--[--><!--[--><div class="tm-vacancies-block__item"><a class="tm-vacancies-block__vacancy-title" href="https://career.habr.com/vacancies/programmist_c" target="_blank">Программист С</a><div class="tm-vacancies-block__vacancies-count">41
    вакансия</div></div><div class="tm-vacancies-block__item"><a class="tm-vacancies-block__vacancy-title" href="https://career.habr.com/vacancies/game_developer" target="_blank">Разработчик игр</a><div class="tm-vacancies-block__vacancies-count">36
    вакансий</div></div><div class="tm-vacancies-block__item"><a class="tm-vacancies-block__vacancy-title" href="https://career.habr.com/vacancies/unity_developer" target="_blank">Unity разработчик</a><div class="tm-vacancies-block__vacancies-count">1
    вакансия</div></div><!--]--><!--]--></div><!--]--><footer class="tm-block__footer"><!--[--><a class="tm-block-extralink" href="https://career.habr.com/catalog">Все вакансии</a><!--]--></footer></section><section class="tm-block tm-block tm-block_spacing-around block" data-async-called="true" data-v-ebf6a21b><header class="tm-block__header tm-block__header"><div class="tm-block__header-container"><h2 class="tm-block__title tm-block__title">Ближайшие события</h2><!--[--><!--]--></div><!----></header><!--[--><div class="tm-block__body tm-block__body"><!--[--><div class="swiper-container slider" style="--swiper-space-between:22px;" data-v-ebf6a21b><div class="swiper-wrapper"><!--[--><!--[--><div class="swiper-slide" data-v-ebf6a21b><!--[--><section class="tm-block tm-block tm-block_spacing-none" id="576" tabindex="-1" data-v-ebf6a21b><!----><!--[--><div class="tm-event-card tm-event-card_is-widget"><a href="/ru/events/576/" class=""><img alt class="tm-event-card__image" data-src="https://habrastorage.org/getpro/habr/upload_files/854/e52/91a/854e5291accb21184bd75d40c20d50c9.jpg" loading="eager" src="https://habrastorage.org/r/w390/getpro/habr/upload_files/854/e52/91a/854e5291accb21184bd75d40c20d50c9.jpg" srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/854/e52/91a/854e5291accb21184bd75d40c20d50c9.jpg, https://habrastorage.org/getpro/habr/upload_files/854/e52/91a/854e5291accb21184bd75d40c20d50c9.jpg 2x"></a><!----><div class="tm-event-card__info"><div class="tm-event-card__date"><!----><div class="tm-event-card__day"><span>11 – 13  февраля  </span></div></div><a href="/ru/events/576/" class="tm-event-card__title-link"><span>Epic Telegram Conference</span></a><div class="tm-event-card__places"><div class="tm-event-card__places-list"><!--[--><span class="tm-event-card__places-item"><span>Онлайн</span><!----></span><!--]--></div></div></div><div class="tm-event-card__footer tm-event-card__footer_widget"><a href="/ru/events/#576" class="tm-event-card__link">Больше событий в календаре</a><div class="tm-event-card__categories"><!--[--><div class="event-category__label event-category__label_type-marketing"><span>Маркетинг</span></div><!--]--></div></div></div><!--]--><!----></section><!--]--></div><div class="swiper-slide" data-v-ebf6a21b><!--[--><section class="tm-block tm-block tm-block_spacing-none" id="580" tabindex="-1" data-v-ebf6a21b><!----><!--[--><div class="tm-event-card tm-event-card_is-widget"><a href="/ru/events/580/" class=""><img alt class="tm-event-card__image" data-src="https://habrastorage.org/getpro/habr/upload_files/7ee/4e7/008/7ee4e700871c1ca595c9c4490bed5c72.png" loading="eager" src="https://habrastorage.org/r/w390/getpro/habr/upload_files/7ee/4e7/008/7ee4e700871c1ca595c9c4490bed5c72.png" srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/7ee/4e7/008/7ee4e700871c1ca595c9c4490bed5c72.png, https://habrastorage.org/getpro/habr/upload_files/7ee/4e7/008/7ee4e700871c1ca595c9c4490bed5c72.png 2x"></a><!----><div class="tm-event-card__info"><div class="tm-event-card__date"><!----><div class="tm-event-card__day"><span>13  февраля  </span></div></div><a href="/ru/events/580/" class="tm-event-card__title-link"><span>Вебинар «Практикум Cloud.ru Evolution: как связать несколько виртуальных машин»</span></a><div class="tm-event-card__places"><div class="tm-event-card__places-list"><!--[--><span class="tm-event-card__places-item"><span>Онлайн</span><!----></span><!--]--></div></div></div><div class="tm-event-card__footer tm-event-card__footer_widget"><a href="/ru/events/#580" class="tm-event-card__link">Больше событий в календаре</a><div class="tm-event-card__categories"><!--[--><div class="event-category__label event-category__label_type-development"><span>Разработка</span></div><!--]--></div></div></div><!--]--><!----></section><!--]--></div><div class="swiper-slide" data-v-ebf6a21b><!--[--><section class="tm-block tm-block tm-block_spacing-none" id="578" tabindex="-1" data-v-ebf6a21b><!----><!--[--><div class="tm-event-card tm-event-card_is-widget"><a href="/ru/events/578/" class=""><img alt class="tm-event-card__image" data-src="https://habrastorage.org/getpro/habr/upload_files/f59/909/c21/f59909c215b64df1218f1d50717a8306.png" loading="eager" src="https://habrastorage.org/r/w390/getpro/habr/upload_files/f59/909/c21/f59909c215b64df1218f1d50717a8306.png" srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/f59/909/c21/f59909c215b64df1218f1d50717a8306.png, https://habrastorage.org/getpro/habr/upload_files/f59/909/c21/f59909c215b64df1218f1d50717a8306.png 2x"></a><!----><div class="tm-event-card__info"><div class="tm-event-card__date"><!----><div class="tm-event-card__day"><span>13  февраля  </span></div></div><a href="/ru/events/578/" class="tm-event-card__title-link"><span>«Честные вакансии: DevOps Middle»: бесплатный вебинар от учебного центра Слёрм</span></a><div class="tm-event-card__places"><div class="tm-event-card__places-list"><!--[--><span class="tm-event-card__places-item"><span>Онлайн</span><!----></span><!--]--></div></div></div><div class="tm-event-card__footer tm-event-card__footer_widget"><a href="/ru/events/#578" class="tm-event-card__link">Больше событий в календаре</a><div class="tm-event-card__categories"><!--[--><div class="event-category__label event-category__label_type-development"><span>Разработка</span></div><!--]--></div></div></div><!--]--><!----></section><!--]--></div><div class="swiper-slide" data-v-ebf6a21b><!--[--><section class="tm-block tm-block tm-block_spacing-none" id="584" tabindex="-1" data-v-ebf6a21b><!----><!--[--><div class="tm-event-card tm-event-card_is-widget"><a href="/ru/events/584/" class=""><img alt class="tm-event-card__image" data-src="https://habrastorage.org/getpro/habr/upload_files/fe1/34e/b2e/fe134eb2ea6b8c71d92faac74b180a32.png" loading="eager" src="https://habrastorage.org/r/w390/getpro/habr/upload_files/fe1/34e/b2e/fe134eb2ea6b8c71d92faac74b180a32.png" srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/fe1/34e/b2e/fe134eb2ea6b8c71d92faac74b180a32.png, https://habrastorage.org/getpro/habr/upload_files/fe1/34e/b2e/fe134eb2ea6b8c71d92faac74b180a32.png 2x"></a><!----><div class="tm-event-card__info"><div class="tm-event-card__date"><!----><div class="tm-event-card__day"><span>14 – 19  февраля  </span></div></div><a href="/ru/events/584/" class="tm-event-card__title-link"><span>Онлайн-интенсив «Нейросети для HR в 2025 году»</span></a><div class="tm-event-card__places"><div class="tm-event-card__places-list"><!--[--><span class="tm-event-card__places-item"><span>Онлайн</span><!----></span><!--]--></div></div></div><div class="tm-event-card__footer tm-event-card__footer_widget"><a href="/ru/events/#584" class="tm-event-card__link">Больше событий в календаре</a><div class="tm-event-card__categories"><!--[--><div class="event-category__label event-category__label_type-other"><span>Другое</span></div><!--]--></div></div></div><!--]--><!----></section><!--]--></div><div class="swiper-slide" data-v-ebf6a21b><!--[--><section class="tm-block tm-block tm-block_spacing-none" id="574" tabindex="-1" data-v-ebf6a21b><!----><!--[--><div class="tm-event-card tm-event-card_is-widget"><a href="/ru/events/574/" class=""><img alt class="tm-event-card__image" data-src="https://habrastorage.org/getpro/habr/upload_files/724/cc3/10a/724cc310ae3759cc5bea40d24785a877.png" loading="eager" src="https://habrastorage.org/r/w390/getpro/habr/upload_files/724/cc3/10a/724cc310ae3759cc5bea40d24785a877.png" srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/724/cc3/10a/724cc310ae3759cc5bea40d24785a877.png, https://habrastorage.org/getpro/habr/upload_files/724/cc3/10a/724cc310ae3759cc5bea40d24785a877.png 2x"></a><!----><div class="tm-event-card__info"><div class="tm-event-card__date"><!----><div class="tm-event-card__day"><span>15  февраля  </span></div></div><a href="/ru/events/574/" class="tm-event-card__title-link"><span>Конференция True Tech Hub в рамках фестиваля «Система Фест»</span></a><div class="tm-event-card__places"><div class="tm-event-card__places-list"><!--[--><span class="tm-event-card__places-item"><span>Нижний Новгород</span><span class="tm-event-card__places-separator"> • </span></span><span class="tm-event-card__places-item"><span>Онлайн</span><!----></span><!--]--></div></div></div><div class="tm-event-card__footer tm-event-card__footer_widget"><a href="/ru/events/#574" class="tm-event-card__link">Больше событий в календаре</a><div class="tm-event-card__categories"><!--[--><div class="event-category__label event-category__label_type-development"><span>Разработка</span></div><!--]--></div></div></div><!--]--><!----></section><!--]--></div><div class="swiper-slide" data-v-ebf6a21b><!--[--><section class="tm-block tm-block tm-block_spacing-none" id="582" tabindex="-1" data-v-ebf6a21b><!----><!--[--><div class="tm-event-card tm-event-card_is-widget"><a href="/ru/events/582/" class=""><img alt class="tm-event-card__image" data-src="https://habrastorage.org/getpro/habr/upload_files/c62/b96/430/c62b96430d576f2e72a9aa5aa45162d1.png" loading="eager" src="https://habrastorage.org/r/w390/getpro/habr/upload_files/c62/b96/430/c62b96430d576f2e72a9aa5aa45162d1.png" srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/c62/b96/430/c62b96430d576f2e72a9aa5aa45162d1.png, https://habrastorage.org/getpro/habr/upload_files/c62/b96/430/c62b96430d576f2e72a9aa5aa45162d1.png 2x"></a><!----><div class="tm-event-card__info"><div class="tm-event-card__date"><!----><div class="tm-event-card__day"><span>13  марта  </span></div></div><a href="/ru/events/582/" class="tm-event-card__title-link"><span>Весенний Хабр Семинар: как синергия HR и PR помогает удерживать сотрудников</span></a><div class="tm-event-card__places"><div class="tm-event-card__places-list"><!--[--><span class="tm-event-card__places-item"><span>Москва</span><!----></span><!--]--></div></div></div><div class="tm-event-card__footer tm-event-card__footer_widget"><a href="/ru/events/#582" class="tm-event-card__link">Больше событий в календаре</a><div class="tm-event-card__categories"><!--[--><div class="event-category__label event-category__label_type-management"><span>Менеджмент</span></div><div class="event-category__label event-category__label_type-marketing"><span>Маркетинг</span></div><div class="event-category__label event-category__label_type-other"><span>Другое</span></div><!--]--></div></div></div><!--]--><!----></section><!--]--></div><div class="swiper-slide" data-v-ebf6a21b><!--[--><section class="tm-block tm-block tm-block_spacing-none" id="572" tabindex="-1" data-v-ebf6a21b><!----><!--[--><div class="tm-event-card tm-event-card_is-widget"><a href="/ru/events/572/" class=""><img alt class="tm-event-card__image" data-src="https://habrastorage.org/getpro/habr/upload_files/b5b/861/81a/b5b86181afd0a3ea5207176063b7ccc0.png" loading="eager" src="https://habrastorage.org/r/w390/getpro/habr/upload_files/b5b/861/81a/b5b86181afd0a3ea5207176063b7ccc0.png" srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/b5b/861/81a/b5b86181afd0a3ea5207176063b7ccc0.png, https://habrastorage.org/getpro/habr/upload_files/b5b/861/81a/b5b86181afd0a3ea5207176063b7ccc0.png 2x"></a><!----><div class="tm-event-card__info"><div class="tm-event-card__date"><!----><div class="tm-event-card__day"><span>27  марта  </span></div></div><a href="/ru/events/572/" class="tm-event-card__title-link"><span>Deckhouse Conf 2025</span></a><div class="tm-event-card__places"><div class="tm-event-card__places-list"><!--[--><span class="tm-event-card__places-item"><span>Москва</span><!----></span><!--]--></div></div></div><div class="tm-event-card__footer tm-event-card__footer_widget"><a href="/ru/events/#572" class="tm-event-card__link">Больше событий в календаре</a><div class="tm-event-card__categories"><!--[--><div class="event-category__label event-category__label_type-development"><span>Разработка</span></div><div class="event-category__label event-category__label_type-admin"><span>Администрирование</span></div><div class="event-category__label event-category__label_type-management"><span>Менеджмент</span></div><!--]--></div></div></div><!--]--><!----></section><!--]--></div><div class="swiper-slide" data-v-ebf6a21b><!--[--><section class="tm-block tm-block tm-block_spacing-none" id="516" tabindex="-1" data-v-ebf6a21b><!----><!--[--><div class="tm-event-card tm-event-card_is-widget"><a href="/ru/events/516/" class=""><img alt class="tm-event-card__image" data-src="https://habrastorage.org/getpro/habr/upload_files/0e9/3a8/3ec/0e93a83ecea09f806d1df907ddb036a4.jpg" loading="eager" src="https://habrastorage.org/r/w390/getpro/habr/upload_files/0e9/3a8/3ec/0e93a83ecea09f806d1df907ddb036a4.jpg" srcset="https://habrastorage.org/r/w390/getpro/habr/upload_files/0e9/3a8/3ec/0e93a83ecea09f806d1df907ddb036a4.jpg, https://habrastorage.org/getpro/habr/upload_files/0e9/3a8/3ec/0e93a83ecea09f806d1df907ddb036a4.jpg 2x"></a><!----><div class="tm-event-card__info"><div class="tm-event-card__date"><!----><div class="tm-event-card__day"><span>25 – 26  апреля  </span></div></div><a href="/ru/events/516/" class="tm-event-card__title-link"><span>IT-конференция Merge Tatarstan 2025</span></a><div class="tm-event-card__places"><div class="tm-event-card__places-list"><!--[--><span class="tm-event-card__places-item"><span>Казань</span><!----></span><!--]--></div></div></div><div class="tm-event-card__footer tm-event-card__footer_widget"><a href="/ru/events/#516" class="tm-event-card__link">Больше событий в календаре</a><div class="tm-event-card__categories"><!--[--><div class="event-category__label event-category__label_type-development"><span>Разработка</span></div><div class="event-category__label event-category__label_type-marketing"><span>Маркетинг</span></div><div class="event-category__label event-category__label_type-other"><span>Другое</span></div><!--]--></div></div></div><!--]--><!----></section><!--]--></div><!--]--><!--]--></div><!----><!--[--><button class="swiper-button-prev"><span class="tm-svg-icon__wrapper swiper-button-icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Влево</title><use xlink:href="/img/megazord-v28.7909a852..svg#arrow-back"></use></svg></span></button><button class="swiper-button-next"><span class="tm-svg-icon__wrapper swiper-button-icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Вправо</title><use xlink:href="/img/megazord-v28.7909a852..svg#arrow-back"></use></svg></span></button><!--]--></div><!--]--></div><!--]--><!----></section><!--]--><div class="banner-wrapper medium-rectangle tm-layout-sidebar__banner tm-layout-sidebar__banner_bottom" style="--8c60b148:250px;--27848d7d:auto;" data-v-bf8a3ee7><!--[--><div class="placeholder-wrapper placeholder" data-v-bf8a3ee7><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="adfox-banner-placeholder medium-rectangle" data-v-12f7bcca><div class="image loads" data-v-12f7bcca></div><div class="lines" data-v-12f7bcca><div class="line loads" data-v-12f7bcca></div><div class="line loads" data-v-12f7bcca></div><div class="line loads" data-v-12f7bcca></div></div></div></div><div id="adfox_164725691003361602" class="tm-adfox-banner" data-v-bf8a3ee7></div><!--]--></div></div></div><!--]--></div></div><!----><!--]--></div></div></main><!----></div><div class="tm-footer-menu"><div class="tm-page-width"><!--[--><div class="tm-footer-menu__container"><!--[--><div class="tm-footer-menu__block"><p class="tm-footer-menu__block-title">Ваш аккаунт</p><div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><!--[--><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/articles/787442/&amp;hl=ru" rel="nofollow" target="_self">Войти</a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/articles/787442/&amp;hl=ru" rel="nofollow" target="_self">Регистрация</a></li><!--]--></ul></div></div><div class="tm-footer-menu__block"><p class="tm-footer-menu__block-title">Разделы</p><div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><!--[--><li class="tm-footer-menu__list-item"><a href="/ru/articles/" class="footer-menu__item-link">Статьи</a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">Новости</a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">Хабы</a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">Компании</a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">Авторы</a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">Песочница</a></li><!--]--></ul></div></div><div class="tm-footer-menu__block"><p class="tm-footer-menu__block-title">Информация</p><div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><!--[--><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">Устройство сайта</a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">Для авторов</a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">Для компаний</a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">Документы</a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement/?hl=ru_RU" target="_blank">Соглашение</a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/?hl=ru_RU" target="_blank">Конфиденциальность</a></li><!--]--></ul></div></div><div class="tm-footer-menu__block"><p class="tm-footer-menu__block-title">Услуги</p><div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><!--[--><li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/corporate-blogs/" target="_blank">Корпоративный блог</a></li><li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/advertising/" target="_blank">Медийная реклама</a></li><li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/native-special/" target="_blank">Нативные проекты</a></li><li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/education-programs/" target="_blank">Образовательные программы</a></li><li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/hello-startup/" target="_blank">Стартапам</a></li><!--]--></ul></div></div><!--]--></div><!--]--></div></div><div class="tm-footer"><div class="tm-page-width"><!--[--><div class="tm-footer__container"><!----><div class="tm-footer__social"><!--[--><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Facebook</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Twitter</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>VK</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-vk"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Telegram</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Youtube</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://dzen.ru/habr" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Яндекс Дзен</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-dzen"></use></svg></a><!--]--></div><!--teleport start--><!--teleport end--><button class="tm-footer__link"><!----> Настройка языка</button><a href="/ru/feedback/" class="tm-footer__link">Техническая поддержка</a><div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2025, </span><span class="tm-copyright__name"><a class="tm-copyright__link" href="https://company.habr.com/" rel="noopener" target="_blank">Habr</a></span></span></div></div><!--]--></div></div><!----><!--]--></div><!----></div><script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"787442":{"id":"787442","timePublished":"2024-01-21T16:13:13+00:00","isCorporative":false,"lang":"ru","titleHtml":"Про́клятый огонь, или магия препроцессора C","leadData":{"textHtml":"\u003Cp\u003EЗадавались ли вы когда-нибудь вопросом, можно ли полноценно программировать при помощи директивы \u003Ccode\u003E#define\u003C\u002Fcode\u003E в языке C? Полнота по Тьюрингу шаблонов C++ известна весьма широко, например, люди пишут \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Ftcbrindle\u002Fraytracer.hpp\" rel=\"noopener noreferrer nofollow\"\u003Eтрассировщики лучей\u003C\u002Fa\u003E, делающие все вычисления во время компиляции (вместо времени исполнения). А как обстоят дела с препроцессором C? Вопрос оказался сильно нетривиальнее, и эта история является, на мой вкус, отличным анекдотом для курса лекций по теории компиляторов, что я готовлю в данный момент. В частности, для лучшего понимания происходящего здесь, рекомендую ознакомиться со второй статьёй, которую я опубликовал параллельно этой:\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F787800\u002F\" rel=\"noopener noreferrer nofollow\"\u003E лексер и парсер\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cp\u003EЧтобы не было обманутых впечатлений, предупрежу сразу, что рейтрейсера не будет, но про́клятый код будет очень даже! Итак, поехали. Для начала, почему я вообще задался этим вопросом? Если обычный код компьютерной графики вам скучен, следующий раздел можно пропустить, перематывайте до последней картинки.\u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F46a\u002F150\u002F3cc\u002F46a1503ccbbf797056d52bfc376d67d2.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F46a\u002F150\u002F3cc\u002F46a1503ccbbf797056d52bfc376d67d2.png","fit":"cover","positionY":0,"positionX":0}},"editorVersion":"2.0","postType":"article","postLabels":[{"type":"technotext2024","typeOf":"technotext","title":"✏️ Технотекст 7","data":{"url":null}}],"author":{"id":"907245","alias":"haqreu","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F94a\u002Fae6\u002Fd03\u002F94aae6d03dfb408e5f26bc21f42b49b6.png","speciality":"Довожу здравый смысл до абсурда","scoreStats":{"score":550,"votesCount":630},"rating":0.2,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":"410011276377228","paymentPayPalMe":"haqreu","paymentWebmoney":null},"donationsMethod":"wallets","isInBlacklist":null},"statistics":{"commentsCount":65,"favoritesCount":221,"readingCount":29722,"score":169,"votesCount":169,"votesCountPlus":169,"votesCountMinus":0},"hubs":[{"id":"84","alias":"crazydev","type":"collective","title":"Ненормальное программирование","titleHtml":"Ненормальное программирование","isProfiled":true,"relatedData":null},{"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true,"relatedData":null},{"id":"7773","alias":"gamedev","type":"collective","title":"Разработка игр","titleHtml":"Разработка игр","isProfiled":true,"relatedData":null},{"id":"17188","alias":"compilers","type":"collective","title":"Компиляторы","titleHtml":"Компиляторы","isProfiled":true,"relatedData":null},{"id":"17717","alias":"c","type":"collective","title":"C","titleHtml":"C","isProfiled":true,"relatedData":null}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"}],"relatedData":{"vote":null,"unreadCommentsCount":0,"bookmarked":false,"canComment":false,"canEdit":false,"canViewVotes":false,"votePlus":{"canVote":false,"isChargeEnough":false,"isKarmaEnough":false,"isVotingOver":true},"voteMinus":{"canVote":false,"isChargeEnough":false,"isKarmaEnough":false,"isVotingOver":true},"canModerateComments":false,"trackerSubscribed":false,"emailSubscribed":false},"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EЗадавались ли вы когда-нибудь вопросом, можно ли полноценно программировать при помощи директивы \u003Ccode\u003E#define\u003C\u002Fcode\u003E в языке C? Полнота по Тьюрингу шаблонов C++ известна весьма широко, например, люди пишут \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Ftcbrindle\u002Fraytracer.hpp\" rel=\"noopener noreferrer nofollow\"\u003Eтрассировщики лучей\u003C\u002Fa\u003E, делающие все вычисления во время компиляции (вместо времени исполнения). А как обстоят дела с препроцессором C? Вопрос оказался сильно нетривиальнее, и эта история является, на мой вкус, отличным анекдотом для курса лекций по теории компиляторов, что я готовлю в данный момент. В частности, для лучшего понимания происходящего здесь, рекомендую ознакомиться со второй статьёй, которую я опубликовал параллельно этой:\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F787800\u002F\" rel=\"noopener noreferrer nofollow\"\u003E лексер и парсер\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cp\u003EЧтобы не было обманутых впечатлений, предупрежу сразу, что рейтрейсера не будет, но про́клятый код будет очень даже! Итак, поехали. Для начала, почему я вообще задался этим вопросом? Если обычный код компьютерной графики вам скучен, следующий раздел можно пропустить, перематывайте до последней картинки.\u003C\u002Fp\u003E\u003Ch2\u003EСамый обычный огонь, никем не про́клятый\u003C\u002Fh2\u003E\u003Cp\u003EКак я и сказал, я пообещал написать простейший, но вполне полноценный компилятор только что придуманного мной языка wend за выходные. Написать-то дело несложное, а вот \u003Cem\u003Eописать\u003C\u002Fem\u003E труднее. Для хорошего описания нужны красочные примеры. У меня аллергия на иллюстрации из разряда вычислений чисел Фибоначчи. Ну сколько же можно?! Поскольку wend крайне примитивен, то и примеры мне нужны простые, но всё же как можно более эффектные. И тут я вспомнил про древнюю демосцену! Вот, например, я хочу написать на своём языке программу, которая просто гоняет по кругу пламя:\u003C\u002Fp\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F95a\u002F012\u002F0b8\u002F95a0120b8893f5229f17f58795b482f4.gif\" width=\"320\" height=\"167\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F95a\u002F012\u002F0b8\u002F95a0120b8893f5229f17f58795b482f4.gif\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЭто сделать несложно: у меня нет возможности запускать графический режим, но ведь моя консоль поддерживает управляющую последовательность \u003Ccode\u003E\\033[\u003C\u002Fcode\u003E, так что для отрисовки пламени мне вполне хватит одной инструкции \u003Ccode\u003Eprint\u003C\u002Fcode\u003E! Кстати, я слышал, что нынче даже в винде консоль поддерживает эскейп-последовательности ANSI, но лично не проверял.\u003C\u002Fp\u003E\u003Cp\u003EДело за малым, написать код. Поскольку я болен только на часть головы, а не на всю, писать я его буду сначала на C, и уж потом только транслировать (руками) в wend, поскольку мой компилятор - это хорошо, но всё же вокруг си инструментов самую малость больше. Да и баги в моём компиляторе никто не отменял, и мне лень думать, где именно у меня проблема. На баги gcc я уже, конечно, натыкался, но это исчезающе редкое явление.\u003C\u002Fp\u003E\u003Cp\u003EДавайте посмотрим, как создать такой огонь, а потом продолжим разговор про препроцессор и чёрную магию. Вот так выглядит обёртка, от которой мы будем отталкиваться:\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EHidden text\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003E#include &lt;stdio.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n\n#define WIDTH 80\n#define HEIGHT 25\n#define FPS 30\n\nconst char* palette[256] = {\n#define ANSIRGB(R,G,B) \"\\033[48;2;\" #R \";\"  #G \";\" #B \"m \"\n    ANSIRGB(  0,  0,   0), ANSIRGB(  0,   4,  4), ANSIRGB(  0,  16, 20), ANSIRGB(  0,  28,  36),\n    ANSIRGB(  0,  32, 44), ANSIRGB(  0,  36, 48), ANSIRGB( 60,  24, 32), ANSIRGB(100,  16,  16),\n    ANSIRGB(132,  12, 12), ANSIRGB(160,   8,  8), ANSIRGB(192,   8,  8), ANSIRGB(220,   4,   4),\n    ANSIRGB(252,   0,  0), ANSIRGB(252,   0,  0), ANSIRGB(252,  12,  0), ANSIRGB(252,  28,   0),\n    ANSIRGB(252,  40,  0), ANSIRGB(252,  52,  0), ANSIRGB(252,  64,  0), ANSIRGB(252,  80,   0),\n    ANSIRGB(252,  92,  0), ANSIRGB(252, 104,  0), ANSIRGB(252, 116,  0), ANSIRGB(252, 132,   0),\n    ANSIRGB(252, 144,  0), ANSIRGB(252, 156,  0), ANSIRGB(252, 156,  0), ANSIRGB(252, 160,   0),\n    ANSIRGB(252, 160,  0), ANSIRGB(252, 164,  0), ANSIRGB(252, 168,  0), ANSIRGB(252, 168,   0),\n    ANSIRGB(252, 172,  0), ANSIRGB(252, 176,  0), ANSIRGB(252, 176,  0), ANSIRGB(252, 180,   0),\n    ANSIRGB(252, 180,  0), ANSIRGB(252, 184,  0), ANSIRGB(252, 188,  0), ANSIRGB(252, 188,   0),\n    ANSIRGB(252, 192,  0), ANSIRGB(252, 196,  0), ANSIRGB(252, 196,  0), ANSIRGB(252, 200,   0),\n    ANSIRGB(252, 204,  0), ANSIRGB(252, 204,  0), ANSIRGB(252, 208,  0), ANSIRGB(252, 212,   0),\n    ANSIRGB(252, 212,  0), ANSIRGB(252, 216,  0), ANSIRGB(252, 220,  0), ANSIRGB(252, 220,   0),\n    ANSIRGB(252, 224,  0), ANSIRGB(252, 228,  0), ANSIRGB(252, 228,  0), ANSIRGB(252, 232,   0),\n    ANSIRGB(252, 232,  0), ANSIRGB(252, 236,  0), ANSIRGB(252, 240,  0), ANSIRGB(252, 240,   0),\n    ANSIRGB(252, 244,  0), ANSIRGB(252, 248,  0), ANSIRGB(252, 248,  0), ANSIRGB(252, 252,   0),\n#define W ANSIRGB(252,252,252)\n    W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W,\n    W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W,\n    W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W,\n    W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W,\n    W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W,\n    W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W,\n    W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W,\n    W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W, W\n#undef W\n#undef ANSIRGB\n};\n\nstatic uint8_t fire[WIDTH * HEIGHT];\n\nint main() {\n    printf(\"\\033[2J\"); \u002F\u002F clear screen\n    for (;;) {\n        printf(\"\\033[H\"); \u002F\u002F home\n\n        \u002F\u002F rendering body\n        {\n            fire[rand()%(WIDTH*HEIGHT)] = 255;\n        }\n\n        for (int j = 0; j&lt;HEIGHT; j++) {      \u002F\u002F show the buffer\n            for (int i = 0; i&lt;WIDTH; i++)\n                printf(palette[fire[i+j*WIDTH]]);\n            printf(\"\\033[49m\\n\");\n        }\n        usleep(1000000\u002FFPS);\n    }\n    return 0;\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EДля начала я определяю размеры моей консоли, в которой буду рисовать (80x25), Потом я определяю массив-палитру в 256 значений и буфер \u003Ccode\u003Efire\u003C\u002Fcode\u003E, который собственно и хранит картинку с (будущим) пламенем. Затем в вечном цикле \u003Ccode\u003Efor(;;)\u003C\u002Fcode\u003E я отрисовываю этот буфер, в котором для начала просто заполняю белым цветом случайно выбранные пиксели. Получаем вполне ожидаемый результат:\u003C\u002Fp\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F633\u002F236\u002F706\u002F633236706e88fc286fb92dac9185cb87.gif\" width=\"320\" height=\"167\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F633\u002F236\u002F706\u002F633236706e88fc286fb92dac9185cb87.gif\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EБелые пиксели у меня будут искрами пламени. Искры довольно быстро остывают, нагревая при этом окружающую среду. Это можно промоделировать очень просто: на каждом кадре размывая картинку с предыдущего кадра. Все изменения в коде у меня будут происходить внутри блока отмеченного как \u003Ccode\u003E\u002F\u002F rendering body\u003C\u002Fcode\u003E, так что больше код приводить целиком не буду, финальный код можно найти в \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fssloy\u002Ftinycompiler\u002Fgfx\u002F\" rel=\"noopener noreferrer nofollow\"\u003Eрепозитории моего компилятора\u003C\u002Fa\u003E. Самое простое размытие картинки можно сделать, просто посчитав для каждого пикселя среднее значение среди всех его соседей. Практически все имплементации, что я встречаю, требуют создания копии всего буфера, например, \u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FBox_blur\" rel=\"noopener noreferrer nofollow\"\u003Eпосмотрите в википедии\u003C\u002Fa\u003E. При этом подобные фильтры сепарабельны по координатам, так что он полностью эквивалентен двум \u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FMotion_blur\" rel=\"noopener noreferrer nofollow\"\u003Emotion blur фильтрам\u003C\u002Fa\u003E, одному горизонтальному, второму вертикальному. Для начала давайте сделаем только вертикальное размытие:\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EHidden text\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003Evoid line_blur(int offset, int step, int nsteps) {\n    uint8_t circ[3] = {0, fire[offset], fire[offset+step]};\n    uint8_t beg = 1;\n    for (int i=0; i&lt;nsteps; i++) {\n        fire[offset] = (circ[0]+circ[1]+circ[2])\u002F3;\n        circ[(beg+++2)%3] = i+2&lt;nsteps ? fire[offset+2*step] : 0;\n        offset += step;\n    }\n}\n\nint main() {\n        [...]\n        \u002F\u002F rendering body\n        {\n            \u002F\u002F box blur: first horizontal motion blur then vertical motion blur\n            for (int j = 0; j&lt;HEIGHT; j++)\nтут -&gt;          line_blur(j*WIDTH, 1, WIDTH);\n\n            fire[rand()%(WIDTH*HEIGHT)] = 255;\n        }\n        [...]\n  }\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EКольцевого буфера на три элемента мне хватает, больше никаких копий экранного буфера мне не надо. Этот код даёт следующий результат (я чуть-чуть замедлил видео, чтобы было нагляднее):\u003C\u002Fp\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F241\u002F8b1\u002Fea3\u002F2418b1ea386e2188d1149d03b2795950.gif\" width=\"320\" height=\"167\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F241\u002F8b1\u002Fea3\u002F2418b1ea386e2188d1149d03b2795950.gif\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EДобавим к нему горизонтальное:\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EHidden text\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003E        \u002F\u002F rendering body\n        {\n            \u002F\u002F box blur: first horizontal motion blur then vertical motion blur\nтут -&gt;      for (int j = 0; j&lt;HEIGHT; j++)\n                line_blur(j*WIDTH, 1, WIDTH);\n            for (int i = 0; i&lt;WIDTH; i++)\n                line_blur(i, WIDTH, HEIGHT);\n\n            fire[rand()%(WIDTH*HEIGHT)] = 255;\n        }\n        [...]\n  }\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1d0\u002F7b8\u002F337\u002F1d07b833793f2e5e3737303a9c239a70.gif\" width=\"320\" height=\"167\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1d0\u002F7b8\u002F337\u002F1d07b833793f2e5e3737303a9c239a70.gif\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EТепло от одного пикселя быстро распределяется по всё большей и большей территории, так что перестаёт даже быть видным в моей палитре: на первой итерации один белый пиксель окружён восемью чёрными, на второй все девять пикселей имеют значение 255\u002F9 = 28 и так далее:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Eитерация 1     итерация 2      итерация 3\n              0  0  0  0 0    3  6  9  6 3\n 0  0  0      0 28 28 28 0    6 12 18 12 6\n 0 255 0      0 28 28 28 0    9 18 28 18 9\n 0  0  0      0 28 28 28 0    6 12 18 12 6\n              0  0  0  0 0    3  6  9  6 3\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EТут я искры разбросал по всему экрану, но в реальности у нас тепло идёт непосредственно из костра, так что давайте чуточку подправим код, разрешив генерировать горячие пиксели только на самой нижней строчке экрана:\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EHidden text\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003E        \u002F\u002F rendering body\n        {\n            \u002F\u002F box blur: first horizontal motion blur then vertical motion blur\n            for (int j = 0; j&lt;HEIGHT; j++)\n                line_blur(j*WIDTH, 1, WIDTH);\n            for (int i = 0; i&lt;WIDTH; i++)\n                line_blur(i, WIDTH, HEIGHT);\n\n            for (int i = 0; i&lt;WIDTH; i++) {       \u002F\u002F add heat to the bed\n                int idx = i+(HEIGHT-1)*WIDTH;\n                if (!(rand()%32))\nтут -&gt;              fire[idx] = 128+rand()%128;   \u002F\u002F sparks\n            }\n        }\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F45f\u002F42b\u002Fbe5\u002F45f42bbe531a20e7993b079498a8e199.gif\" width=\"320\" height=\"167\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F45f\u002F42b\u002Fbe5\u002F45f42bbe531a20e7993b079498a8e199.gif\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EИзображение стало менее интересным, зато небо перестало греться без причины. Чего нам тут не хватает, так это конвекции! Давайте на каждом этапе просто сдвигать предыдущий кадр на одну строчку вверх:\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EHidden text\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003E        \u002F\u002F rendering body\n        {\nтут -&gt;      for (int j = 1; j&lt;HEIGHT; j++)        \u002F\u002F scroll up\n                for (int i = 0; i&lt;WIDTH; i++)\n                    fire[i+(j-1)*WIDTH] = fire[i+j*WIDTH] ;\n\n            \u002F\u002F box blur: first horizontal motion blur then vertical motion blur\n            for (int j = 0; j&lt;HEIGHT; j++)\n                line_blur(j*WIDTH, 1, WIDTH);\n            for (int i = 0; i&lt;WIDTH; i++)\n                line_blur(i, WIDTH, HEIGHT);\n\n            for (int i = 0; i&lt;WIDTH; i++) {       \u002F\u002F add heat to the bed\n                int idx = i+(HEIGHT-1)*WIDTH;\n                if (!(rand()%32))\n                    fire[idx] = 128+rand()%128;   \u002F\u002F sparks\n            }\n        }\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F740\u002F9b6\u002Fb27\u002F7409b6b27eea5884de0d830873b578df.gif\" width=\"320\" height=\"167\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F740\u002F9b6\u002Fb27\u002F7409b6b27eea5884de0d830873b578df.gif\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EУже сильно более похоже на правду! Но ведь у костра есть подушка углей, искры не возникают просто так, так что давайте закрасим постоянным цветом (а значит, и добавим тепла) нижнюю строчку картинки:\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EHidden text\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003E        \u002F\u002F rendering body\n        {\n            for (int j = 1; j&lt;HEIGHT; j++)        \u002F\u002F scroll up\n                for (int i = 0; i&lt;WIDTH; i++)\n                    fire[i+(j-1)*WIDTH] = fire[i+j*WIDTH] ;\n\n            \u002F\u002F box blur: first horizontal motion blur then vertical motion blur\n            for (int j = 0; j&lt;HEIGHT; j++)\n                line_blur(j*WIDTH, 1, WIDTH);\n            for (int i = 0; i&lt;WIDTH; i++)\n                line_blur(i, WIDTH, HEIGHT);\n\n            for (int i = 0; i&lt;WIDTH; i++) {       \u002F\u002F add heat to the bed\n                int idx = i+(HEIGHT-1)*WIDTH;\n                if (!(rand()%32))\n                    fire[idx] = 128+rand()%128;   \u002F\u002F sparks\n                else\nтут -&gt;              fire[idx] = fire[idx]&lt;16 ? 16 : fire[idx]; \u002F\u002F ember bed\n            }\n        }\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F612\u002Fcf7\u002Ff1f\u002F612cf7f1f6fa8f37a051fe8d2ee0e30e.gif\" width=\"320\" height=\"167\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F612\u002Fcf7\u002Ff1f\u002F612cf7f1f6fa8f37a051fe8d2ee0e30e.gif\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EПочти совсем хорошо, но тепла что-то очень много, давайте в качестве последнего штриха добавим охлаждение:\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EHidden text\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003E        \u002F\u002F rendering body\n        {\n            for (int j = 1; j&lt;HEIGHT; j++)        \u002F\u002F scroll up\n                for (int i = 0; i&lt;WIDTH; i++)\n                    fire[i+(j-1)*WIDTH] = fire[i+j*WIDTH];\n\n            \u002F\u002F box blur: first horizontal motion blur then vertical motion blur\n            for (int j = 0; j&lt;HEIGHT; j++)\n                line_blur(j*WIDTH, 1, WIDTH);\n            for (int i = 0; i&lt;WIDTH; i++)\n                line_blur(i, WIDTH, HEIGHT);\n\n            for (int i = 0; i&lt; WIDTH*HEIGHT; i++) \u002F\u002F cool\n                if (rand()%2 &amp;&amp; fire[i]&gt;0)\nтут -&gt;              fire[i]--;\n\n            for (int i = 0; i&lt;WIDTH; i++) {       \u002F\u002F add heat to the bed\n                int idx = i+(HEIGHT-1)*WIDTH;\n                if (!(rand()%32))\n                    fire[idx] = 128+rand()%128;   \u002F\u002F sparks\n                else\n                    fire[idx] = fire[idx]&lt;16 ? 16 : fire[idx]; \u002F\u002F ember bed\n            }\n        }\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EНу, собственно, и всё, обычный, никем не проклятый огонь, готов. Давайте посмотрим на него ещё раз:\u003C\u002Fp\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F8a6\u002F14c\u002F949\u002F8a614c94937966d14866b7a26c35382c.gif\" width=\"320\" height=\"167\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F8a6\u002F14c\u002F949\u002F8a614c94937966d14866b7a26c35382c.gif\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EНаверное, можно переводить код на wend? И тут как раз в кустах случайно стоит рояль, я могу сыграть!\u003C\u002Fp\u003E\u003Ch2\u003EРояль в кустах\u003C\u002Fh2\u003E\u003Cp\u003EВнимательный читатель мог заметить, что в этой демке я всю отрисовку провожу в массиве \u003Ccode\u003Efire[]\u003C\u002Fcode\u003E, а в моём языке wend нет массивов! И отрисовывать пиксели независимо один от другого не получится никак, поскольку рассеивание тепла (да и конвекция) требуют знания состояния соседних пикселей. Но это не беда, ведь у меня есть функции. Давайте предположим, что мне нужен массив в восемь элементов. Его можно сэмулировать восемью разными переменными, и двумя функциями - геттером\u002Fсеттером:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003Euint8_t fire0, fire1, fire2, fire3, fire4, fire5, fire6, fire7;\n\nuint8_t get_fire(int i) {\n    if (i==0) return fire0;\n    if (i==1) return fire1;\n    if (i==2) return fire2;\n    if (i==3) return fire3;\n    if (i==4) return fire4;\n    if (i==5) return fire5;\n    if (i==6) return fire6;\n    if (i==7) return fire7;\n}\n\nvoid set_fire(int i, uint8_t v) {\n  [...]\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EСеттер описывать не буду, его структура будет такой же, как у геттера. Код тривиальный, но по факту я сделал связный список вместо массива, и чтобы добраться до двухтысячного элемента, мне придётся сделать две тысячи сравнений. Оно, конечно, абсолютно пофиг на таком размере данных, но что-то неспокойна моя душа. Впрочем, ничто не мешает искать нужную переменную при помощи дихотомии, сведя сложность от линейной к логарифмической:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003Euint8_t get_fire(int i) {\n    if (i&lt;4) {\n        if (i&lt;2) {\n            if (i&lt;1) {\n                return fire0;\n            } else {\n                return fire1;\n            }\n        } else {\n            if (i&lt;3) {\n                return fire2;\n            } else {\n                return fire3;\n            }\n        }\n    } else {\n        if (i&lt;6) {\n            if (i&lt;5) {\n                return fire4;\n            } else {\n                return fire5;\n            }\n        } else {\n            if (i&lt;7) {\n                return fire6;\n            } else {\n                return fire7;\n            }\n        }\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EЭто уже сильно приятнее. И как раз вот этот код и дал толчок к данной статье. Как мне сгенерировать эту функцию? Руками писать сильно неохота :)\u003C\u002Fp\u003E\u003Cp\u003EМой язык местами сильно похож на си, так что если сделать сишный код, то его можно протестировать сначала нормально, а потом скопировать в исходник на wend.\u003C\u002Fp\u003E\u003Cp\u003EКонсоль у меня 80x25, так что мне нужна память на две тысячи ячеек. 2048 очень близко к 2000, и при этом является точной степенью двойки, так что с минимальным оверхедом мне не надо себе ломать голову над граничными условиями, и можно сделать полностью сбалансированное двоичное дерево поиска. Очевидно, что я мог взять любой язык программирования, и сгенерировать соответствующую строку текста, однако мне почему-то захотелось сделать в оригинальном исходнике с огнём простой переключатель на дефайне, который бы переключал между обычным массивом и эрзац-массивом: это был бы простой способ убедиться в том, что я нигде не напортачил. И вот тут я задался вопросом: а нельзя ли эту самую функцию сгенерировать именно при помощи препроцессора C?\u003C\u002Fp\u003E\u003Cp\u003EДля этого мне пришлось бы написать рекурсивный \u003Ccode\u003E#define\u003C\u002Fcode\u003E. Можно ли это сделать, и если да, то как? Разумеется, я пошёл задавать вопрос гуглу. И среди прочего наткнулся на \u003Ca href=\"https:\u002F\u002Fcplusplus.com\u002Fforum\u002Fgeneral\u002F9036\u002F\" rel=\"noopener noreferrer nofollow\"\u003Eлюбопытный тред\u003C\u002Fa\u003E на cplusplus.com, давайте я его даже заскриню:\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EHidden text\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc7a\u002Fd83\u002F168\u002Fc7ad83168922ebaf185e571e93e92da6.png\" width=\"1013\" height=\"1403\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc7a\u002Fd83\u002F168\u002Fc7ad83168922ebaf185e571e93e92da6.png\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EНаш коллега задался ровно тем же самым вопросом, что и я, и ему трижды ответили, что рекурсия на дефайнах невозможна. Ха.\u003C\u002Fp\u003E\u003Cp\u003EИмейте в виду, что это не я такой умный, я нашёл \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fpfultz2\u002FCloak\u002Fwiki\u002FC-Preprocessor-tricks,-tips,-and-idioms\" rel=\"noopener noreferrer nofollow\"\u003Eправильную ссылку\u003C\u002Fa\u003E на stackoverflow, и попытался лишь скомпилировать полученное знание. \u003C\u002Fp\u003E\u003Ch2\u003EКак работает препроцессор или почему макрокоманда - это не функция\u003C\u002Fh2\u003E\u003Cp\u003EДавайте разбираться с тем, как работает препроцессор C. В вышеприведённом коде с огнём мы уже встречались с дефайном \u003Ccode\u003E#define WIDTH 80\u003C\u002Fcode\u003E, это вполне стандартная практика определения констант (примечание: не делайте так в C++, \u003Ccode\u003Econstexpr\u003C\u002Fcode\u003E - это хорошо! У дефайнов есть много неприятных моментов, которые начисто убираются при помощи \u003Ccode\u003Econstexpr\u003C\u002Fcode\u003E). И когда лексер встречает лексему \u003Ccode\u003EWIDTH\u003C\u002Fcode\u003E, он её подменяет на 80 ещё \u003Cstrong\u003Eдо\u003C\u002Fstrong\u003E запуска непосредственно компилятора. Макрокоманды бывают ещё и похожими на функции, например, знаменитый \u003Ccode\u003E#define MIN(X, Y) (((X) &lt; (Y)) ? (X) : (Y))\u003C\u002Fcode\u003E. Примечание: не делайте так, на третьем десятке двадцать первого века я не могу придумать ни одной причины, чтобы продолжать использовать код из семидесятых.\u003C\u002Fp\u003E\u003Cp\u003E\"Выполнение\", а точнее, разворачивание макрокоманд является чисто текстовым. Препроцессор не понимает язык Си, поэтому, если вы ему дадите \u003Ccode\u003EMIN(habracadabra, circ][(beg+++))\u003C\u002Fcode\u003E, то он её радостно преобразует в \u003Ccode\u003E(((habracadabra) &lt; (circ][(beg+++))) ? (habracadabra) : (circ][(beg+++)\u003C\u002Fcode\u003E! Проверьте сами при помощи gcc -E source.c.\u003C\u002Fp\u003E\u003Cp\u003EКогда мы хотим развернуть макрокоманду, похожую на функцию, то видя похожий синтаксис, большинство программистов считают, что и работает это как функция, то есть, сначала мы оценим значения параметров, и передадим в тело родительской макрокоманды. И чаще всего такая интуиция не противоречит тому, что мы видим. Но препроцессор - это не сам C, и макросы ведут себя совсем не так, и вышепривённый пример с \u003Ccode\u003EMIN\u003C\u002Fcode\u003E тому подтверждение.\u003C\u002Fp\u003E\u003Cp\u003EДавайте я приведу правила подстановки для макрокоманд (в порядке их выполнения):\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EПриведение к строке (оператор \u003Ccode\u003E#\u003C\u002Fcode\u003E, в этой статье не встречается)\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EПодстановка текста аргументов вместо имён параметров (без разворачивания лексем) \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EСклеивание лексем (оператор \u003Ccode\u003E##\u003C\u002Fcode\u003E, в этой статье встречается повсеместно)\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EРазворачивание лексем параметров\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EПовторное сканирование и разворачивание результата.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch3\u003EНастали тёмные времена, или чёрная магия\u003C\u002Fh3\u003E\u003Cp\u003EДавайте рассмотрим простейший пример (пока на си) хвостовой рекурсии:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003Evoid recursion(int d) {\n    printf(\"%d \", d);\n    if (d!=0) recursion(d - 1);\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EЕсли мы вызовем \u003Ccode\u003Erecursion(3)\u003C\u002Fcode\u003E, то на экране будет выведено \u003Ccode\u003E3 2 1 0\u003C\u002Fcode\u003E. Нам нужно научиться сделать подобное исключительно на макросах. Итак, перечислим необходимые нам ингредиенты в порядке возрастающей сложности:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003Eнужно уметь делать декремент\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eнужно уметь делать ветвление\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eнужно уметь проверить числовое значение на равенство нулю\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eну и научиться делать непосредственно рекурсивный вызов.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch2\u003EДекремент\u003C\u002Fh2\u003E\u003Cp\u003EДавайте начнём с самого первого, с декремента. Препроцессор довольно тупой. Он выполняет подстановку текста, и ничего больше. Временами это раздражает, но это также позволяет вам манипулировать частями выражений, если вы того хотите, так что в этом есть определенный смысл.\u003C\u002Fp\u003E\u003Cp\u003EТот факт, что препроцессор ничего не знает про арифметику, делая исключительно текстовые подстановки, несколько затрудняет жизнь. Давайте сделаем первую попытку:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003Essloy@home:~$ gcc -P -E - &lt;&lt;&lt;'\n#define DEC(n) n - 1\n\nDEC(3)\n'\n3 - 1\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EДля наглядности я буду запускать gcc сразу на коде из командной строки, так что вы видите и сам код, и результат работы препроцессора. Итак, макрокоманда \u003Ccode\u003EDEC(3)\u003C\u002Fcode\u003E, разворачивается не в желаемую константу \u003Ccode\u003E2\u003C\u002Fcode\u003E, а в выражение \u003Ccode\u003E3-1\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Cp\u003EНе беда, давайте попробуем чуть схитрить, используя возможности склеивания лексем:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003Essloy@home:~$ gcc -P -E - &lt;&lt;&lt;'\n#define DEC(n) DEC_##n\n#define DEC_0 0\n#define DEC_1 0\n#define DEC_2 1\n#define DEC_3 2\n\nDEC(3)\nDEC(DEC(3))\n'\n2\nDEC_DEC(3)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EКогда мы разворачиваем \u003Ccode\u003EDEC(3)\u003C\u002Fcode\u003E, то в происходит склеивание лексем \u003Ccode\u003EDEC_\u003C\u002Fcode\u003E и \u003Ccode\u003E3\u003C\u002Fcode\u003E, и создаётся новая лексема \u003Ccode\u003EDEC_3\u003C\u002Fcode\u003E, которая развёртывается в \u003Ccode\u003E2\u003C\u002Fcode\u003E, отлично! А вот с \u003Ccode\u003EDEC(DEC(3))\u003C\u002Fcode\u003E фокус не прошёл, почему? Не зря я правила разворачивания макрокоманд приводил, склеивание происходит на этап раньше развёртывания параметров, и поэтому код в реальности делает не то, что кажется на первый взгляд: мы приклеиваем лексему \u003Ccode\u003EDEC_\u003C\u002Fcode\u003E к неразвёрнутому тексту параметра \u003Ccode\u003EDEC(3)\u003C\u002Fcode\u003E, и на этом всё останавливается. Этому горю помочь несложно, достаточно спрятать склеивание на один уровень глубже:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003Essloy@home:~$ gcc -P -E - &lt;&lt;&lt;'\n#define CONCAT(a,b) a##b\n\n#define DEC(n) CONCAT(DEC_,n)\n#define DEC_0 0\n#define DEC_1 0\n#define DEC_2 1\n#define DEC_3 2\n\nDEC(3)\nDEC(DEC(3))\nDEC(DEC(DEC(3)))\n&gt; '\n2\n1\n0\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EЯ объявил макрокоманду склеивания двух лексем \u003Ccode\u003ECONCAT\u003C\u002Fcode\u003E, и все проблемы пропали, декремент прекрасно работает, оперируя сразу численными константами, а не выражениями. Обратите внимание, что в данном коде я не могу декрементировать, например, 4. Вполне правомерен вопрос: а насколько это вообще разумно, хотеть определять по макрокоманде на каждое численное значние? Краткий ответ: про какую разумность может идти речь при программировании чисто на лексере?! Развёрнутый ответ: в данном случае декремент идёт по глубине рекурсии, и очень редко она бывает нужна дальше десятка-двух уровней.\u003C\u002Fp\u003E\u003Ch2\u003EВетвление\u003C\u002Fh2\u003E\u003Cp\u003EИтак, мы познакомились с самым главным: мы можем генерировать новые лексемы путём склеивания кусков, и эти лексемы могут быть именами других макрокоманд! В таком случае, ветвление труда не составит. Давайте посмотрим на следующий код:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003Essloy@home:~$ gcc -P -E - &lt;&lt;&lt;'\n#define IF_ELSE(b) CONCAT(IF_,b)\n#define IF_0(i) ELSE_0\n#define IF_1(i) i ELSE_1\n#define ELSE_0(e) e\n#define ELSE_1(e)\n\nIF_ELSE(1)(then body)(else body)\nIF_ELSE(0)(then body)(else body)\n'\nthen body\nelse body\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Ccode\u003EIF_ELSE\u003C\u002Fcode\u003E - это макрокоманда, принимающая в качестве аргумента исключительно 0 или 1, и которая генерирует либо лексему \u003Ccode\u003EIF_0\u003C\u002Fcode\u003E, либо лексему \u003Ccode\u003EIF_1\u003C\u002Fcode\u003E путём тривиального склеивания. IF_0 - это команда, которая генерирует лексему ELSE_0, по пути просто съедая свои собственные аргументы. Ну а \u003Ccode\u003EELSE_0\u003C\u002Fcode\u003E - это просто тождественное отображение. Давайте проследим всю цепочку развёртывания \u003Ccode\u003EIF_ELSE(0)(then body)(else body):\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003EIF_ELSE(0)(then body)(else body)\nIF_0(then body)(else body)\nELSE_0(else body)\n(else body)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EРазворачивание с аргументом 1 происходит совершенно аналогично.\u003C\u002Fp\u003E\u003Ch2\u003EПроверка на равенство нулю\u003C\u002Fh2\u003E\u003Cp\u003EТеперь вы закалённые метапрограммисты, и не испугаетесь простой проверки на ноль :)\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003Essloy@home:~$ gcc -P -E - &lt;&lt;&lt;'\n#define SECOND(a, b, ...) b\n#define TEST(...) SECOND(__VA_ARGS__, 0)\n#define ISZERO(n) TEST(ISZERO_ ## n)\n#define ISZERO_0 ~, 1\n\nISZERO(0)\nISZERO(3)\n'\n1\n0\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EДавайте разбираться. Когда мы развёртываем \u003Ccode\u003EISZERO(n)\u003C\u002Fcode\u003E, то первое, что мы делаем (ещё раз смотрим в порядок разворачивания макрокоманд) - это склейка. В данном примере я тестировал \u003Ccode\u003EISZERO(0)\u003C\u002Fcode\u003E и \u003Ccode\u003EISZERO(3)\u003C\u002Fcode\u003E. Во втором случае мы генерируем лексему \u003Ccode\u003EISZERO_3\u003C\u002Fcode\u003E, а вот в первом \u003Ccode\u003EISZERO_0\u003C\u002Fcode\u003E, которая является именем уже существующей макрокоманды! А вот она, в свою очередь, разворачивается в список \u003Ccode\u003E~,1\u003C\u002Fcode\u003E . Это ключевой момент: Только передавая ноль в команду \u003Ccode\u003EISZERO\u003C\u002Fcode\u003E, мы внутри получим что-то, содержащее запятую. При передаче любого другого числа получится просто несуществующий токен. Нет, конечно, ничто нам не помешает засунуть в аргументы \u003Ccode\u003EISZERO\u003C\u002Fcode\u003E не число, а что-то, разворачивающееся так же, как и \u003Ccode\u003EISZERO_0\u003C\u002Fcode\u003E, но это же си, тут каждый может выстрелить себе в ногу, если ему так хочется :)\u003C\u002Fp\u003E\u003Cp\u003EОставшуюся работу делает вариативная макрокоманда \u003Ccode\u003ESECOND\u003C\u002Fcode\u003E, которая возвращает свой второй аргумент. Мы точно знаем, что она получит на вход как минимум два аргумента:  \u003Ccode\u003EISZERO(3)\u003C\u002Fcode\u003E разворачивается в \u003Ccode\u003ESECOND(ISZERO_3, 0)\u003C\u002Fcode\u003E, и в итоге получается 0. Ну а \u003Ccode\u003EISZERO(0)\u003C\u002Fcode\u003E разворачивается в \u003Ccode\u003ESECOND(~,1,0)\u003C\u002Fcode\u003E и сводится к 1. Значок тильды ~ здесь - это не магическая команда, он просто выбран от балды, поскольку вероятнее всего создаст синтаксическую ошибку при баге в наших макросах.\u003C\u002Fp\u003E\u003Ch2\u003EРекурсия\u003C\u002Fh2\u003E\u003Cp\u003EИтак, мы научились делать декремент, научились ветвить код по равенству нулю, остался последний рывок. Если вы сумели продраться через равенство нулю, вам теперь должно быть море по колено.\u003C\u002Fp\u003E\u003Cp\u003EОчень важно понимать, что все подстановки в макросах выполняются во время работы лексера, ещё \u003Cstrong\u003EДО\u003C\u002Fstrong\u003E запуска парсера. И именно парсер по идее должен заниматься рекурсиями (привет, полнота по Тьюрингу у темплейтов). А создатели лексера приложили значительные усилия, чтобы \u003Cstrong\u003Eрекурсивных вызовов не допустить\u003C\u002Fstrong\u003E.\u003C\u002Fp\u003E\u003Cp\u003EЭто необходимо для того, чтобы избежать бесконечной рекурсии при разворачивании макросов. Например, рассмотрим такой случай:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003Essloy@home:~$ gcc -P -E - &lt;&lt;&lt;'\n#define FOO F BAR\n#define BAR B FOO\n \nFOO\nBAR\n'\nF B FOO\nB F BAR\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EРаботает это так: препроцессор знает, какие макросы он разворачивает, и если во время раскрытия одного из макросов он снова его встречает, то \"помечает синим цветом\" (жаргон компиляторщиков) повторное появление лексемы, и оставляет её дальше как есть.\u003C\u002Fp\u003E\u003Cp\u003EДопустим, мы хотим развернуть лексему \u003Ccode\u003EFOO\u003C\u002Fcode\u003E. Препроцессор заходит в состояние \"разворачиваем \u003Ccode\u003EFOO\u003C\u002Fcode\u003E\", обрабатывает лексему \u003Ccode\u003EF\u003C\u002Fcode\u003E . Но когда он разворачивает макрос \u003Ccode\u003EBAR\u003C\u002Fcode\u003E, то снова встречает лексему \u003Ccode\u003EFOO\u003C\u002Fcode\u003E , и сразу же её помечает, запрещая дальнейшее раскрытие. Примерно такая же история при раскрытии макроса \u003Ccode\u003EBAR\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Cp\u003EА теперь давайте хитрить!\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003Essloy@home:~$ gcc -P -E - &lt;&lt;&lt;'\n#define FOO() F BAR\n#define BAR() B FOO\n\nFOO()()()()()()()()()\n'\nF B F B F B F B F BAR\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EЛюбопытно, любопытно. А что же произошло? А случилась крайне интересная вещь: мы превратили макрокоманду FOO в команду с параметрами. Давайте проследим два уровня развёртывания:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003EFOO()()()()()()()()()\nF BAR()()()()()()()()\nF B FOO()()()()()()() &lt;- вот тут FOO не помечен синим!\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EКогда мы второй раз встретились с \u003Ccode\u003EFOO\u003C\u002Fcode\u003E, лексер его не узнал, поскольку сгенерировал лексему \u003Ccode\u003EFOO\u003C\u002Fcode\u003E \u003Cstrong\u003Eбез параметров\u003C\u002Fstrong\u003E. И на этом обработка одной \u003Ccode\u003EFOO\u003C\u002Fcode\u003E закончилась. А затем лексер продолжил, обнаружил скобки, и вызвал \u003Ccode\u003EFOO\u003C\u002Fcode\u003E во второй раз.  А потом в третий. И четвёртый...\u003C\u002Fp\u003E\u003Cp\u003EИ тут мне пошла карта. Только вот рекурсия бывает не только хвостовой, но даже для хвостовой мне не хочется генерировать заранее все параметры :)\u003C\u002Fp\u003E\u003Cp\u003EНапоминаю, что прямой вызов \u003Ccode\u003EFOO()\u003C\u002Fcode\u003E внутри \u003Ccode\u003EBAR\u003C\u002Fcode\u003E не работает, нужно именно остановить контекст развёртывания макрокоманды прежде, чем встретится лексема этой же макрокоманды с параметрами. И, оказывается, это несложно сделать. Для начала давайте добавим пустую макрокоманду \u003Ccode\u003EEMPTY()\u003C\u002Fcode\u003E :\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003Essloy@home:~$ gcc -P -E - &lt;&lt;&lt;'\n#define EMPTY()\n#define FOO() F BAR EMPTY() ()\n#define BAR() B FOO EMPTY() ()\n\nFOO()\n\n#define EVAL(x) x\nEVAL(FOO())\nEVAL(EVAL(FOO()))\nEVAL(EVAL(EVAL(FOO())))\nEVAL(EVAL(EVAL(EVAL(FOO()))))\n'\nF BAR ()\nF B FOO ()\nF B F BAR ()\nF B F B FOO ()\nF B F B F BAR ()\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EТеперь при попытке разворачивания \u003Ccode\u003EFOO()\u003C\u002Fcode\u003E лексер создаёт лексему \u003Ccode\u003EF\u003C\u002Fcode\u003E, лексему \u003Ccode\u003EBAR\u003C\u002Fcode\u003E, не совпадающую с именем макрокоманды \u003Ccode\u003EBAR()\u003C\u002Fcode\u003E, обрабатывает пустую лексему, оставляет скобки \u003Ccode\u003E()\u003C\u002Fcode\u003E как есть. Всё, контекст \u003Ccode\u003EFOO()\u003C\u002Fcode\u003Eзавершился, и ничто не было покрашено синим! Только вот разворачивается \u003Ccode\u003EFOO()\u003C\u002Fcode\u003Eв весьма скучное \u003Ccode\u003EF BAR ()\u003C\u002Fcode\u003E, ровно как и раньше. Что же мы выиграли? А смотрите дальше по коду. Я определил макрокоманду тождественного отображения \u003Ccode\u003E#define EVAL(x) x\u003C\u002Fcode\u003E, и вот уже развёртывание \u003Ccode\u003EEVAL(FOO())\u003C\u002Fcode\u003E сильно интереснее. Давайте проследим всю цепочку (освежите в памяти правила развёртывания, особенно последнее):\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003EEVAL(FOO()) &lt;- заходим в контекст EVAL\nFOO()       &lt;- на этом этапе происходит развёртывание лексем параметров EVAL\nF BAR ()    &lt;- единственный параметр EVAL развёрнут\nF B FOO ()  &lt;- ПОВТОРНОЕ СКАНИРОВАНИЕ после разворачивания параметров EVAL!\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EНу, собственно, и всё. Обернув в два \u003Ccode\u003EEVAL\u003C\u002Fcode\u003E, пройдём дальше. В целом нужно (примерно) столько же обёрток \u003Ccode\u003EEVAL\u003C\u002Fcode\u003E, какая у нас глубина рекурсии, это можно обеспечить всего несколькими строчками кода. Давайте соберём всё вместе, напоминаю, что нам нужно получить подобие вот этого сишного кода, но с рекурсией на макросах!\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003Essloy@home:~$ gcc -xc - &lt;&lt;&lt;'\n#include &lt;stdio.h&gt;\nvoid foo(int d) {\n    printf(\"%d \", d);\n    if (d!=0) foo(d - 1);\n}\nint main() {\n    foo(3);\n    return 0;\n}\n' &amp;&amp; .\u002Fa.out\n3 2 1 0 ssloy@home:~$ \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EДа не вопрос вообще! Это простой копи-пейст вышеприведённых кусков кода. Единственный момент, с которым пришлось быть аккуратным, это ещё один уровень задержки на строчке 29, поскольку лексема \u003Ccode\u003EBAR\u003C\u002Fcode\u003E генерируется внутри команды ветвления, и нам нужно подождать ещё одну итерацию \u003Ccode\u003EEVAL\u003C\u002Fcode\u003E, чтобы \u003Ccode\u003EBAR\u003C\u002Fcode\u003E не покрасился.\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003Essloy@home:~$ gcc -xc - &lt;&lt;&lt;'\n#include &lt;stdio.h&gt;\n\n#define CONCAT(a,b) a##b\n\n#define DEC(n) CONCAT(DEC_,n)\n#define DEC_0 0\n#define DEC_1 0\n#define DEC_2 1\n#define DEC_3 2\n\n#define IF_ELSE(b) CONCAT(IF_,b)\n#define IF_0(i) ELSE_0\n#define IF_1(i) i ELSE_1\n#define ELSE_0(e) e\n#define ELSE_1(e)\n\n#define SECOND(a, b, ...) b\n#define TEST(...) SECOND(__VA_ARGS__, 0)\n#define ISZERO(n) TEST(ISZERO_ ## n)\n#define ISZERO_0 ~, 1\n\n#define EMPTY()\n#define FOO(d) \\\n    printf(\"%d \", d); \\\n    IF_ELSE(ISZERO(d)) \\\n    ( ) \\\n    ( BAR EMPTY EMPTY() () (DEC(d)) )\n#define BAR(d) FOO EMPTY() (d)\n\n#define EVAL(x)  EVAL1(EVAL1(EVAL1(x)))\n#define EVAL1(x) EVAL2(EVAL2(EVAL2(x)))\n#define EVAL2(x) EVAL3(EVAL3(EVAL3(x)))\n#define EVAL3(x) x\n\nint main() {\n    EVAL(FOO(3))\n    return 0;\n}\n' &amp;&amp; .\u002Fa.out \n3 2 1 0 ssloy@home:~$ \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EНу а исходник проклятого огня можно найти \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fssloy\u002Ftinycompiler\u002Fblob\u002Fmain\u002Fgfx\u002Ffire_cursed.c\" rel=\"noopener noreferrer nofollow\"\u003Eтут\u003C\u002Fa\u003E. Как и обещал, весь фреймбуфер хранится в скопище отдельных переменных, никаких массивов!\u003C\u002Fp\u003E\u003Ch2\u003EПолон ли по Тьюрингу препроцессор C?\u003C\u002Fh2\u003E\u003Cp\u003EВ разговорной речи термин \"Тьюринг-полный\" означает, что любой реальный компьютер общего назначения или компьютерный язык может приблизительно моделировать вычислительные аспекты любого другого реального компьютера общего назначения или компьютерного языка. Ни одна реальная система не может иметь бесконечную память, но если пренебречь ограничением конечной памяти, то большинство языков программирования в остальном являются Тьюринг-полными.\u003C\u002Fp\u003E\u003Cp\u003EУ препроцессора конечна не только память, но и количество уровней ре-сканирования лексем (которое мы задаём при помощи \u003Ccode\u003EEVAL\u003C\u002Fcode\u003E), но ведь это всего-навсего одна из форм ограничений по памяти, так что в обывательском смысле препроцессор вполне себе полон по Тьюрингу. \u003C\u002Fp\u003E\u003Cp\u003EУже после написания этой статьи, я нашёл ещё \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FHirrolot\u002Fmetalang99\" rel=\"noopener noreferrer nofollow\"\u003Eодну ссылку\u003C\u002Fa\u003E, где граждане натурально забабахали метаязык программирования исключительно на дефайнах, но это уже психопатство запредельного уровня, и, к сожалению, слишком сложное для первого знакомства с ч0рной магией препроцессора. Трюки, которые показал я, вполне ещё могут пойти в продакшн, а вот metalang99 - сомневаюсь :)\u003C\u002Fp\u003E\u003Ch2\u003EБонус\u003C\u002Fh2\u003E\u003Cp\u003EСовременные оптимизирующие компиляторы - это, пожалуй, самое сложное и впечатляющее творение человечества в области программной инженерии. Но это не значит, что там есть что-то магическое. Обычный человеческий мозг в несколько секунд скажет, во что должен скомпилироваться нижеприведённый весьма тривиальный код, а вот gcc понадобится куча экзабайт памяти и много-много лет, для того, чтобы дать ответ.\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EHidden text\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003E#define X1(x) X2(x)+X2(x)\n#define X2(x) X3(x)+X3(x)\n#define X3(x) X4(x)+X4(x)\n#define X4(x) X5(x)+X5(x)\n#define X5(x) X6(x)+X6(x)\n#define X6(x) X7(x)+X7(x)\n#define X7(x) X8(x)+X8(x)\n#define X8(x) X9(x)+X9(x)\n#define X9(x) X10(x)+X10(x)\n#define X10(x) X11(x)+X11(x)\n#define X11(x) X12(x)+X12(x)\n#define X12(x) X13(x)+X13(x)\n#define X13(x) X14(x)+X14(x)\n#define X14(x) X15(x)+X15(x)\n#define X15(x) X16(x)+X16(x)\n#define X16(x) X17(x)+X17(x)\n#define X17(x) X18(x)+X18(x)\n#define X18(x) X19(x)+X19(x)\n#define X19(x) X20(x)+X20(x)\n#define X20(x) X21(x)+X21(x)\n#define X21(x) X22(x)+X22(x)\n#define X22(x) X23(x)+X23(x)\n#define X23(x) X24(x)+X24(x)\n#define X24(x) X25(x)+X25(x)\n#define X25(x) X26(x)+X26(x)\n#define X26(x) X27(x)+X27(x)\n#define X27(x) X28(x)+X28(x)\n#define X28(x) X29(x)+X29(x)\n#define X29(x) X30(x)+X30(x)\n#define X30(x) X31(x)+X31(x)\n#define X31(x) X32(x)+X32(x)\n#define X32(x) X33(x)+X33(x)\n#define X33(x) X34(x)+X34(x)\n#define X34(x) X35(x)+X35(x)\n#define X35(x) X36(x)+X36(x)\n#define X36(x) X37(x)+X37(x)\n#define X37(x) X38(x)+X38(x)\n#define X38(x) X39(x)+X39(x)\n#define X39(x) X40(x)+X40(x)\n#define X40(x) X41(x)+X41(x)\n#define X41(x) X42(x)+X42(x)\n#define X42(x) X43(x)+X43(x)\n#define X43(x) X44(x)+X44(x)\n#define X44(x) X45(x)+X45(x)\n#define X45(x) X46(x)+X46(x)\n#define X46(x) X47(x)+X47(x)\n#define X47(x) X48(x)+X48(x)\n#define X48(x) X49(x)+X49(x)\n#define X49(x) X50(x)+X50(x)\n#define X50(x) X51(x)+X51(x)\n#define X51(x) X52(x)+X52(x)\n#define X52(x) X53(x)+X53(x)\n#define X53(x) X54(x)+X54(x)\n#define X54(x) X55(x)+X55(x)\n#define X55(x) X56(x)+X56(x)\n#define X56(x) X57(x)+X57(x)\n#define X57(x) X58(x)+X58(x)\n#define X58(x) X59(x)+X59(x)\n#define X59(x) X60(x)+X60(x)\n#define X60(x) X61(x)+X61(x)\n#define X61(x) X62(x)+X62(x)\n#define X62(x) X63(x)+X63(x)\n#define X63(x) X64(x)+X64(x)\n#define X64(x) x+x\n\nint main() {\n  return X1(0);\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Ch2\u003EПослесловие\u003C\u002Fh2\u003E\u003Cp\u003EНе забудьте выйти из хаба \"ненормальное программирование\", и \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F787800\u002F\" rel=\"noopener noreferrer nofollow\"\u003Eвернуться ко вполне нормальному.\u003C\u002Fa\u003E Have fun!\u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"ненормальное программирование"},{"titleHtml":"магия"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F46a\u002F150\u002F3cc\u002F46a1503ccbbf797056d52bfc376d67d2.png","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F46a\u002F150\u002F3cc\u002F46a1503ccbbf797056d52bfc376d67d2.png","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Farticles\\\u002F787442\\\u002F\"},\"headline\":\"Про́клятый огонь, или магия препроцессора C\",\"datePublished\":\"2024-01-21T19:13:13+03:00\",\"dateModified\":\"2024-01-22T14:42:18+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"haqreu\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Задавались ли вы когда-нибудь вопросом, можно ли полноценно программировать при помощи директивы #define в языке C? Полнота по Тьюрингу шаблонов C++ известна вес...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Farticles\\\u002F787442\\\u002F#post-content-body\",\"about\":[\"h_crazydev\",\"h_programming\",\"h_gamedev\",\"h_compilers\",\"h_c\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F787442\\\u002Ff704d8dfbaef90f8b54a3d4f48500430\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F95a\\\u002F012\\\u002F0b8\\\u002F95a0120b8893f5229f17f58795b482f4.gif\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F633\\\u002F236\\\u002F706\\\u002F633236706e88fc286fb92dac9185cb87.gif\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F241\\\u002F8b1\\\u002Fea3\\\u002F2418b1ea386e2188d1149d03b2795950.gif\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F1d0\\\u002F7b8\\\u002F337\\\u002F1d07b833793f2e5e3737303a9c239a70.gif\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F45f\\\u002F42b\\\u002Fbe5\\\u002F45f42bbe531a20e7993b079498a8e199.gif\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F740\\\u002F9b6\\\u002Fb27\\\u002F7409b6b27eea5884de0d830873b578df.gif\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F612\\\u002Fcf7\\\u002Ff1f\\\u002F612cf7f1f6fa8f37a051fe8d2ee0e30e.gif\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F8a6\\\u002F14c\\\u002F949\\\u002F8a614c94937966d14866b7a26c35382c.gif\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fc7a\\\u002Fd83\\\u002F168\\\u002Fc7ad83168922ebaf185e571e93e92da6.png\"]}","metaDescription":"Задавались ли вы когда-нибудь вопросом, можно ли полноценно программировать при помощи директивы #define в языке C? Полнота по Тьюрингу шаблонов C++ известна весьма широко, например, люди пишут...","mainImageUrl":null,"amp":true,"customTrackerLinks":[]},"polls":[],"commentsEnabled":{"status":true,"reason":null},"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"hasPinnedComments":false,"format":null,"banner":null,"multiwidget":null,"multiwidgetUuid":null,"readingTime":18,"complexity":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"postReasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":["787442","141206","592015","520920","792980","453700","325928","454414","511608","326328"],"viewedPosts":[],"myFeedFilter":{"complexity":"all","score":"all","types":["articles","posts","news"]},"myFeedIsApplyFilters":false,"myFeedIsForce":false,"karma":{"userReasonsList":null}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[{"title":"Программист С","vacanciesCount":41,"itemUrl":"https:\u002F\u002Fcareer.habr.com\u002Fvacancies\u002Fprogrammist_c","itemHubs":["c"]},{"title":"Разработчик игр","vacanciesCount":36,"itemUrl":"https:\u002F\u002Fcareer.habr.com\u002Fvacancies\u002Fgame_developer","itemHubs":["game_design","unity","gamedev","game_testing","unreal_engine","godot"]},{"title":"Unity разработчик","vacanciesCount":1,"itemUrl":"https:\u002F\u002Fcareer.habr.com\u002Fvacancies\u002Funity_developer","itemHubs":["unity","gamedev"]}],"hubs":"crazydev,programming,gamedev,compilers,c"},"comments":{"articleComments":{"787442":{"refs":{"26405186":{"id":"26405186","parentId":null,"level":0,"timePublished":"2024-01-21T16:44:10+00:00","timeChanged":"2024-01-21T16:45:32+00:00","isSuspended":false,"status":"published","score":-16,"votesCount":24,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cblockquote\u003E\u003Cp\u003Eможно ли полноценно программировать при помощи директивы \u003Ccode\u003E#define\u003C\u002Fcode\u003E в языке C?  \u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003Eможет сначала нужно было ответить на вопрос: \"А нужно ли?\". Вроде как Дефайны не раз были объявлены воплощением зла в программировании? Хотя, без них и в самом модном С++100500+, все также никуда, кажется.\u003C\u002Fp\u003E\u003Cp\u003EХотя, может я что-то пропустил ... ? какой-то сбой в матрице?\u003C\u002Fp\u003E\u003Cp\u003EНо вот для конструкций с битами в портах в embedded, лучше #define-ов не придумать, это точно. Я правда подзабыл как это было, никто не напомнит?\u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3278321","alias":"rukhi7","fullname":"Сергей","avatarUrl":null,"speciality":"software developer, радиоинженер"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26405188","26405644","26406774"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26405188":{"id":"26405188","parentId":"26405186","level":1,"timePublished":"2024-01-21T16:45:59+00:00","timeChanged":"2024-01-21T16:47:45+00:00","isSuspended":false,"status":"published","score":50,"votesCount":50,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cblockquote\u003E\u003Cp\u003Eможет сначала нужно было ответить на вопрос: \"А нужно ли?\". \u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EВы серьёзно задаёте этот вопрос по тексту, опубликованному в хабе \"ненормальное программирование\"? Впрочем, даже если так, то некоторые техники, которые я показал, могут оказаться полезными много где.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"907245","alias":"haqreu","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F94a\u002Fae6\u002Fd03\u002F94aae6d03dfb408e5f26bc21f42b49b6.png","speciality":"Довожу здравый смысл до абсурда"},"isAuthor":false,"isPostAuthor":true,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26405206"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":true},"26405206":{"id":"26405206","parentId":"26405188","level":2,"timePublished":"2024-01-21T16:53:15+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":1,"votesCount":1,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cblockquote\u003E\u003Cp\u003EВы серьёзно задаёте этот вопрос по тексту, опубликованному в хабе \"ненормальное программирование\"?  \u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003Eтак я же на него, вроде как, сам и ответил:\u003C\u002Fp\u003E\u003Cblockquote\u003E\u003Cp\u003EХотя, без них и в самом модном С++100500+, все также никуда, кажется.\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EТам есть другой вопрос, он намного интересней, мне кажется.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3278321","alias":"rukhi7","fullname":"Сергей","avatarUrl":null,"speciality":"software developer, радиоинженер"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26405400":{"id":"26405400","parentId":null,"level":0,"timePublished":"2024-01-21T18:09:26+00:00","timeChanged":"2024-01-21T18:10:06+00:00","isSuspended":false,"status":"published","score":2,"votesCount":2,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EВсё, описанное в статье, невероятно круто.\u003C\u002Fp\u003E\u003Cp\u003EЯ тут подумал… Интересно, а есть ли альтернативные встроенному препроцессоры, заточенные под C\u002F++, как LESS заточен под CSS? И что с их помощью можно было бы сделать, если бы они были? (Да, вот такая упячная постановка вопроса в духе «Есть ли жизнь на Марсе и как с ней бороться?» ;).\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"2684731","alias":"ImagineTables","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26406596","26408370","26412504"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26405402":{"id":"26405402","parentId":null,"level":0,"timePublished":"2024-01-21T18:10:09+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":23,"votesCount":23,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cblockquote\u003E\u003Cp\u003Eв несколько секунд скажет, во что должен скомпилироваться нижеприведённый весьма тривиальный код\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EВ слёзы :-D\u003C\u002Fp\u003E\u003Cp\u003EПару секунд прикидывал, сколько раз оно само с собой сложится, и тут заметил, что там ноль :-D\u003C\u002Fp\u003E\u003Cp\u003EЭто не просто программистская шутка, это классический анекдот с классической концовкой-переворотом, и несмотря на язык, на котором этот анекдот написан — я ржал как \u003Cs\u003Eконь\u003C\u002Fs\u003E \u003Cs\u003Eидиот\u003C\u002Fs\u003E конь-идиот :-D\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3390165","alias":"NickDoom","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F154\u002Ff53\u002F85b\u002F154f5385b6b485771c93d1c1b86a293e.gif","speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26405646","26406802"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26405644":{"id":"26405644","parentId":"26405186","level":1,"timePublished":"2024-01-21T19:52:48+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":1,"votesCount":1,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EЧасто при программировании под AVR использовал конструкции типа ON(PORT, N) и OFF(PORT, N). Сами конструкции были типа \u003Cem\u003E(PORT|=(1&lt;&lt;N))\u003C\u002Fem\u003E и (\u003Cem\u003EPORT&amp;=~(1&lt;&lt;N)).\u003C\u002Fem\u003E  \u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3922924","alias":"danek12","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26406294","26437056"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26405646":{"id":"26405646","parentId":"26405402","level":1,"timePublished":"2024-01-21T19:52:50+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":2,"votesCount":4,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EБудет 2^63 - 1 сложений. Нуля :)\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"2817473","alias":"Tihron","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26406062":{"id":"26406062","parentId":null,"level":0,"timePublished":"2024-01-22T01:21:54+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":1,"votesCount":1,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EСишный код вывел \"3 2 1 0\", а версия на макросах \"3 2 1\".\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"57054","alias":"iStyx","fullname":"Сергей Правдзивый","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F478\u002F2d5\u002F275\u002F4782d527566cfe58b2201b2e89539e2a.jpg","speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26406254"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26406186":{"id":"26406186","parentId":null,"level":0,"timePublished":"2024-01-22T04:27:41+00:00","timeChanged":"2024-01-22T04:30:02+00:00","isSuspended":false,"status":"published","score":5,"votesCount":5,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EПросто вопрос, правда не совсем в тему, интересно, может кто знает, когда делали старые игры, например Sonic, там же получается так же делали анимацию? Если да, то просто не представляю даже, чего стоило такие игры делать, во времена то были.\u003Cbr\u002F\u003E \u003C\u002Fp\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fcomment_images\u002F57f\u002F857\u002F649\u002F57f857649b5ca996b87131988fe2dee4.gif\" alt=\"Sonic the Hedgehog\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fcomment_images\u002F57f\u002F857\u002F649\u002F57f857649b5ca996b87131988fe2dee4.gif\"\u002F\u003E\u003Cdiv\u003E\u003Cfigcaption\u003ESonic the Hedgehog\u003C\u002Ffigcaption\u003E\u003C\u002Fdiv\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"1122490","alias":"DimaFromMai","fullname":"Дмитрий Первушин","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fc20\u002Ff41\u002Fb39\u002Fc20f41b392af46c8812705d3baf73277.jpg","speciality":"Пользователь"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26406250","26406252","26406562","26406642"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26406250":{"id":"26406250","parentId":"26406186","level":1,"timePublished":"2024-01-22T05:14:32+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":6,"votesCount":6,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EНасколько я помню, для анимирования использовалась циклическая смена палитры тайлов, поэтому так и создаётся эффект воды и водопада. \u003Cbr\u002F\u003E\u003Cbr\u002F\u003EХитрые приёмы, зато как классно работают) Можно почитать здесь на счёт архетектуры и приёмов в Genesis, если интересно: \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F471914\u002F\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F471914\u002F\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb20\u002F38a\u002F0b7\u002Fb2038a0b7a34901a44cb785557da975b.png\" width=\"1102\" height=\"848\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb20\u002F38a\u002F0b7\u002Fb2038a0b7a34901a44cb785557da975b.png\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"1874805","alias":"y_n_vasya","fullname":"Назар Тосюков","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fa96\u002F172\u002F8b6\u002Fa961728b611d3684008a4e2701ade189.png","speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26406252":{"id":"26406252","parentId":"26406186","level":1,"timePublished":"2024-01-22T05:14:39+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":5,"votesCount":5,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EНедавно читал тут на хабре \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompanies\u002Fruvds\u002Farticles\u002F775202\u002F\" rel=\"noopener noreferrer nofollow\"\u003Eстатью про палитровую анимацию\u003C\u002Fa\u003E, несколько примеров как-раз из Cоника было.\u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"253939","alias":"adcsan","fullname":"Александр","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F346\u002Fe06\u002Ff59\u002F346e06f59e972a2bffc9006658e99943.jpg","speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26406254":{"id":"26406254","parentId":"26406062","level":1,"timePublished":"2024-01-22T05:16:12+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":1,"votesCount":1,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EДа, действительно, в макросах у меня нет принта при d==0. Сейчас поправлю. Спасибо!\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"907245","alias":"haqreu","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F94a\u002Fae6\u002Fd03\u002F94aae6d03dfb408e5f26bc21f42b49b6.png","speciality":"Довожу здравый смысл до абсурда"},"isAuthor":false,"isPostAuthor":true,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":true},"26406294":{"id":"26406294","parentId":"26405644","level":2,"timePublished":"2024-01-22T05:38:47+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":1,"votesCount":1,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003Eвроде не так, там что-то хитрое было, была задача и было решение. Что-то про PortA.3\u003C\u002Fp\u003E\u003Cp\u003EPortB.5, DDRD.7, ...\u003C\u002Fp\u003E\u003Cp\u003EПридется искать - найду, напишу позже.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3278321","alias":"rukhi7","fullname":"Сергей","avatarUrl":null,"speciality":"software developer, радиоинженер"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26407444"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26406562":{"id":"26406562","parentId":"26406186","level":1,"timePublished":"2024-01-22T06:01:21+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":8,"votesCount":8,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EИгры во все времена выжимали и продолжают выжимать из железа максимум возможного. Другой вопрос, что тридцать лет назад инструменты были настолько убогими, что даже с простой архитектурой железа достигнутые результаты меня впечатляют до сих пор.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"907245","alias":"haqreu","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F94a\u002Fae6\u002Fd03\u002F94aae6d03dfb408e5f26bc21f42b49b6.png","speciality":"Довожу здравый смысл до абсурда"},"isAuthor":false,"isPostAuthor":true,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26430166"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":true},"26406596":{"id":"26406596","parentId":"26405400","level":1,"timePublished":"2024-01-22T06:12:49+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":2,"votesCount":2,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EЯ вчера немножко наспех и левой ногой написал этот комментарий, и хочу дополнить.\u003C\u002Fp\u003E\u003Cp\u003EЕсли встроенный препроцессор настолько ограничен, что автору пришлось всеми правдами и неправдами добиваться от него каких-то примитивных вещей, так неужели никто не думал написать свой, где рекурсия и прочее шли бы из коробки?\u003C\u002Fp\u003E\u003Cp\u003EА спрашивая «Для чего?», я имел в виду следующее. Я знаю, для чего он пригодился бы \u003Cem\u003Eмне\u003C\u002Fem\u003E. Но мне интересно послушать, как бы его использовали другие.\u003C\u002Fp\u003E\u003Cp\u003EДля чего он пригодился бы мне: мне давно не хватает нормальных макросов. Скажем, недавно тут публиковалась статья с примером такого ошибочного кода:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Evoid adns__querysend_tcp(adns_query qu, struct timeval now) {\n  ...\n  if (!(errno == EAGAIN || EWOULDBLOCK || \n        errno == EINTR || errno == ENOSPC ||\n        errno == ENOBUFS || errno == ENOMEM)) {\n  ...\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EЧтобы не допускать ошибок, предлагалось правильно форматировать код. С моей точки зрения, если эта ошибка — рак поджелудочной железы, то форматирование — это свекольный сок. А химиотерапией был бы \u003Ccode\u003Eis in set\u003C\u002Fcode\u003E. Только вот как его сделать? Единственное адекватное решение, которое мне предложили, когда я задал этот вопрос, включало в себя шаблоны и вызов функции. Шаблонам в нешаблонном коде делать нечего, это семантически неправильно и эстетически отвратительно, а оптимизация вызова всё ещё зависит от выбора правильного компилятора (и это не студия). И, конечно же, ни в какой стандартной библиотеке этой жизненно необходимой для избежания ошибок штуки нет.\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EПредложенный вариант на шаблонах\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode\u003E\u002F\u002F © vopl\n#include &lt;errno.h&gt;\n\ntemplate &lt;auto... set&gt;\nbool isin(auto val)\n{\n    return (false || ... || (set == val));\n}\n\nint main() \n{\n    \u002F\u002F \n    if(isin&lt;EAGAIN,\n            EWOULDBLOCK,\n            EINTR,\n            ENOSPC,\n            ENOBUFS,\n            ENOMEM&gt;(errno))\n    {\n        return 0;\n    }\n\n    return 1;\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EПравда, таскать дополнительный препроцессор это тот ещё геморрой, но если правильно его встроить в IDE, можно было бы видеть результирующий код только при отладке.\u003C\u002Fp\u003E\u003Cp\u003EЧто такое \u003Ca href=\"https:\u002F\u002Flesscss.org\u002F\" rel=\"noopener noreferrer nofollow\"\u003ELESS\u003C\u002Fa\u003E и CSS, я думаю, все знают и так, и почему я про них вспомнил — тоже.\u003C\u002Fp\u003E\u003Cp\u003EВ общем, чем дольше я думаю, тем больше хочу такой инструмент. Даже жаль, что в написании препроцессоров до автора мне далеко.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"2684731","alias":"ImagineTables","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26406788","26409676","26410230"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26406642":{"id":"26406642","parentId":"26406186","level":1,"timePublished":"2024-01-22T06:30:32+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":1,"votesCount":1,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003Eна PC подобные эффекты делали с помощью изменения палитры. На приставках - без понятия...\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3676843","alias":"DennisP","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26406774":{"id":"26406774","parentId":"26405186","level":1,"timePublished":"2024-01-22T07:11:31+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":2,"votesCount":2,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EНу чинить часы молотком также неудобно как и забивать гвозди микроскопом. Если использовать препроцессор не по назначению, то конечно он будет для вас \"злом\".\u003C\u002Fp\u003E\u003Cp\u003EДля данного хаба - самое то!\u003C\u002Fp\u003E\u003Cp\u003EЯ в далеком 2005 и сам занимался подобными \u003Ca href=\"https:\u002F\u002Frranamaru.blogspot.com\u002F2013\u002F07\u002Fblog-post_10.html\" rel=\"noopener noreferrer nofollow\"\u003Eизвращениями\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"383410","alias":"RranAmaru","fullname":"Андрей","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F454\u002Fe65\u002F07a\u002F454e6507ae62d809ba66a47e58fe017e.png","speciality":"Программист"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26406788":{"id":"26406788","parentId":"26406596","level":2,"timePublished":"2024-01-22T07:14:09+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":2,"votesCount":2,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cblockquote\u003E\u003Cp\u003Eтак неужели никто не думал написать свой, где рекурсия и прочее шли бы из коробки?  \u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EНу вроде m4 помощнее будет (хотя руками я его не щупал).\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3452259","alias":"unreal_undead2","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26407022"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26406802":{"id":"26406802","parentId":"26405402","level":1,"timePublished":"2024-01-22T07:16:29+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":3,"votesCount":3,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EДа, классическая задача с зернышками на шахматной доске (там же неспроста 64 макроса?), только на первой клетке... 0 зернышек!\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"763249","alias":"Gummilion","fullname":null,"avatarUrl":null,"speciality":"Программист Android\u002FiOS, Softvelum LLC"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26407022":{"id":"26407022","parentId":"26406788","level":3,"timePublished":"2024-01-22T08:16:51+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EСпасибо, не слышал про такой. Он, кстати, через три года будет праздновать юбилей — 50 лет ))\u003C\u002Fp\u003E\u003Cp\u003EЯ думал про что-нибудь более заточенное под задачу и более современное.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"2684731","alias":"ImagineTables","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26407372":{"id":"26407372","parentId":null,"level":0,"timePublished":"2024-01-22T09:47:54+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cblockquote\u003E\u003Cp\u003Eя нашёл \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fpfultz2\u002FCloak\u002Fwiki\u002FC-Preprocessor-tricks,-tips,-and-idioms\" rel=\"noopener noreferrer nofollow\"\u003Eправильную ссылку\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003Eглавное в такой ситуации не устроить случайно компилятору \u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FBillion_laughs_attack\" rel=\"noopener noreferrer nofollow\"\u003Ebillion laughs\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"675839","alias":"domix32","fullname":"Dmitry","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F7e2\u002Fa28\u002F279\u002F7e2a2827914de22fc9d32a5dc7976361.png","speciality":"Жопа котика"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26407386"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26407386":{"id":"26407386","parentId":"26407372","level":1,"timePublished":"2024-01-22T09:50:10+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":1,"votesCount":1,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EНу пример со сложением 2^64 количества нулей недалеко ушёл :)\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"907245","alias":"haqreu","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F94a\u002Fae6\u002Fd03\u002F94aae6d03dfb408e5f26bc21f42b49b6.png","speciality":"Довожу здравый смысл до абсурда"},"isAuthor":false,"isPostAuthor":true,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":true},"26407444":{"id":"26407444","parentId":"26406294","level":3,"timePublished":"2024-01-22T10:02:39+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EТакое, как минимум CVAVR умеет. Прикол АВРок в этом плане в том, что там есть специальные команды битового доступа до некоторой периферии. То есть в идеале мы должны получить одну машинную инструкцию на выходе, а не чтение-модификация-запись. Впрочем, и в СТМ32 есть похожий механизм. Если таки найдёте как грамотно внедрить такие конструкции, то буду признателен. \u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3190005","alias":"SuperTEHb","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26407788","26408928"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26407746":{"id":"26407746","parentId":null,"level":0,"timePublished":"2024-01-22T11:13:57+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003Eпо алгоритму огня - ощущение постоянной скорости изменения (\"горения\"), что выглядит не совсем натурально\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3996822","alias":"FromMEwithLove","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26407760"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26407760":{"id":"26407760","parentId":"26407746","level":1,"timePublished":"2024-01-22T11:17:01+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":1,"votesCount":1,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EТут вопрос компромисса: нужно максимизировать визуальный результат при минимизации количества и сложности строк кода. Присылайте пулл реквест :)\u003Cbr\u002F\u003E\u003Cbr\u002F\u003EКстати, спойлер: следующая моя демка будет с гидродинамикой сглаженных частиц.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"907245","alias":"haqreu","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F94a\u002Fae6\u002Fd03\u002F94aae6d03dfb408e5f26bc21f42b49b6.png","speciality":"Довожу здравый смысл до абсурда"},"isAuthor":false,"isPostAuthor":true,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":true},"26407788":{"id":"26407788","parentId":"26407444","level":4,"timePublished":"2024-01-22T11:23:13+00:00","timeChanged":"2024-01-22T11:25:57+00:00","isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003Eкак-то так было:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003E\u002F\u002F Макросы\n#define set_out2(port, bit) do { DDR ## port  |= (1&lt;&lt;bit) } while(0)\n#define set_in2(port, bit) do { DDR ## port  &amp;= ~(1&lt;&lt;bit) } while(0)\n#define on2(port, bit) do { PORT ## port  |= (1&lt;&lt;bit) } while(0)\n\n#define set_out(...) set_out2(__VA_ARGS__)\n#define set_in(...) set_in2(__VA_ARGS__)\n#define on(...) on2(__VA_ARGS__)\n\u002F\u002F определяем порт (обратите внимание - задана буква порта, PORT\u002FPIN\u002FDDR приписываем к нему в макросах через ##)\n#define W1 C, 5\n \n\u002F\u002F настраиваем порт\nset_out(W1);\n\u002F\u002F используем\non(W1);\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fwww.cyberforum.ru\u002Favr\u002Fthread2085120.html?ysclid=lrotusre6p510994698\" rel=\"noopener noreferrer nofollow\"\u003Eвот здесь\u003C\u002Fa\u003E вот нашел что-то похожее на то что я имел ввиду. Но у меня не было __\u003Cstrong\u003EVA_ARGS__, \u003C\u002Fstrong\u003Eэто что-то и для меня уже новенькое.\u003C\u002Fp\u003E\u003Cp\u003EЯ сам уже с портами несколько лет ничего не писал, своих проектов не найду ни как.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EА! вот! по той же ссылке, найдите\u003C\u002Fstrong\u003E:\u003C\u002Fp\u003E\u003Cp\u003Eчтобы с компиляторозависимыми __VA_ARGS__ не связываться, можно просто еще раз в дополнительные макросы с одним аргументом обернуть:  \u003C\u002Fp\u003E\u003Cp\u003E...\u003C\u002Fp\u003E\u003Cp\u003EВот такого вида дефайны имелись в виду, по крайней мере очень похоже на то что меня когда-то впечатлило.\u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3278321","alias":"rukhi7","fullname":"Сергей","avatarUrl":null,"speciality":"software developer, радиоинженер"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26407924"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26407924":{"id":"26407924","parentId":"26407788","level":5,"timePublished":"2024-01-22T12:02:11+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EЭх, а я уж губу раскатал на прямой битовый доступ. \u003C\u002Fp\u003E\u003Cp\u003EВместо подобных \"функций\" с передачей порта и бита себе сразу пишу конструкции типа\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003E#define LedON() GPIOB-&gt;BSRR |= GPIO_BSRR_BS_1\n#define LedOFF() GPIOB-&gt;BSRR |= GPIO_BSRR_BR_1\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EПросто потому что знаю, что в данном конкретном проекте у меня светодиод висит на первой ноге порта Б и в процессе работы никуда не девается. Это для СТМов, где есть специальный регистр для изменения отдельных битов порта, не затрагивающий другие. Тоже получается чисто запись, а не чтение-модификация-запись.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3190005","alias":"SuperTEHb","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26408120","26414868"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26408120":{"id":"26408120","parentId":"26407924","level":6,"timePublished":"2024-01-22T12:48:13+00:00","timeChanged":"2024-01-22T12:49:43+00:00","isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cblockquote\u003E\u003Cp\u003EТоже получается чисто запись, а не чтение-модификация-запись.  \u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003Eтам дело не в этом, а в том что когда функция (светодиод например, или управление кем то) перетаскивается с одной ноги на другую, не надо по всему проекту строчки искать которые ее используют, просто меняете в дефайне номер порта и номер пина. На самом деле это очень полезная штука, и в коде лучше понятно с какой функцией мы работаем.\u003C\u002Fp\u003E\u003Cp\u003EТипа так:\u003C\u002Fp\u003E\u003Cp\u003Eвместо LedON()   \u003C\u002Fp\u003E\u003Cp\u003ETurnOn(LedX)\u003C\u002Fp\u003E\u003Cp\u003Eсоответственно можно для какого-нибудь ControlY\u003C\u002Fp\u003E\u003Cp\u003ETurnOn(ControlY)\u003C\u002Fp\u003E\u003Cp\u003EТо есть не надо для каждой ноги свой Дефайн писать!\u003C\u002Fp\u003E\u003Cp\u003EИ функции в одном месте по ногам выписаны в виде порт:пин - вот это меня особенно порадовало, я помню, когда у меня такой список в коде появился!\u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3278321","alias":"rukhi7","fullname":"Сергей","avatarUrl":null,"speciality":"software developer, радиоинженер"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26408202"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26408202":{"id":"26408202","parentId":"26408120","level":7,"timePublished":"2024-01-22T13:02:20+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EТак ведь та же история и выходит. Что LedX определить, что LedON() сделать. Всё в main.h какой-нибудь вынести, вот в одном месте и получается. Не вижу явных плюсов или минусов.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3190005","alias":"SuperTEHb","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26408302"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26408302":{"id":"26408302","parentId":"26408202","level":8,"timePublished":"2024-01-22T13:21:30+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cblockquote\u003E\u003Cp\u003EЧто LedX определить, что LedON() сделать.  \u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003Eну так плюсы появляются когда у вас много пинов с разными функциями как пины используются. Когда у вас Led1 .. Led9 и\u003C\u002Fp\u003E\u003Cp\u003Eнапример, Key1 .. Key 5\u003C\u002Fp\u003E\u003Cp\u003Eи фиг знает какие еще пины, в общем если есть штук десять пинов в работе, и если их просто начинаешь проверять-искать по всему коду или\u003C\u002Fp\u003E\u003Cp\u003Eони у тебя определены как дефайны и подписаны как функции ноги, и используются везде только по имени функции\u003C\u002Fp\u003E\u003Cp\u003Eто чуствуешь разницу с таким подходом.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3278321","alias":"rukhi7","fullname":"Сергей","avatarUrl":null,"speciality":"software developer, радиоинженер"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26408374"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26408370":{"id":"26408370","parentId":"26405400","level":1,"timePublished":"2024-01-22T13:38:23+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":1,"votesCount":1,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003Eя добавлял рекурсию в макросы в ллвм, но как-то всё остановилось, т.к. все боятся препроцессора как огня (в коммитете)\u003Cbr\u002F\u003E\u003Cbr\u002F\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fllvm\u002Fllvm-project\u002Fpull\u002F65851\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fllvm\u002Fllvm-project\u002Fpull\u002F65851\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"2666821","alias":"Kelbon","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26408374":{"id":"26408374","parentId":"26408302","level":9,"timePublished":"2024-01-22T13:39:44+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cblockquote\u003E\u003Cp\u003Eначинаешь проверять-искать по всему коду  \u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EУ нас явно возникло какое-то досадное недопонимание. Зачем по всему? Один раз дефайном объявляется LedON() на светодиод, или наоборот, всякие IsEnable() для опроса состояния ноги-входа и всё, дальше уже используются. При изменении порта все правки по-прежнему происходят в одном месте. Хоть одна нога, хоть десять, всё равно все правки ровно однократные и в одном месте. Точно так же, как однократно объявить TurnOn() и пучок LedX.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3190005","alias":"SuperTEHb","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26408440"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26408440":{"id":"26408440","parentId":"26408374","level":10,"timePublished":"2024-01-22T13:54:21+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cblockquote\u003E\u003Cp\u003EОдин раз дефайном объявляется LedON() на светодиод  \u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003Eа если у нас три светодиода?\u003C\u002Fp\u003E\u003Cp\u003EНо все это конечно не чудо, вопрос только в том есть ли желание попробовать другую технику. Вы решили что вам не к чему. Я уважаю ваше решение.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3278321","alias":"rukhi7","fullname":"Сергей","avatarUrl":null,"speciality":"software developer, радиоинженер"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26408800":{"id":"26408800","parentId":null,"level":0,"timePublished":"2024-01-22T15:24:44+00:00","timeChanged":"2024-01-22T15:25:09+00:00","isSuspended":false,"status":"published","score":2,"votesCount":2,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EПомню, работал в одной из контор... STM32, память только набортная, динамической аллокации нет. Зато есть не SQL БД и вебморда правления миром. Нужно было как-то объявлять переменные на стеке такого размера, чтобы они были размером с поле в БД, и чтобы другие разрабы не косячили с памятью, ошибаясь в размерах. \u003C\u002Fp\u003E\u003Cp\u003EНесколько дней почитал статьи про двухпроходный препроцессор и сгородил что-то типа табличной структуры на макросах, когда одной строкой мы получали содержимое ячейки. Ну оно заработало, удачно, ошибок в коде не было, все макросами пользовались. \u003C\u002Fp\u003E\u003Cp\u003EПрошёл годик, я решил вспомнить как же оно работает... И не вспомнил \u002F не понял... Ну, работает и ладно :) \u003C\u002Fp\u003E\u003Cp\u003EБудьте осторожны в ваших макросах :) \u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3485923","alias":"AndronNSK","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26408928":{"id":"26408928","parentId":"26407444","level":4,"timePublished":"2024-01-22T16:00:10+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EЭто называется Bit-Banding. Грамотно внедрить его можете сами, достаточно немного почитать документацию. А еще есть такие полезные регистры в GPIO как BSRR и BRR, которые позволяют менять состояния пинов без RMW.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"1383018","alias":"dmitrystu","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F96b\u002F5ea\u002F651\u002F96b5ea6519d045185faf85f276fa2ce0.png","speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26412266"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26409676":{"id":"26409676","parentId":"26406596","level":2,"timePublished":"2024-01-22T19:31:57+00:00","timeChanged":"2024-01-22T19:32:20+00:00","isSuspended":false,"status":"published","score":4,"votesCount":4,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EМожно без шаблонов (если не считать таковым сам initializer_list) и читабельнее:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Ebool in(const int test_value, const std::initializer_list&lt;int&gt; values) {\n  for (const auto &amp; value : values)\n  {\n    if (test_value == value)\n    {\n      return true;\n    }\n  }\n\n  return false;\n}\n\u002F\u002F И где-то ниже\nif (!in(errno, {EAGAIN, EWOULDBLOCK, EINTR, ENOSPC, ENOBUFS, ENOMEM}))\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EХотя ещё лучше сделать in шаблоном и вместо int использовать T.\u003Cbr\u002F\u003EНо в любом случае это не шаблоны на списке типов, где каждый новый список - это новая сгенерированная функция.\u003Cbr\u002F\u003EА вообще в c++ появляется всё больше разного для замены макросов. И в шаблонах, и, например, constexpr\u002Fconsteval для вычисления в compile time.\u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"57558","alias":"Woodroof","fullname":"Данил Ильиных","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F410\u002F8d8\u002Fcb9\u002F4108d8cb918a909606cf038b6cfb2892.png","speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26410006":{"id":"26410006","parentId":null,"level":0,"timePublished":"2024-01-22T21:47:30+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":3,"votesCount":3,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EЯ, честно говоря, немного прифигел. Не думал, что отрисовка огня - настолько простая задача\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"2510563","alias":"QWERTYUIOPas","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F60a\u002F567\u002F192\u002F60a56719212663cc39b407e13e1ea387.gif","speciality":"Пользователь"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26410014"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26410014":{"id":"26410014","parentId":"26410006","level":1,"timePublished":"2024-01-22T21:49:19+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":1,"votesCount":1,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EВот спасибо вам за комментарий, ради таких реакций (меня устраивают внутренние, не обязательно произносить) я и пишу тексты.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"907245","alias":"haqreu","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F94a\u002Fae6\u002Fd03\u002F94aae6d03dfb408e5f26bc21f42b49b6.png","speciality":"Довожу здравый смысл до абсурда"},"isAuthor":false,"isPostAuthor":true,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":true},"26410230":{"id":"26410230","parentId":"26406596","level":2,"timePublished":"2024-01-22T23:47:01+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EКонкретно в этом случае (если там условно только return false) как раз switch-case с fallthrough подходит? Но если развивать идею, то куски кода побольше уже в нужный case не засунешь. А выпригивать из switch в опрятный код ничем не лучше.\u003C\u002Fp\u003E\u003Cp\u003EЧестно, конструкция понравилась. Странно, что её нет в языках.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"349563","alias":"VADemon","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Ff4f\u002F22d\u002Fc44\u002Ff4f22dc442931200c06fe18fb99e023a.png","speciality":"User"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26411000"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26411000":{"id":"26411000","parentId":"26410230","level":3,"timePublished":"2024-01-23T07:15:19+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":1,"votesCount":1,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003Eswitch не подходит по многим причинам.\u003C\u002Fp\u003E\u003Cp\u003EВо-первых, как мне было указано, в некоторых реализациях некоторые значения множеств из приведённого примера совпадают, а это приведёт к ошибке компиляции.\u003C\u002Fp\u003E\u003Cp\u003EВо-вторых, цель в том, чтобы уменьшить число ошибок, а если заниматься тем, что выражать отрицание через default, по-моему, ошибок в итоге будет больше.\u003C\u002Fp\u003E\u003Cp\u003EВ-третьих, и вообще, выразительность хромает.\u003C\u002Fp\u003E\u003Cblockquote\u003E\u003Cp\u003EЧестно, конструкция понравилась. Странно, что её нет в языках.\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EИменно потому мне и не хватает нормальных макросов.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"2684731","alias":"ImagineTables","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26412266":{"id":"26412266","parentId":"26408928","level":5,"timePublished":"2024-01-23T11:20:26+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EВ СТМах без проблем, там, как вы и пишете, отдельные регистры для таких манёвров. А вот в АВРах не регистр, а отдельная команда. Это было бы интереснее из С.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3190005","alias":"SuperTEHb","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26413278"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26412504":{"id":"26412504","parentId":"26405400","level":1,"timePublished":"2024-01-23T12:13:34+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EУпоминали М4, но он ужасен. Общий принцип: если хотите сложную кодогенерацию, лучше взять условный питон и засунуть его в prebuild шаг сборки. Отладка макросов это очень больно.\u003C\u002Fp\u003E\u003Cp\u003EВ принципе, можно сломать мозг и попробовать осмыслить препроцессор как РЕФАЛ-машину с её подстановками и без присваивания, но практический смысл околонулевой.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"269733","alias":"Gryphon88","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26412736"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26412530":{"id":"26412530","parentId":null,"level":0,"timePublished":"2024-01-23T12:17:23+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":1,"votesCount":1,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EЕсли вы любите такого рода магию, посмотрите на библиотеку \u003Ca href=\"https:\u002F\u002Fgustedt.gitlabpages.inria.fr\u002Fp99\u002Fp99-html\u002Findex.html\" rel=\"noopener noreferrer nofollow\"\u003EP99\u003C\u002Fa\u003E за авторством Jens Gustedt. За использование на проде меня один раз побили.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"269733","alias":"Gryphon88","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26412736":{"id":"26412736","parentId":"26412504","level":2,"timePublished":"2024-01-23T12:55:10+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cblockquote\u003E\u003Cp\u003Eесли хотите сложную кодогенерацию, лучше взять условный питон\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EИМХО, в этом вопросе главное — синтаксис и стоящие за ним идеи (у меня их нет), а не то, на чём и как это писать.\u003C\u002Fp\u003E\u003Cblockquote\u003E\u003Cp\u003EОтладка макросов это очень больно.\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EОпять же ИМХО, но это касается только встроенного препроцессора. (Вроде бы, студию вообще нельзя заставить выдать код после обработки). Если сделать внешний препроцессор в виде плагина к IDE, чтобы он при отладке переключался на сгенерированный код, откуда возьмётся боль?\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"2684731","alias":"ImagineTables","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26412784"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26412784":{"id":"26412784","parentId":"26412736","level":3,"timePublished":"2024-01-23T13:03:20+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":1,"votesCount":1,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003Eпро питон это я в целях удобства и понимаемости, чтобы писать \"шаблоны\" в той же парадигме, что и остальной код. Касательно отладки макросов: пока все просто, понятно, во что развернется макрос, а вот если попробуете добавить в код полиформизм с помощью макросов или еще что хитрое, там начинается конкатенация токенов, в итоге вы ловите ошибку компиляции из-за криво развернувшегося макроса, а почему он криво развернулся - только руками, ide поможет слабо, максимум - пошаговым разворачиванием.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"269733","alias":"Gryphon88","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26412860","26413236"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26412860":{"id":"26412860","parentId":"26412784","level":4,"timePublished":"2024-01-23T13:15:20+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EТеперь я понял.\u003C\u002Fp\u003E\u003Cp\u003EНуууууууу… это как с шаблонными классами и алгоритмами, ИМХО. В том смысле, что нормальный (в математическом смысле) прикладник ими только пользуется. Конечно, это не C++ way, но лично я был бы счастлив.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"2684731","alias":"ImagineTables","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26413236":{"id":"26413236","parentId":"26412784","level":4,"timePublished":"2024-01-23T14:30:03+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cblockquote\u003E\u003Cp\u003Eчтобы писать \"шаблоны\" в той же парадигме, что и остальной код  \u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EC\u002FC++ с препроцессингом на питоне - это скорее адская смесь, чем общая парадигма. Тут хороший пример - Лисп, где макросы пишутся на том же языке, что основной код, и синтаксис просто мапится на удобные для обработки структуры данных - но не всем такой синтаксис нравится )\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3452259","alias":"unreal_undead2","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26413358"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26413278":{"id":"26413278","parentId":"26412266","level":6,"timePublished":"2024-01-23T14:38:03+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EAVR вообще значительно проще устроен. Я не только про ядро, я про вообще. Такие штуки зависят от реализации конкретной периферии в конкретном микроконтроллере, ну или в серии.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"1383018","alias":"dmitrystu","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F96b\u002F5ea\u002F651\u002F96b5ea6519d045185faf85f276fa2ce0.png","speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26413358":{"id":"26413358","parentId":"26413236","level":5,"timePublished":"2024-01-23T14:51:16+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EЛисп, конечно, идеал, но питон на С похож больше, чем собственный сёвый препроцессор)\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"269733","alias":"Gryphon88","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26414868":{"id":"26414868","parentId":"26407924","level":6,"timePublished":"2024-01-23T22:01:14+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":1,"votesCount":1,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cpre\u003E\u003Ccode\u003E\n\u002F*******************************************************************************\n  port\n*******************************************************************************\u002F\n\u002F\u002F port \n#define A0_PORT                 GPIOA\n#define A1_PORT                 GPIOA\n...\n..\n\n\u002F*******************************************************************************\n  pin\n*******************************************************************************\u002F\n\u002F\u002F port A\n#define A0_PIN                  GPIO_PIN_0\n#define A1_PIN                  GPIO_PIN_1\n...\n..\n\n\u002F*******************************************************************************\n  macro\n*******************************************************************************\u002F\n\n#define GPIO_PORT_(x)           x##_PORT\n#define GPIO_PIN_(x)            x##_PIN\n#define GPIO_PORT_NUM_(x)       x##_PORT_NUM\n#define GPIO_PIN_NUM_(x)        x##_PIN_NUM\n\n#define GPIO_PORT(x)            GPIO_PORT_(x)\n#define GPIO_PIN(x)             GPIO_PIN_(x)\n#define GPIO_PORT_NUM(x)        GPIO_PORT_NUM_(x)\n#define GPIO_PIN_NUM(x)         GPIO_PIN_NUM_(x)\n\n\u002F\u002Fpin config\n#define GPIO_CONFIG_IN_M(pin)           (GPIO_PORT_(pin)-&gt;MODER &amp;= ~(3U&lt;&lt;(2*GPIO_PIN_NUM_(pin))))\n#define GPIO_CONFIG_OUT_M(pin)          (GPIO_PORT_(pin)-&gt;MODER |= 1&lt;&lt;(2*GPIO_PIN_NUM_(pin)))\n\n\u002F\u002F pin set\n#define GPIO_READ_PIN_M(pin)            (GPIO_PORT_(pin)-&gt;IDR &amp; GPIO_PIN_(pin))\n#define GPIO_SET_PIN_M(pin)             (GPIO_PORT_(pin)-&gt;BSRR = GPIO_PIN_(pin))\n#define GPIO_RESET_PIN_M(pin)           (GPIO_PORT_(pin)-&gt;BRR = GPIO_PIN_(pin))\n\n\u002F\u002F port set\n#define GPIO_SET_PORT_M(port, value)    (port-&gt;BSRR = value)\n#define GPIO_RESET_PORT_M(port, value)  (port-&gt;BRR = value)\n#define GPIO_ASSIGN_PORT_M(port, value) (port-&gt;ODR = value)\n\n\u002F\u002Fработает так\n#define LED_RED    A1  \nGPIO_SET_PIN_M(LED_RED)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"588937","alias":"Dark_Purple","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F1fc\u002Ff32\u002F92e\u002F1fcf3292efe1c8ec6d10a74710d74da5.jpg","speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26415564"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26415564":{"id":"26415564","parentId":"26414868","level":7,"timePublished":"2024-01-24T05:47:29+00:00","timeChanged":"2024-01-24T05:48:03+00:00","isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003Eага, вот оно. А я только версию для АВР-ов раньше видел значит, эта еще интереснее. \u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3278321","alias":"rukhi7","fullname":"Сергей","avatarUrl":null,"speciality":"software developer, радиоинженер"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26430166":{"id":"26430166","parentId":"26406562","level":2,"timePublished":"2024-01-27T19:35:06+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EПривет, как  с продолжением о троичном процессоре?\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3069665","alias":"pluton_tut","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["26430170"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"26430170":{"id":"26430170","parentId":"26430166","level":3,"timePublished":"2024-01-27T19:35:38+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F787800\u002Fcomments\u002F#comment_26405162\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F787800\u002Fcomments\u002F#comment_26405162\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"907245","alias":"haqreu","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F94a\u002Fae6\u002Fd03\u002F94aae6d03dfb408e5f26bc21f42b49b6.png","speciality":"Довожу здравый смысл до абсурда"},"isAuthor":false,"isPostAuthor":true,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":true},"26437056":{"id":"26437056","parentId":"26405644","level":2,"timePublished":"2024-01-29T14:09:23+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003Esbi и cbi\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"2353579","alias":"Chernysh_Aleksandr","fullname":"Черныш Александр","avatarUrl":null,"speciality":"электромонтер"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"27626270":{"id":"27626270","parentId":null,"level":0,"timePublished":"2024-12-02T21:31:06+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EЕсть ли способ пометить участок кода так, чтобы Си препроцессор его не менял? \u003C\u002Fp\u003E\u003Cp\u003EЧтобы как встретилась строка #include &lt;file.h&gt; так и осталась в первозданном виде.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"975476","alias":"aabzel","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Ffb1\u002F27d\u002F698\u002Ffb127d69816e919a59f0f232e14517e0.jpg","speciality":"Embedded SW\u002FFirmware Engineer"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["27629114","27705810"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"27629114":{"id":"27629114","parentId":"27626270","level":1,"timePublished":"2024-12-03T13:10:07+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EВ общем случае нет. А собственно зачем? Если препроцессор инклюд не выполнит, у вас ошибку компиляции кинет на неизвестный токен.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"269733","alias":"Gryphon88","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["27629280"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"27629280":{"id":"27629280","parentId":"27629114","level":2,"timePublished":"2024-12-03T13:37:57+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cblockquote\u003E\u003Cp\u003E\u003Cstrong\u003EА собственно зачем?\u003C\u002Fstrong\u003E Если препроцессор инклюд не выполнит, у вас ошибку компиляции кинет на неизвестный токен.  \u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EЯ Си-шный препроцессор cpp.exe использую для вёрстки на LaTex учебника по программированию с листингами Си кода.\u003Cbr\u002F\u003E\u003Cbr\u002F\u003EМне надо чтобы в одних строчках препроцессор работал, а в других -- нет.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"975476","alias":"aabzel","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Ffb1\u002F27d\u002F698\u002Ffb127d69816e919a59f0f232e14517e0.jpg","speciality":"Embedded SW\u002FFirmware Engineer"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"27630862":{"id":"27630862","parentId":null,"level":0,"timePublished":"2024-12-03T22:22:48+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EКак Си пре-процессрором cpp.exe вставить кусок текста макро функцией, сохранив при этом переносы строк?\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"975476","alias":"aabzel","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Ffb1\u002F27d\u002F698\u002Ffb127d69816e919a59f0f232e14517e0.jpg","speciality":"Embedded SW\u002FFirmware Engineer"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["27631586"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"27631586":{"id":"27631586","parentId":"27630862","level":1,"timePublished":"2024-12-04T06:51:36+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":3,"votesCount":3,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EА на другие препроцессоры (скажем, \u003Ca href=\"https:\u002F\u002Fwww.gnu.org\u002Fsoftware\u002Fm4\u002F\" rel=\"noopener noreferrer nofollow\"\u003Em4\u003C\u002Fa\u003E) не смотрели? Всё таки сишный препроцессор делался в первую очередь именно для C, а не для общего пользования.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3452259","alias":"unreal_undead2","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["27637116"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"27637116":{"id":"27637116","parentId":"27631586","level":2,"timePublished":"2024-12-05T12:23:34+00:00","timeChanged":"2024-12-05T12:23:54+00:00","isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EКак в m4 препроцессоре сделать аналог вот этой конструкции от cpp\u003C\u002Fp\u003E\u003Cp\u003E#ifdef HAS_XYZ\u003Cbr\u002F\u003E    #include \"file_xyz.txt\"\u003Cbr\u002F\u003E#endif\u003C\u002Fp\u003E\u003Cp\u003E?\u003C\u002Fp\u003E\u003Cp\u003EУсловная вставка содержимого файла.\u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"975476","alias":"aabzel","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Ffb1\u002F27d\u002F698\u002Ffb127d69816e919a59f0f232e14517e0.jpg","speciality":"Embedded SW\u002FFirmware Engineer"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["27637160"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"27637160":{"id":"27637160","parentId":"27637116","level":3,"timePublished":"2024-12-05T12:36:57+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EКак то \u003Ca href=\"https:\u002F\u002Fwww.eugeneweb.com\u002Fwiki\u002FSites\u002FM4Macros\" rel=\"noopener noreferrer nofollow\"\u003Eтак\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3452259","alias":"unreal_undead2","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["27637304"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"27637304":{"id":"27637304","parentId":"27637160","level":4,"timePublished":"2024-12-05T13:10:00+00:00","timeChanged":"2024-12-05T13:12:36+00:00","isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EЭта конструкция которую там предлагают\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Edefine(HAS_FILE1,1)\n\nifdef(HAS_FILE1, include(file1.txt), )\nifdef(HAS_FILE2, include(file2.txt), )\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003Eне работает. Рушится на первой же запятой внутри file1.txt.\u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"975476","alias":"aabzel","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Ffb1\u002F27d\u002F698\u002Ffb127d69816e919a59f0f232e14517e0.jpg","speciality":"Embedded SW\u002FFirmware Engineer"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["27637352"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"27637352":{"id":"27637352","parentId":"27637304","level":5,"timePublished":"2024-12-05T13:23:05+00:00","timeChanged":"2024-12-05T13:23:20+00:00","isSuspended":false,"status":"published","score":2,"votesCount":2,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003Eifdef(`foo', `include(`bar.csv')')\u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3452259","alias":"unreal_undead2","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"27705810":{"id":"27705810","parentId":"27626270","level":1,"timePublished":"2024-12-23T22:01:55+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003Eесли не против компиляторозависимости, то есть специальные #pragma под такое, вроде\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"3917174","alias":"XViivi","fullname":"Василевский Владимир","avatarUrl":null,"speciality":"Студент\u002F Геймдизайнер"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["27705824"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"27705824":{"id":"27705824","parentId":"27705810","level":2,"timePublished":"2024-12-23T22:07:43+00:00","timeChanged":"2024-12-23T22:08:38+00:00","isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EЯ уже решил проблему воспользовавшиcь \u003Ca href=\"https:\u002F\u002Fwww.gnu.org\u002Fsoftware\u002Fm4\u002Fm4.html\" rel=\"noopener noreferrer nofollow\"\u003Eпрепроцессором M4\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fwww.gnu.org\u002Fsoftware\u002Fm4\u002Fm4.html\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fwww.gnu.org\u002Fsoftware\u002Fm4\u002Fm4.html\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"975476","alias":"aabzel","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Ffb1\u002F27d\u002F698\u002Ffb127d69816e919a59f0f232e14517e0.jpg","speciality":"Embedded SW\u002FFirmware Engineer"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false}},"root":["26405186","26405400","26405402","26406062","26406186","26407372","26407746","26408800","26410006","26412530","27626270","27630862"]}},"articlePinnedComments":{"787442":{"refs":{},"commentIds":[]}},"searchCommentsResults":null,"pagesCount":null,"commentAccess":{"isCanComment":false,"cantCommentReasonKey":"AUTH_REQUIRED","cantCommentReason":"Authorization required","data":null},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":1734991663,"moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"multiwidgets":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"multiwidgetLoading":false,"vacancies":{},"companiesGalleries":{},"companiesBanners":{},"companiesLandingVacancies":{},"companiesTechnologies":{},"workplaceInfo":null},"companyAdmin":{"companyInfo":null,"companyInfoLoading":false,"faqArticles":null,"brandingPreviewImageUrl":null,"jivoStatus":0,"adminNotifications":null},"companyAdd":{"currentStep":"","stepsData":{},"uncompletedSteps":[],"isStepLoading":true,"isStepCommitting":false,"isInitialized":false,"agreementContent":""},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"pagesCount":0},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":true},"fixedBanner":{"isArticleStickyPanelVisible":false,"isArticleStickyPanelAtTheBottom":false,"isFixedBannerVisible":false,"isStickyPanelIconsHidden":false},"flows":{"flows":[{"alias":"develop","id":"1","route":{"name":"FLOW_PAGE","params":{"flowName":"develop","hl":"ru"}}},{"alias":"admin","id":"6","route":{"name":"FLOW_PAGE","params":{"flowName":"admin","hl":"ru"}}},{"alias":"design","id":"2","route":{"name":"FLOW_PAGE","params":{"flowName":"design","hl":"ru"}}},{"alias":"management","id":"3","route":{"name":"FLOW_PAGE","params":{"flowName":"management","hl":"ru"}}},{"alias":"marketing","id":"4","route":{"name":"FLOW_PAGE","params":{"flowName":"marketing","hl":"ru"}}},{"alias":"popsci","id":"7","route":{"name":"FLOW_PAGE","params":{"flowName":"popsci","hl":"ru"}}}],"updates":{}},"global":{"isPwa":false,"device":"desktop","isHabrCom":true,"requestId":"1948aff6aa04498a469a57522c30ada6"},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"welcomePage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"query":{},"pathname":"\u002Fru\u002Farticles\u002F787442\u002F","path":"\u002Fru\u002Farticles\u002F787442\u002F","href":"\u002Fru\u002Farticles\u002F787442\u002F"}},"me":{"user":null,"uuid":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null,"userUpdates":{"feeds":{"newPostsCount":null,"newThreadsCount":null,"newNewsCount":null,"newCount":null},"conversationUnreadCount":0}},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"onboarding":{"currentStep":null,"stepsData":{},"stepsErrors":{},"completedSteps":[],"isStepCommitting":false,"isCommitDisabled":true},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{"vacancies":"project-block-article"}},"promoData":{"isLoading":false,"hasLoaded":false,"featurer":null,"megaposts":null,"promoLinks":null,"promoPosts":null,"sticker":null},"publicationStatistics":{"statsInfo":{},"statsFunnels":{},"statsGraph":{},"defaultSuggest":{},"suggest":{},"timeTracker":{},"isTrackingActivity":false,"isUserActive":true},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"search":{"searchQueryError":null},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":true,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"stories":{"stories":[{"id":"story-974","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa93\u002F6c8\u002F872\u002Fa936c8872c4ca44d3875cd80e637f024.png","title":"Хабр","link":null},"title":"Годнота из блогов компаний","lang":"ru","startTime":"2025-02-12T15:35:00+03:00","finishTime":"2025-02-23T15:35:00+03:00","slides":[{"id":"story-974_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ffb5\u002F45c\u002F1d0\u002Ffb545c1d0c6a17849ccb68b6887406e2.jpg","button":null},{"id":"story-974_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1d8\u002F586\u002Fd09\u002F1d8586d099552fe713dcddc468d038fa.jpg","button":{"title":"Мнение","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompanies\u002Fnmg\u002Farticles\u002F797103\u002F","colorType":"light"}},{"id":"story-974_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F345\u002F59a\u002F0f1\u002F34559a0f1697690c31a81b4b393eda47.jpg","button":{"title":"Подробнее","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompanies\u002Fyandex\u002Farticles\u002F875070\u002F","colorType":"dark"}},{"id":"story-974_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6d3\u002F088\u002F27f\u002F6d308827f85c7c37a7a34f89ead93077.jpg","button":{"title":"Дорогу осилит идущий","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompanies\u002Fbitrix\u002Farticles\u002F878912\u002F","colorType":"light"}},{"id":"story-974_5","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6d3\u002F940\u002F4a8\u002F6d39404a87447002d12d4bb4b3ab6999.jpg","button":{"title":"Весь список","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompanies\u002Fbarsgroup\u002Farticles\u002F879132\u002F","colorType":"light"}},{"id":"story-974_6","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd6e\u002F7cf\u002F40d\u002Fd6e7cf40dd6a3f2f4fba98c0f82b5f3f.jpg","button":{"title":"Есть два подхода","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompanies\u002Fairi\u002Farticles\u002F879178\u002F","colorType":"dark"}},{"id":"story-974_7","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6d0\u002F8a7\u002F1a9\u002F6d08a71a97c6168589aa71546aae710d.jpg","button":{"title":"Что к чему","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompanies\u002Fsportmaster_lab\u002Farticles\u002F872204\u002F","colorType":"dark"}},{"id":"story-974_8","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe68\u002Fda5\u002F2a3\u002Fe68da52a3a7985ae01854a6b627eeca3.jpg","button":{"title":"Материалы дела","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompanies\u002Fruvds\u002Farticles\u002F879626\u002F","colorType":"dark"}}]},{"id":"story-972","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F838\u002Fef6\u002F8af\u002F838ef68afffd42bb0cd44dcac6d41d90.png","title":"Хабр Новости","link":"https:\u002F\u002Fu.habr.com\u002FstXHR"},"title":"Астрономы открыли «Кипу»","lang":"ru","startTime":"2025-02-11T11:41:00+03:00","finishTime":"2025-02-18T11:41:40+03:00","slides":[{"id":"story-972_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F18b\u002Fd36\u002F58c\u002F18bd3658cf49a6897e96a986c045189d.jpg","button":{"title":"Читать","link":"https:\u002F\u002Fu.habr.com\u002FstXHR","colorType":"dark"}},{"id":"story-972_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc5c\u002F8d4\u002Ff8b\u002Fc5c8d4f8b4ae6f2ef38939314f96fd6d.jpg","button":{"title":"Подробнее","link":"https:\u002F\u002Fu.habr.com\u002FstXHR","colorType":"dark"}}]},{"id":"story-964","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fdb2\u002Fca2\u002F542\u002Fdb2ca25428dfba4643257596069e69fa.png","title":"Хабр Карьера","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Fusers\u002Fhabr_career\u002Fposts\u002F"},"title":"Отправьте эйчару валентинку","lang":"ru","startTime":"2025-01-31T14:21:00+03:00","finishTime":"2025-02-14T14:21:00+03:00","slides":[{"id":"story-964_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F53d\u002Fd07\u002F1bc\u002F53dd071bcad6a132af48892c4594fd53.png","button":null},{"id":"story-964_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7fd\u002Fa92\u002F642\u002F7fda92642495d588a7c1160758d94f42.png","button":{"title":"Написать","link":"https:\u002F\u002Fbitrix24.korusconsulting.ru\u002Fhr-eto_po_lyubvi?utm_source=habr","colorType":"dark"}}]},{"id":"story-952","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fed8\u002Fbb8\u002F474\u002Fed8bb8474f5df562ada66ad1644cd431.png","title":"Хабр","link":null},"title":"Нейрозима 2025","lang":"ru","startTime":"2025-01-13T14:37:00+03:00","finishTime":"2025-02-16T14:37:00+03:00","slides":[{"id":"story-952_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F285\u002Fc0b\u002Fa0f\u002F285c0ba0f6cd9eca4c87abce156a99e2.jpg","button":null},{"id":"story-952_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa49\u002Ffc4\u002F92d\u002Fa49fc492ddbb67a3e8b3ac2579d9005f.jpg","button":{"title":"Результаты","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F864654\u002F","colorType":"dark"}},{"id":"story-952_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F8e6\u002Fa94\u002Fe14\u002F8e6a94e1464ad6b411793f5912933719.jpg","button":{"title":"Личный опыт","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F871268\u002F","colorType":"light"}},{"id":"story-952_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff3f\u002F4a8\u002F23a\u002Ff3f4a823a6789edcc2b20506423f9791.jpg","button":{"title":"Перечень","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompanies\u002Fruvds\u002Farticles\u002F853996\u002F","colorType":"dark"}},{"id":"story-952_5","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F0a6\u002Fbdb\u002Fa47\u002F0a6bdba4767c472838c73ffa733464e5.jpg","button":{"title":"Детали проекта","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F852900\u002F","colorType":"light"}},{"id":"story-952_6","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F8b5\u002F4b3\u002Ffae\u002F8b54b3fae1bd8e5a8d2338830d078d34.jpg","button":{"title":"Таблицы и цифры","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompanies\u002Fsberdevices\u002Farticles\u002F855368\u002F","colorType":"light"}},{"id":"story-952_7","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F210\u002F267\u002F085\u002F21026708554019213c71944b9f05fb19.jpg","button":{"title":"Есть нюансы","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F860316\u002F","colorType":"dark"}},{"id":"story-952_8","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F357\u002F7e0\u002F6b7\u002F3577e06b7aab74cb07d1abedd28fab9a.jpg","button":{"title":"Дневник","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F870492\u002F","colorType":"light"}}]},{"id":"story-771","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa9b\u002F886\u002Fa5e\u002Fa9b886a5e8d6471dbf9a6e7a4c393fbb.png","title":"Хабр","link":null},"title":"Физкульт-привет","lang":"ru","startTime":"2024-10-07T12:40:00+03:00","finishTime":"2025-02-16T12:40:00+03:00","slides":[{"id":"story-771_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F67d\u002Fee8\u002Fb25\u002F67dee8b258f7df316ee7298f6132b834.jpg","button":null},{"id":"story-771_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe1e\u002F6f6\u002Ff8b\u002Fe1e6f6f8b66b088f5e4d6b966f83b5d2.jpg","button":{"title":"Побежали","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompanies\u002Fflant\u002Farticles\u002F475944\u002F","colorType":"dark"}},{"id":"story-771_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc8c\u002Ff40\u002Fb08\u002Fc8cf40b088222a417e226e6221bef1f0.jpg","button":{"title":"Рекомендации","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F722330\u002F","colorType":"light"}},{"id":"story-771_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F201\u002Fd02\u002F0a7\u002F201d020a78f4f3a50ac3deffa6aeb3bb.jpg","button":{"title":"Трудный путь","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompanies\u002Fhflabs\u002Farticles\u002F753842\u002F","colorType":"light"}},{"id":"story-771_5","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff7c\u002F190\u002Febb\u002Ff7c190ebb28dbbbe05b216aa2b387f21.jpg","button":{"title":"Графики и код","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F714698\u002F","colorType":"light"}},{"id":"story-771_6","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F18c\u002F3f3\u002F435\u002F18c3f3435b1deddf55332f2610b12038.jpg","button":{"title":"VR-тренировки","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F803203\u002F","colorType":"light"}},{"id":"story-771_7","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F71d\u002F62c\u002F71a\u002F71d62c71af81798215518c0ae817221a.jpg","button":{"title":"Читать","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F681154\u002F","colorType":"light"}},{"id":"story-771_8","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F21a\u002F8ea\u002F005\u002F21a8ea005c547f62081938e7ff9df6f5.jpg","button":{"title":"Упражнения и советы","link":"https:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F528592\u002F","colorType":"light"}}]}]},"technotext":{"years":[],"technotextDocForNominees":null,"technotextDocForWinners":null,"technotextInfo":{},"technotextInfoLoading":false,"technotextWinners":{},"technotextWinnersLoading":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"userVotes":{"karmaVotesList":[],"karmaVotesPagesCount":null,"karmaVotesListLoading":false,"commentsVotesList":[],"commentsVotesPagesCount":null,"commentsVotesListLoading":false,"postsVotesList":[],"postsVotesPagesCount":null,"postsVotesListLoading":false,"userVotesList":[],"userVotesPagesCount":null,"userVotesListLoading":false},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"userSpecialization":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"notificationsLoading":false,"notificationsList":[],"notificationsPageCount":0,"pendingMarkNotificationsRead":[],"publicationsLoading":true,"publicationsList":[],"publicationsPageCount":0,"pendingDeletePublications":false,"pendingMarkPublicationsRead":false},"events":{"eventRefs":{},"eventIds":[],"pagesCount":0,"categories":[],"cities":[],"actualEvents":[{"id":"576","titleHtml":"Epic Telegram Conference","descriptionHtml":"\u003Cp\u003EОнлайн-конференция для роста бизнеса, маркетинга и личного бренда в Telegram\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F854\u002Fe52\u002F91a\u002F854e5291accb21184bd75d40c20d50c9.jpg","eventUrl":"https:\u002F\u002Fepicgrowth.io\u002Ftelegram-conference?utm_source=habr&utm_medium=partner&utm_capmaign=event&utm_content=tgconf&utm_term=calendar-45582","startDay":"2025-02-11","startTime":"11:00","finishDay":"2025-02-13","isOnline":true,"geo":[],"isArchive":false,"categories":[{"id":"10","titleHtml":"Маркетинг"}],"tags":["маркетинг","личный бренд","публичность","telegram","epic growth"],"metadata":null},{"id":"580","titleHtml":"Вебинар «Практикум Cloud.ru Evolution: как связать несколько виртуальных машин»","descriptionHtml":"\u003Cp\u003EПокажем, как организовать сетевую связанность между виртуальными машинами разных VPC на платформе Cloud.ru Evolution, а также между Cloud.ru Evolution и другими платформами или on-premise инфраструктурой.\u003C\u002Fp\u003E\u003Cp\u003EПрограмма встречи:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EКакие сетевые сервисы появятся на платформе Cloud.ru Evolution в ближайшее время.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EДемо: обращаемся к виртуальным машинам по имени. Новый сервис Evolution DNS.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EДемо: как связать свою инфраструктуру с облаком Cloud.ru Evolution и виртуальные машины в разных облаках Cloud.ru с помощью сервисов Evolution Direct Connect и Evolution Magic Router.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EВебинар будет интересен разработчикам, IT-менеджерам и всем, кто уже использует облачные технологии и хочет задать вопросы эксперту или получить совет по работе с платформой Cloud.ru Evolution.\u003C\u002Fp\u003E\u003Cp\u003EПлатформа Cloud.ru Evolution — публичное облако, построенное на собственных разработках и свободно распространяемых компонентах. Оно подходит для разработки и тестирования на виртуальных машинах, создания и безопасной публикации cloud native приложений в интернете.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7ee\u002F4e7\u002F008\u002F7ee4e700871c1ca595c9c4490bed5c72.png","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_cloudrupraktikum","startDay":"2025-02-13","startTime":"11:00","isOnline":true,"geo":[],"isArchive":false,"categories":[{"id":"2","titleHtml":"Разработка"}],"tags":["облака","cloud.ru","виртуальные машины"],"metadata":null},{"id":"578","titleHtml":"«Честные вакансии: DevOps Middle»: бесплатный вебинар от учебного центра Слёрм","descriptionHtml":"\u003Cp\u003EМы запускаем серию бесплатных вебинаров «Честные вакансии: DevOps Middle», где будем максимально открыто обсуждать требования компаний к специалистам.\u003C\u002Fp\u003E\u003Cp\u003EЧто будем обсуждать:\u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E\u003Cp\u003EТекущая ситуация на рынке: фриз на найм или увольнения.&nbsp;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EРед-флаги для джунов и миддлов на собеседованиях.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EТребования к Middle DevOps-специалисту: средняя температура по больнице.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EРабота в обмен на опыт: на какие условия стоит соглашаться.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp\u003EВ итоге встречи вы сможете ответить на вопросы:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EПочему я всё ещё джун? Каких навыков мне не хватает, чтобы стать миддлом?\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EКаким джуном нужно быть, чтобы компания была заинтересована «‎дотащить» меня до миддла?&nbsp;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EСпикеры:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EВячеслав Федосеев, TeamLead DevOps в «‎Честном знаке», автор канала «‎DevOps Bootcamp с Федосеевым».\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EВладимир Федорков, основатель fournines.ru.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EУчастие бесплатное, регистрация через бота. Приходите.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff59\u002F909\u002Fc21\u002Ff59909c215b64df1218f1d50717a8306.png","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_scpecpr","startDay":"2025-02-13","startTime":"19:00","isOnline":true,"geo":[],"isArchive":false,"categories":[{"id":"2","titleHtml":"Разработка"}],"tags":["DevOps Middle","Честные вакансии","Вебинар","Бесплатный вебинар","Бесплатный вебинар от Слерм"],"metadata":null},{"id":"584","titleHtml":"Онлайн-интенсив «Нейросети для HR в 2025 году»","descriptionHtml":"\u003Cp\u003EОнлайн-интенсив от организаторов конференции Techrec HR &amp; AI: самое полезное про AI, чтобы прокачать работу и автоматизировать рутину HR-специалистов.\u003C\u002Fp\u003E\u003Cp\u003EВы получите:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EВсё, что нужно для старта работы в ChatGPT, Midjourney и ещё в 7 актуальных нейросетях\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EГотовые запросы к нейросетям по всем важнейшим задачам HR\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EГотовый алгоритм автоматизации вашей работы\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EЛучшие кейсы использования AI в HR-индустрии\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EИнтенсив будет интересен тем, кто выстраивает HR-стратегию и занимается подбором, работает с большим количеством информации, руководит HR-службами и хочет повысить их эффективность.\u003C\u002Fp\u003E\u003Cp\u003EМероприятие будет проходить три дня: 14, 17 и 19 февраля в онлайн-формате.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ffe1\u002F34e\u002Fb2e\u002Ffe134eb2ea6b8c71d92faac74b180a32.png","eventUrl":"https:\u002F\u002Fgetitschool.online\u002Fneuralnetworksforhrin2025","startDay":"2025-02-14","startTime":"17:00","finishDay":"2025-02-19","isOnline":true,"geo":[],"isArchive":false,"categories":[{"id":"16","titleHtml":"Другое"}],"tags":["hr"],"metadata":null},{"id":"574","titleHtml":"Конференция True Tech Hub в рамках фестиваля «Система Фест»","descriptionHtml":"\u003Cp\u003EМТС приглашает на конференцию True Tech Hub в рамках фестиваля «Система Фест» в Нижнем Новгороде. Тема конференции – «Мир ИТ изнутри».\u003C\u002Fp\u003E\u003Cp\u003E15 февраля вы узнаете:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EКак устроена работа в ИТ-сфере на примере технологических продуктов и сервисов, которые создаются в МТС и других экосистемах.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EКак современные технологии влияют на нашу повседневную жизнь.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EС какими задачами сейчас сталкиваются ИТ-специалисты.&nbsp;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EКроме докладов, вас ждут бесплатные карьерные консультации, зоны с ИТ-активностями, нетворкинг, а ещё призы и сувениры от организаторов.\u003C\u002Fp\u003E\u003Cp\u003EПрограмма будет интересна опытным и молодым ИТ-специалистам, разработчикам, студентам последних курсов технических направлений и всем, кто следит за технологиями.&nbsp;\u003C\u002Fp\u003E\u003Cp\u003EКонференция пройдёт в культурном центре «Академия Маяк» в Нижнем Новгороде по адресу Нижне-Волжская набережная, д. 11, в рамках фестиваля «Система Фест», организованного благотворительным фондом «Система» при поддержке МТС. \u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F724\u002Fcc3\u002F10a\u002F724cc310ae3759cc5bea40d24785a877.png","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_mtsconf","startDay":"2025-02-15","startTime":"11:00","finishDay":"2025-02-15","finishTime":"19:20","isOnline":true,"geo":["Нижний Новгород"],"isArchive":false,"categories":[{"id":"2","titleHtml":"Разработка"}],"tags":["МТС конференция","конференция Нижний Новгород","конференция для IT","конференция для айтишников","мтс тех хаб"],"metadata":null},{"id":"582","titleHtml":"Весенний Хабр Семинар: как синергия HR и PR помогает удерживать сотрудников","descriptionHtml":"\u003Cp\u003E13 марта Хабр соберет экспертов по IT-брендингу, PR и внутренним коммуникациям, чтобы обсудить, как сильный продукт и качественный контент превращают сотрудников в амбассадоров компании. Разберем, почему удержание — это не только про культуру внутри, но и про репутацию снаружи.\u003C\u002Fp\u003E\u003Cp\u003EБудет полезно HR-специалистам, PR-менеджерам, маркетологам, деврелам, и руководителям IT-подразделений — всем, кто строит корпоративную культуру и сильный бренд.\u003C\u002Fp\u003E\u003Cp\u003E🎟 HR + PR — идеальный союз\u003Cbr\u003EКогда HR и PR работают вместе, сотрудники остаются, а бренд растёт. А если они ещё и приходят на Хабр Семинар парой — получают скидку на совместный билет!\u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc62\u002Fb96\u002F430\u002Fc62b96430d576f2e72a9aa5aa45162d1.png","eventUrl":"https:\u002F\u002Fhabr.timepad.ru\u002Fevent\u002F3213460\u002F?utm_refcode=f455db48ec9cfc131ba5153799b7ade217e5b228","startDay":"2025-03-13","startTime":"10:00","finishDay":"2025-03-13","finishTime":"16:00","isOnline":false,"geo":["Москва"],"isArchive":false,"categories":[{"id":"8","titleHtml":"Менеджмент"},{"id":"10","titleHtml":"Маркетинг"},{"id":"16","titleHtml":"Другое"}],"tags":["PR","HR","IT-бренд","Продуктовый PR","Хабр"],"metadata":null},{"id":"572","titleHtml":"Deckhouse Conf 2025","descriptionHtml":"\u003Cp\u003EТехническая конференция для инженеров и разработчиков от команды Deckhouse, которая уже 8 лет развивает продукты для Cloud Native-разработки.\u003C\u002Fp\u003E\u003Cp\u003EПриезжайте слушать доклады про DevOps, Kubernetes, безопасность и мониторинг. А ещё знакомиться с решениями Deckhouse и партнёров на стендах и обмениваться опытом с экспертами по DevOps, SRE, платформенной разработке, ИБ и управлению командами. Один день, один трек, максимум полезного общения.&nbsp;\u003C\u002Fp\u003E\u003Cp\u003EЧто точно будет:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EХардкорные доклады с глубоким погружением в технологии.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EДоклады полегче, которые вдохновят на новые решения.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EПолезные стенды и знакомства с инженерами Deckhouse и партнёров.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003E\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb5b\u002F861\u002F81a\u002Fb5b86181afd0a3ea5207176063b7ccc0.png","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_deckhouseconf","startDay":"2025-03-27","startTime":"10:00","finishDay":"2025-03-27","isOnline":false,"geo":["Москва"],"isArchive":false,"categories":[{"id":"2","titleHtml":"Разработка"},{"id":"4","titleHtml":"Администрирование"},{"id":"8","titleHtml":"Менеджмент"}],"tags":["Техническая конференция","Декхаус конференция","deckhouse conf","доклады айтишников","общение айтишников","IT","разработка","DevOps"],"metadata":null},{"id":"516","titleHtml":"IT-конференция Merge Tatarstan 2025","descriptionHtml":"\u003Cp\u003EКрупнейшая региональная IT-конференция России собирает профессионалов со всей страны для нетворкинга, обмена опытом и поиска новых деловых контактов.\u003C\u002Fp\u003E\u003Cp\u003EMerge Tatarstan — это 7 тематических конференций на одной площадке, 2000 участников, более 170 спикеров-практиков, мастер-классы, воркшопы и BoF-сессии.\u003C\u002Fp\u003E\u003Cp\u003EК участию в конференции приглашаются разработчики, QA, тимлиды, Project\u002FProduct-менеджеры, маркетологи, аналитики, UI\u002FUX-дизайнеры, PR-специалисты, HR-менеджеры, владельцы бизнеса и начинающие специалисты.\u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F0e9\u002F3a8\u002F3ec\u002F0e93a83ecea09f806d1df907ddb036a4.jpg","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_tatarstan","startDay":"2025-04-25","startTime":"09:00","finishDay":"2025-04-26","finishTime":"19:30","isOnline":false,"geo":["Казань"],"isArchive":false,"categories":[{"id":"2","titleHtml":"Разработка"},{"id":"10","titleHtml":"Маркетинг"},{"id":"16","titleHtml":"Другое"}],"tags":["Разработка","IT","PR","UI\u002FUX","бизнес","маркетинг","аналитика"],"metadata":null}],"currentEvent":null,"eventsFilter":{"city":"all","timeStarted":null,"timeEnded":null}},"wysiwyg":{"WYSIWYGRulesRefs":null}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="https://assets.habr.com/habr-web/js/chunk-vendors.309f4a3f.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.1fe19768.js" defer></script></div>
    <div id="overlays"><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--></div>
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-S28W1WC23F"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

  </script>
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
    </body>

    </html>
